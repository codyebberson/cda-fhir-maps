<StructureMap xmlns="http://hl7.org/fhir">
   <id value="CdaChToBundle"></id>
   <text>
      <status value="generated"></status>
      <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle" = "CdaChToBundle"

// CDA-CH document, 2.16.756.5.30.1.1.10.1.14
// 2020-01-16 Oliver Egger, copyright ahdis ag, Apache License
// CDA-CH:  https://art-decor.org/art-decor/decor-templates--hl7chcda-
// FHIR CH-Core: http://fhir.ch/ig/ch-core/index.html

uses "http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument" alias ClinicalDocument as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Section" alias Section as queried
uses "http://hl7.org/fhir/cda/StructureDefinition/PatientRole" alias PatientRole as queried
uses "http://hl7.org/fhir/cda/StructureDefinition/DataEnterer" alias DataEnterer as queried
uses "http://hl7.org/fhir/StructureDefinition/Bundle" alias Bundle as target
uses "http://hl7.org/fhir/StructureDefinition/Composition" alias Composition as produced
uses "http://hl7.org/fhir/StructureDefinition/Patient" alias Patient as produced
uses "http://hl7.org/fhir/StructureDefinition/Person" alias Person as produced
uses "http://hl7.org/fhir/StructureDefinition/Practitioner" alias Practitioner as produced
uses "http://hl7.org/fhir/StructureDefinition/Organization" alias Organization as produced

imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-document.html
group CdaChToBundle(source cda : ClinicalDocument, target bundle : Bundle) {
  cda -&gt;  bundle.entry as e,  e.resource = create('Composition') as composition,  composition.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  bundle.entry as e2,  e2.resource = create('Patient') as patient,  patient.id = uuid() as uuid2,  e2.fullUrl = append('urn:uuid:', uuid2) then ClinicalDocumentChToBundle(cda, patient, composition, bundle) "ClinicalDocumentToBody";
}

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-document.html
group ClinicalDocumentChToBundle(source cda : ClinicalDocument, target patient : Patient, target composition : Composition, target bundle : Bundle) extends ClinicalDocumentToBundle {
  cda then ClinicalDocumentCompositionCh(cda, composition, patient, bundle) "composition";
  cda.component as component then {
    component.structuredBody as body then {
      body.component as component then {
        component.section as srcSection where (templateId.where(root = '2.16.756.5.30.1.1.10.3.2')) -&gt; composition.section as tgtSection then ClinicalDocumentSection(srcSection, patient, tgtSection, bundle);
        component.section as srcSection where (templateId.where(root = '2.16.756.5.30.1.1.10.3.45')) -&gt; composition.section as tgtSection then SectionOriginalRepresentation(srcSection, patient, tgtSection, bundle);
      };
    } "body";
  };
}

// _________________________ Section Level Templates _________________________
// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-composition-definitions.html#Composition.section
// TODO: not excplicitly modeled in CH-Core
group SectionOriginalRepresentation(source src : Section, source patient : Patient, target tgt, target bundle : Bundle) extends ClinicalDocumentSection {
  src.entry as cdaEntry -&gt;  bundle.entry as e,  e.resource = create('Binary') as binary,  binary.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid) as urnuuid,  tgt.entry = create('Reference') as reference,  reference.type = 'Binary',  reference.reference = urnuuid then {
    cdaEntry.observationMedia as observationMedia then {
      observationMedia then ObservationMedia(observationMedia, binary) "observationMedia";
      observationMedia.ID as value -&gt; reference.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  } "cdaEntry";
}

// _________________________ Entry Level Templates   ________________________
// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.4.83
// TODO: not excplicitly modeled in CH-Core
group ObservationMedia(source observationMedia, target binary : Binary) {
  observationMedia.value as value then {
    value.mediaType as mediaType -&gt; binary.contentType = mediaType "contentType";
    value -&gt; binary.data = (value.dataBase64Binary) "dataString";
  };
  observationMedia.languageCode as languageCode then {
    languageCode.code as lang -&gt; binary.language = lang "lang";
  };
}

// _________________________ Header Level Templates _________________________
// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-confidentialitycode.html
group ChExtEprConfidentialityCode(source src : CE, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-confidentialitycode' "url";
  src -&gt; ext.value = create('CodeableConcept') as value then CECodeableConcept(src, value) "code";
}

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-versionnumber.html
group ChExtEprVersionNumber(source src : INT, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-versionnumber' "url";
  src -&gt; ext.value = create('unsignedInt') as value then INT(src, value) "value";
}

group ChExtEprVersionNumber1(source src, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-versionnumber' "url";
  src -&gt;  ext.value = create('unsignedInt') as value,  value.value = '1' "value";
}

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-informationrecipient.html
group ChExtEprInformationRecipient(source src : IntendedRecipient, target patient : Patient, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-informationrecipient' "url";
  src -&gt;  ext.value = create('Reference') as reference,  reference.type = 'Patient',  reference.reference = ('urn:uuid:' + %patient.id) "value";
  src.addr as addr -&gt; patient.address as address then ADAddress(addr, address) "address";
  src.informationRecipient as informationRecipient then {
    informationRecipient.name as cdaname -&gt; patient.name as fhirname then ENHumanName(cdaname, fhirname);
  };
}

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-informationrecipient.html
group ChExtEprInformationRecipientOrganization(source src : IntendedRecipient, target organization : Organization, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-informationrecipient' "url";
  src -&gt;  ext.value = create('Reference') as reference,  reference.type = 'Organization',  reference.reference = ('urn:uuid:' + %organization.id) "value";
  src.receivedOrganization as receivedOrganization then ClinicalDocumentOrganization(receivedOrganization, organization) "organization";
}

// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?section=templates&amp;id=2.16.756.5.30.1.1.10.2.7
// target: http://build.fhir.org/ig/hl7ch/ch-core/StructureDefinition-ch-ext-epr-dataenterer.html
group ChExtEprDataEnterer(source src : DataEnterer, target practitioner : Practitioner, target ext : Extension) {
  src -&gt; ext.url = 'http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-dataenterer' "url";
  src.assignedEntity as assignedEntity -&gt;  ext.extension as ext,  ext.url = 'enterer',  ext.value = create('Reference') as reference,  reference.type = 'Practitioner',  reference.reference = ('urn:uuid:' + %practitioner.id) then ClinicalDocumentEntityPractitioner(assignedEntity, practitioner) "practitioner";
  src.time as time -&gt; ext.extension as exttime then ChExtEprTime(time, exttime);
}

// _________________________ Template Type not specified  ___________________
// source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
// target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-composition-epr.html
group ClinicalDocumentCompositionCh(source src : ClinicalDocument, target tgt : Composition, target patientResource : Patient, target bundle : Bundle) {
  src.confidentialityCode as confidentialityCode then {
    confidentialityCode.code as v -&gt;  tgt.confidentiality = translate(v, 'http://fhir.ch/ig/ch-core/ConceptMap/documententry-confidentialitycode-to-fhir', 'code') as fhirconf,  fhirconf.extension as ext then ChExtEprConfidentialityCode(confidentialityCode, ext) "confCode";
  };
  src where $this.versionNumber.exists().not() -&gt; tgt.extension as ext2 then ChExtEprVersionNumber1(src, ext2) "versionNumber1";
  src.versionNumber as versionNumber -&gt; tgt.extension as ext2 then ChExtEprVersionNumber(versionNumber, ext2);
  src.informationRecipient as informationRecipient -&gt; bundle.entry as e then {
    informationRecipient.intendedRecipient as intendedRecipient where $this.receivedOrganization.exists() = false -&gt;  e.resource = create('Patient') as recipient,  recipient.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  tgt.extension as ext then ChExtEprInformationRecipient(intendedRecipient, recipient, ext) "informationRecipient";
    informationRecipient.intendedRecipient as intendedRecipient then {
      intendedRecipient.receivedOrganization -&gt;  e.resource = create('Organization') as recipient,  recipient.id = uuid() as uuid2,  e.fullUrl = append('urn:uuid:', uuid2),  tgt.extension as ext then ChExtEprInformationRecipientOrganization(intendedRecipient, recipient, ext) "informationRecipientOrganization";
    } "intendedRecipientAsOrganization";
  } "entry";
  src.dataEnterer as dataEnterer -&gt;  bundle.entry as e,  e.resource = create('Practitioner') as practitioner,  practitioner.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  tgt.extension as ext then ChExtEprDataEnterer(dataEnterer, practitioner, ext);
}

</pre>
      </div>
   </text>
   <url value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle"></url>
   <name value="CdaChToBundle"></name>
   <description value="CDA-CH document, 2.16.756.5.30.1.1.10.1.14
2020-01-16 Oliver Egger, copyright ahdis ag, Apache License
CDA-CH:  https://art-decor.org/art-decor/decor-templates--hl7chcda-
FHIR CH-Core: http://fhir.ch/ig/ch-core/index.html"></description>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument"></url>
      <mode value="source"></mode>
      <alias value="ClinicalDocument"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Section"></url>
      <mode value="queried"></mode>
      <alias value="Section"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PatientRole"></url>
      <mode value="queried"></mode>
      <alias value="PatientRole"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/DataEnterer"></url>
      <mode value="queried"></mode>
      <alias value="DataEnterer"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Bundle"></url>
      <mode value="target"></mode>
      <alias value="Bundle"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Composition"></url>
      <mode value="produced"></mode>
      <alias value="Composition"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Patient"></url>
      <mode value="produced"></mode>
      <alias value="Patient"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Person"></url>
      <mode value="produced"></mode>
      <alias value="Person"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"></url>
      <mode value="produced"></mode>
      <alias value="Practitioner"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Organization"></url>
      <mode value="produced"></mode>
      <alias value="Organization"></alias>
   </structure>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"></import>
   <group>
      <name value="CdaChToBundle"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-document.html"></documentation>
      <input>
         <name value="cda"></name>
         <type value="ClinicalDocument"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ClinicalDocumentToBody"></name>
         <source>
            <context value="cda"></context>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="composition"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Composition"></valueString>
            </parameter>
         </target>
         <target>
            <context value="composition"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e2"></variable>
         </target>
         <target>
            <context value="e2"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="patient"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Patient"></valueString>
            </parameter>
         </target>
         <target>
            <context value="patient"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid2"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e2"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid2"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="ClinicalDocumentChToBundle"></name>
            <variable value="cda"></variable>
            <variable value="patient"></variable>
            <variable value="composition"></variable>
            <variable value="bundle"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ClinicalDocumentChToBundle"></name>
      <extends value="ClinicalDocumentToBundle"></extends>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-document.html"></documentation>
      <input>
         <name value="cda"></name>
         <type value="ClinicalDocument"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="composition"></name>
         <type value="Composition"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="composition"></name>
         <source>
            <context value="cda"></context>
         </source>
         <dependent>
            <name value="ClinicalDocumentCompositionCh"></name>
            <variable value="cda"></variable>
            <variable value="composition"></variable>
            <variable value="patient"></variable>
            <variable value="bundle"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="component"></name>
         <source>
            <context value="cda"></context>
            <element value="component"></element>
            <variable value="component"></variable>
         </source>
         <rule>
            <name value="body"></name>
            <source>
               <context value="component"></context>
               <element value="structuredBody"></element>
               <variable value="body"></variable>
            </source>
            <rule>
               <name value="component"></name>
               <source>
                  <context value="body"></context>
                  <element value="component"></element>
                  <variable value="component"></variable>
               </source>
               <rule>
                  <name value="section"></name>
                  <source>
                     <context value="component"></context>
                     <element value="section"></element>
                     <variable value="srcSection"></variable>
                     <condition value="(templateId.where(root = '2.16.756.5.30.1.1.10.3.2'))"></condition>
                  </source>
                  <target>
                     <context value="composition"></context>
                     <contextType value="variable"></contextType>
                     <element value="section"></element>
                     <variable value="tgtSection"></variable>
                  </target>
                  <dependent>
                     <name value="ClinicalDocumentSection"></name>
                     <variable value="srcSection"></variable>
                     <variable value="patient"></variable>
                     <variable value="tgtSection"></variable>
                     <variable value="bundle"></variable>
                  </dependent>
               </rule>
               <rule>
                  <name value="section"></name>
                  <source>
                     <context value="component"></context>
                     <element value="section"></element>
                     <variable value="srcSection"></variable>
                     <condition value="(templateId.where(root = '2.16.756.5.30.1.1.10.3.45'))"></condition>
                  </source>
                  <target>
                     <context value="composition"></context>
                     <contextType value="variable"></contextType>
                     <element value="section"></element>
                     <variable value="tgtSection"></variable>
                  </target>
                  <dependent>
                     <name value="SectionOriginalRepresentation"></name>
                     <variable value="srcSection"></variable>
                     <variable value="patient"></variable>
                     <variable value="tgtSection"></variable>
                     <variable value="bundle"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="SectionOriginalRepresentation"></name>
      <extends value="ClinicalDocumentSection"></extends>
      <typeMode value="none"></typeMode>
      <documentation value="_________________________ Section Level Templates _________________________
source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.1.14
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-composition-definitions.html#Composition.section
TODO: not excplicitly modeled in CH-Core"></documentation>
      <input>
         <name value="src"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="tgt"></name>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="cdaEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entry"></element>
            <variable value="cdaEntry"></variable>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="binary"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Binary"></valueString>
            </parameter>
         </target>
         <target>
            <context value="binary"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <variable value="urnuuid"></variable>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="type"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Binary"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="urnuuid"></valueId>
            </parameter>
         </target>
         <rule>
            <name value="observationMedia"></name>
            <source>
               <context value="cdaEntry"></context>
               <element value="observationMedia"></element>
               <variable value="observationMedia"></variable>
            </source>
            <rule>
               <name value="observationMedia"></name>
               <source>
                  <context value="observationMedia"></context>
               </source>
               <dependent>
                  <name value="ObservationMedia"></name>
                  <variable value="observationMedia"></variable>
                  <variable value="binary"></variable>
               </dependent>
            </rule>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="observationMedia"></context>
                  <element value="ID"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ObservationMedia"></name>
      <typeMode value="none"></typeMode>
      <documentation value="_________________________ Entry Level Templates   ________________________
source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.4.83
TODO: not excplicitly modeled in CH-Core"></documentation>
      <input>
         <name value="observationMedia"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="binary"></name>
         <type value="Binary"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="value"></name>
         <source>
            <context value="observationMedia"></context>
            <element value="value"></element>
            <variable value="value"></variable>
         </source>
         <rule>
            <name value="contentType"></name>
            <source>
               <context value="value"></context>
               <element value="mediaType"></element>
               <variable value="mediaType"></variable>
            </source>
            <target>
               <context value="binary"></context>
               <contextType value="variable"></contextType>
               <element value="contentType"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="mediaType"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="dataString"></name>
            <source>
               <context value="value"></context>
            </source>
            <target>
               <context value="binary"></context>
               <contextType value="variable"></contextType>
               <element value="data"></element>
               <transform value="evaluate"></transform>
               <parameter>
                  <valueString value="value.dataBase64Binary"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="languageCode"></name>
         <source>
            <context value="observationMedia"></context>
            <element value="languageCode"></element>
            <variable value="languageCode"></variable>
         </source>
         <rule>
            <name value="lang"></name>
            <source>
               <context value="languageCode"></context>
               <element value="code"></element>
               <variable value="lang"></variable>
            </source>
            <target>
               <context value="binary"></context>
               <contextType value="variable"></contextType>
               <element value="language"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="lang"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ChExtEprConfidentialityCode"></name>
      <typeMode value="none"></typeMode>
      <documentation value="_________________________ Header Level Templates _________________________
source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-confidentialitycode.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="CE"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-confidentialitycode"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="value"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="CodeableConcept"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="CECodeableConcept"></name>
            <variable value="src"></variable>
            <variable value="value"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ChExtEprVersionNumber"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-versionnumber.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="INT"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-versionnumber"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="value"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="unsignedInt"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="INT"></name>
            <variable value="src"></variable>
            <variable value="value"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ChExtEprVersionNumber1"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-versionnumber"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="value"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="unsignedInt"></valueString>
            </parameter>
         </target>
         <target>
            <context value="value"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="ChExtEprInformationRecipient"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-informationrecipient.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="IntendedRecipient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-informationrecipient"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="type"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Patient"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %patient.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="address"></name>
         <source>
            <context value="src"></context>
            <element value="addr"></element>
            <variable value="addr"></variable>
         </source>
         <target>
            <context value="patient"></context>
            <contextType value="variable"></contextType>
            <element value="address"></element>
            <variable value="address"></variable>
         </target>
         <dependent>
            <name value="ADAddress"></name>
            <variable value="addr"></variable>
            <variable value="address"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="informationRecipient"></name>
         <source>
            <context value="src"></context>
            <element value="informationRecipient"></element>
            <variable value="informationRecipient"></variable>
         </source>
         <rule>
            <name value="name"></name>
            <source>
               <context value="informationRecipient"></context>
               <element value="name"></element>
               <variable value="cdaname"></variable>
            </source>
            <target>
               <context value="patient"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="fhirname"></variable>
            </target>
            <dependent>
               <name value="ENHumanName"></name>
               <variable value="cdaname"></variable>
               <variable value="fhirname"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ChExtEprInformationRecipientOrganization"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-ext-epr-informationrecipient.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="IntendedRecipient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="organization"></name>
         <type value="Organization"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-informationrecipient"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="type"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Organization"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %organization.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="organization"></name>
         <source>
            <context value="src"></context>
            <element value="receivedOrganization"></element>
            <variable value="receivedOrganization"></variable>
         </source>
         <dependent>
            <name value="ClinicalDocumentOrganization"></name>
            <variable value="receivedOrganization"></variable>
            <variable value="organization"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ChExtEprDataEnterer"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?section=templates&amp;id=2.16.756.5.30.1.1.10.2.7
target: http://build.fhir.org/ig/hl7ch/ch-core/StructureDefinition-ch-ext-epr-dataenterer.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="DataEnterer"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="practitioner"></name>
         <type value="Practitioner"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-core/StructureDefinition/ch-ext-epr-dataenterer"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="practitioner"></name>
         <source>
            <context value="src"></context>
            <element value="assignedEntity"></element>
            <variable value="assignedEntity"></variable>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="enterer"></valueString>
            </parameter>
         </target>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="type"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Practitioner"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %practitioner.id"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="ClinicalDocumentEntityPractitioner"></name>
            <variable value="assignedEntity"></variable>
            <variable value="practitioner"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="time"></name>
         <source>
            <context value="src"></context>
            <element value="time"></element>
            <variable value="time"></variable>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="exttime"></variable>
         </target>
         <dependent>
            <name value="ChExtEprTime"></name>
            <variable value="time"></variable>
            <variable value="exttime"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ClinicalDocumentCompositionCh"></name>
      <typeMode value="none"></typeMode>
      <documentation value="_________________________ Template Type not specified  ___________________
source: https://art-decor.org/art-decor/decor-templates--hl7chcda-?id=2.16.756.5.30.1.1.10.9.36
target: http://build.fhir.org/ig/hl7ch/ch-core/branches/master/StructureDefinition-ch-core-composition-epr.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="ClinicalDocument"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="tgt"></name>
         <type value="Composition"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="patientResource"></name>
         <type value="Patient"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="confidentialityCode"></name>
         <source>
            <context value="src"></context>
            <element value="confidentialityCode"></element>
            <variable value="confidentialityCode"></variable>
         </source>
         <rule>
            <name value="confCode"></name>
            <source>
               <context value="confidentialityCode"></context>
               <element value="code"></element>
               <variable value="v"></variable>
            </source>
            <target>
               <context value="tgt"></context>
               <contextType value="variable"></contextType>
               <element value="confidentiality"></element>
               <variable value="fhirconf"></variable>
               <transform value="translate"></transform>
               <parameter>
                  <valueId value="v"></valueId>
               </parameter>
               <parameter>
                  <valueString value="http://fhir.ch/ig/ch-core/ConceptMap/documententry-confidentialitycode-to-fhir"></valueString>
               </parameter>
               <parameter>
                  <valueString value="code"></valueString>
               </parameter>
            </target>
            <target>
               <context value="fhirconf"></context>
               <contextType value="variable"></contextType>
               <element value="extension"></element>
               <variable value="ext"></variable>
            </target>
            <dependent>
               <name value="ChExtEprConfidentialityCode"></name>
               <variable value="confidentialityCode"></variable>
               <variable value="ext"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="versionNumber1"></name>
         <source>
            <context value="src"></context>
            <condition value="$this.versionNumber.exists().not()"></condition>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext2"></variable>
         </target>
         <dependent>
            <name value="ChExtEprVersionNumber1"></name>
            <variable value="src"></variable>
            <variable value="ext2"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="versionNumber"></name>
         <source>
            <context value="src"></context>
            <element value="versionNumber"></element>
            <variable value="versionNumber"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext2"></variable>
         </target>
         <dependent>
            <name value="ChExtEprVersionNumber"></name>
            <variable value="versionNumber"></variable>
            <variable value="ext2"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entry"></name>
         <source>
            <context value="src"></context>
            <element value="informationRecipient"></element>
            <variable value="informationRecipient"></variable>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <rule>
            <name value="informationRecipient"></name>
            <source>
               <context value="informationRecipient"></context>
               <element value="intendedRecipient"></element>
               <variable value="intendedRecipient"></variable>
               <condition value="$this.receivedOrganization.exists() = false"></condition>
            </source>
            <target>
               <context value="e"></context>
               <contextType value="variable"></contextType>
               <element value="resource"></element>
               <variable value="recipient"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="Patient"></valueString>
               </parameter>
            </target>
            <target>
               <context value="recipient"></context>
               <contextType value="variable"></contextType>
               <element value="id"></element>
               <variable value="uuid"></variable>
               <transform value="uuid"></transform>
            </target>
            <target>
               <context value="e"></context>
               <contextType value="variable"></contextType>
               <element value="fullUrl"></element>
               <transform value="append"></transform>
               <parameter>
                  <valueString value="urn:uuid:"></valueString>
               </parameter>
               <parameter>
                  <valueId value="uuid"></valueId>
               </parameter>
            </target>
            <target>
               <context value="tgt"></context>
               <contextType value="variable"></contextType>
               <element value="extension"></element>
               <variable value="ext"></variable>
            </target>
            <dependent>
               <name value="ChExtEprInformationRecipient"></name>
               <variable value="intendedRecipient"></variable>
               <variable value="recipient"></variable>
               <variable value="ext"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="intendedRecipientAsOrganization"></name>
            <source>
               <context value="informationRecipient"></context>
               <element value="intendedRecipient"></element>
               <variable value="intendedRecipient"></variable>
            </source>
            <rule>
               <name value="informationRecipientOrganization"></name>
               <source>
                  <context value="intendedRecipient"></context>
                  <element value="receivedOrganization"></element>
               </source>
               <target>
                  <context value="e"></context>
                  <contextType value="variable"></contextType>
                  <element value="resource"></element>
                  <variable value="recipient"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="Organization"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="recipient"></context>
                  <contextType value="variable"></contextType>
                  <element value="id"></element>
                  <variable value="uuid2"></variable>
                  <transform value="uuid"></transform>
               </target>
               <target>
                  <context value="e"></context>
                  <contextType value="variable"></contextType>
                  <element value="fullUrl"></element>
                  <transform value="append"></transform>
                  <parameter>
                     <valueString value="urn:uuid:"></valueString>
                  </parameter>
                  <parameter>
                     <valueId value="uuid2"></valueId>
                  </parameter>
               </target>
               <target>
                  <context value="tgt"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="ChExtEprInformationRecipientOrganization"></name>
                  <variable value="intendedRecipient"></variable>
                  <variable value="recipient"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="dataEnterer"></name>
         <source>
            <context value="src"></context>
            <element value="dataEnterer"></element>
            <variable value="dataEnterer"></variable>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="practitioner"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Practitioner"></valueString>
            </parameter>
         </target>
         <target>
            <context value="practitioner"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="ChExtEprDataEnterer"></name>
            <variable value="dataEnterer"></variable>
            <variable value="practitioner"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
   </group>
</StructureMap>