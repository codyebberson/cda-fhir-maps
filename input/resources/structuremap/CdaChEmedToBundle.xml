<StructureMap xmlns="http://hl7.org/fhir">
   <id value="CdaChEmedToBundle"></id>
   <text>
      <status value="generated"></status>
      <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChEmedToBundle" = "CdaChEmedToBundle"

// Medication Entries
// 2020-10-30 Oliver Egger, copyright ahdis ag, Apache License
// CDA-CH-EMED:  https://art-decor.org/art-decor/decor-project--cdachemed-
// FHIR CH-EMED: http://fhir.ch/ig/ch-emed/index.html

uses "http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument" alias ClinicalDocument as source
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor" alias AssignedAuthor as source
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity" alias AssignedEntity as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Author" alias Author as source
uses "http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization" alias CustodianOrganization as source
uses "http://hl7.org/fhir/cda/StructureDefinition/IVL_TS" alias IVL_TS as source
uses "http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS" alias EIVL_TS as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Observation" alias Observation as source
uses "http://hl7.org/fhir/cda/StructureDefinition/PatientRole" alias PatientRole as source
uses "http://hl7.org/fhir/cda/StructureDefinition/RecordTarget" alias RecordTarget as source
uses "http://hl7.org/fhir/cda/StructureDefinition/Section" alias Section as source
uses "http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration" alias SubstanceAdministration as source
uses "http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS" alias SXPR_TS as source
uses "http://hl7.org/fhir/StructureDefinition/Bundle" alias Bundle as target
uses "http://hl7.org/fhir/StructureDefinition/Composition" alias Composition as produced
uses "http://hl7.org/fhir/StructureDefinition/Patient" alias Patient as produced
uses "http://hl7.org/fhir/StructureDefinition/Practitioner" alias Practitioner as produced
uses "http://hl7.org/fhir/StructureDefinition/Organization" alias Organization as produced
uses "http://hl7.org/fhir/StructureDefinition/MedicationStatement" alias MedicationStatement as produced
uses "http://hl7.org/fhir/StructureDefinition/Dosage" alias Dosage as produced
uses "http://hl7.org/fhir/StructureDefinition/Observation" alias Observation as produced

imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle"

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.2
// target: Annotation note (e.g. http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html)
group AnnotationComment(source section : Section, source act : Act, target note : Annotation) {
  act.text as text then {
    text.data as data -&gt; note.text = data "level3";
    text.reference as reference then {
      reference.value as value -&gt; note.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
group ManufacturedMaterialEntryContentModuleDispense(source src : Supply, target medicationDispense : MedicationDispense, target medication : Medication) {
  src -&gt;  medication.id = 'med',  medicationDispense.medication = create('Reference') as vt,  vt.reference = '#med' "medication";
  // quantity value (number of packages)
  src.quantity as quantity -&gt; medicationDispense.quantity as medDispQuantity then {
    // IHE-DIS: If the product-element contains package information, the unit attribute is not be present
    quantity.value as value -&gt; medDispQuantity.value = value;
    // IHE-DIS: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system
    quantity.unit as unit then {
      unit -&gt; medDispQuantity.unit = unit "unit";
      unit -&gt; medDispQuantity.system = 'http://unitsofmeasure.org' "ucum";
      unit -&gt; medDispQuantity.code = unit "code";
    };
  };
  src.product as product then {
    product.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.name as name where asContent.exists() = false -&gt;  medication.code as fhircode,  fhircode.text = (%manufacturedMaterial.name.other) "code";
        manufacturedMaterial.asContent as asContent then {
          asContent.containerPackagedMedicine as containerPackagedMedicine then {
            containerPackagedMedicine.code as code -&gt; medication.code as fhircode share medcode then CECodeableConcept(code, fhircode);
            containerPackagedMedicine.name as name -&gt; medication.code as fhircode share medcode then {
              name -&gt; fhircode.text = (%name.other) "text";
            } "text";
            containerPackagedMedicine.formCode as formCode -&gt; medication.form as form then CECodeableConcept(formCode, form);
            // Package size
            containerPackagedMedicine.capacityQuantity as capacityQuantity -&gt;  medication.amount = create('Ratio') as ratio,  ratio.denominator = create('Quantity') as denominator,  denominator.value = '1',  denominator.unit = 'Package',  denominator.system = 'http://unitsofmeasure.org',  denominator.code = '{Package}',  ratio.numerator = create('Quantity') as quantity then EmedPQQuantity(capacityQuantity, quantity);
          };
        };
        manufacturedMaterial.ingredient as ingredient -&gt; medication.ingredient as ing then {
          ingredient.quantity as quantity -&gt; ing.strength = create('Ratio') as strength then EmedRTOPQPQRatio(quantity, strength) "strength";
          ingredient.ingredient as medingredient then {
            medingredient.code as code -&gt;  ing.item = create('CodeableConcept') as ingcode,  ingcode.text = (%medingredient.name.other) then CECodeableConcept(code, ingcode) "ingredientCode";
          };
        };
      };
    };
    // dosage for normal dosing, as no sequences are present there
    src.entryRelationship as entry then {
      entry.substanceAdministration as substanceAdministration then {
        substanceAdministration where $this.entryRelationship.sequenceNumber.exists() = false -&gt; medicationDispense.dosageInstruction as dosage then DosageInstructionsStartStopFrequency(substanceAdministration, dosage) "dosage";
      };
    } "entry";
  };
}

group EmedPQQuantity(source src : PQ, target tgt : Quantity) {
  src.value as value -&gt; tgt.value = value;
  src.unit as unit -&gt; tgt.code = unit;
  src.unit as unit -&gt; tgt.system = ('http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.where(concept.where(code = %unit)).system);
  src.unit as unit -&gt; tgt.unit = ('http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.concept.where(code = %unit).display);
}

group EmedRTOPQPQRatio(source src : RTO_PQ_PQ, target tgt : Ratio) {
  src.numerator as numerator -&gt; tgt.numerator as targetNumerator then EmedPQQuantity(numerator, targetNumerator);
  src.denominator as denominator -&gt; tgt.denominator as targetDenominator then EmedPQQuantity(denominator, targetDenominator);
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
group ManufacturedMaterialEntryContentModuleStatement(source src : SubstanceAdministration, target medicationStatement : MedicationStatement, target medication : Medication) {
  src -&gt;  medication.id = 'med',  medicationStatement.medication = create('Reference') as vt,  vt.reference = '#med' "medication";
  src.consumable as consumable then {
    consumable.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.name as name where asContent.exists() = false -&gt;  medication.code as fhircode,  fhircode.text = (%manufacturedMaterial.name.other) "code";
        manufacturedMaterial.asContent as asContent then {
          asContent.containerPackagedMedicine as containerPackagedMedicine then {
            containerPackagedMedicine.code as code -&gt; medication.code as fhircode share medcode then CECodeableConcept(code, fhircode);
            containerPackagedMedicine.name as name -&gt; medication.code as fhircode share medcode then {
              name -&gt; fhircode.text = (%name.other) "text";
            } "text";
            containerPackagedMedicine.formCode as formCode -&gt; medication.form as form then CECodeableConcept(formCode, form);
            // Package size
            containerPackagedMedicine.capacityQuantity as capacityQuantity -&gt;  medication.amount = create('Ratio') as ratio,  ratio.denominator = create('Quantity') as denominator,  denominator.value = '1',  denominator.unit = 'Package',  denominator.system = 'http://unitsofmeasure.org',  denominator.code = '{Package}',  ratio.numerator = create('Quantity') as quantity then EmedPQQuantity(capacityQuantity, quantity);
          };
        };
        manufacturedMaterial.ingredient as ingredient -&gt; medication.ingredient as ing then {
          ingredient.quantity as quantity -&gt; ing.strength = create('Ratio') as strength then EmedRTOPQPQRatio(quantity, strength) "strength";
          ingredient.ingredient as medingredient then {
            medingredient.code as code -&gt;  ing.item = create('CodeableConcept') as ingcode,  ingcode.text = (%medingredient.name.other) then CECodeableConcept(code, ingcode) "ingredientCode";
          };
        };
      };
    };
    // dosage for normal dosing, as no sequences are present there
    src where $this.entryRelationship.sequenceNumber.exists() = false -&gt; medicationStatement.dosage as dosage then DosageInstructionsStartStopFrequency(src, dosage) "dosage";
  };
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.34
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
group MedicationTreatmentPlanItemEntryContentModule(source section : Section, source src : SubstanceAdministration, source patient : Patient, target medicationStatement : MedicationStatement) {
  // src.templateId as template then TemplateID(template, medicationStatement) "templateId";
  src.id -&gt; medicationStatement.identifier;
  patient -&gt;  medicationStatement.subject = create('Reference') as reference,  reference.reference = ('urn:uuid:' + %patient.id) "patient";
  src -&gt; medicationStatement.status = 'completed' "completed";
  src.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; medicationStatement.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
  src -&gt; medicationStatement.contained = create('Medication') as medication then ManufacturedMaterialEntryContentModuleStatement(src, medicationStatement, medication) "medication";
  src.entryRelationship as entry where typeCode = 'RSON' then {
    entry.observation as observation -&gt; medicationStatement.reasonCode as reasonCode then TreatmentReasonEntryContentModule(section, observation, reasonCode) "reasonCode";
  } "41";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52')) -&gt; medicationStatement.dosage as dosage then DosageInstructionsNonStructuredEntryContentModule(section, entry, dosage) "52";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0)) -&gt; medicationStatement.dosage as dosage then DosageInstructionsEntryDosageChange(src, entry, dosage) "36";
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists()) -&gt; medicationStatement.extension as ext then MTPReferenceEntryContentModule(entry, ext) "MTPReferenceEntry";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists()) then {
    entry.act as act -&gt; medicationStatement.note as note then AnnotationComment(section, act, note) "annotation";
  } "2";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists()) then {
    entry.act as act -&gt; medicationStatement as medicationStatement then SubstitutionStatement(act, medicationStatement) "substitution";
  } "1";
}

// source https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
// target: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
// dosage for split dosing, with sequences
group DosageInstructionsEntryDosageChange(source src : substanceAdministration, source entry : entryRelationship, target dosage : Dosage) {
  entry.sequenceNumber as sequenceNumber then {
    sequenceNumber.value as val -&gt; dosage.sequence = val;
  };
  src as src -&gt; dosage as dosage then EffectiveTimeStartEnd(src, dosage) "effectiveTimeStartEnd";
  entry.substanceAdministration as src -&gt; dosage as dosage then EffectiveTimeWhen(src, dosage) "effectiveTimeWhen";
  src.routeCode as routeCode -&gt; dosage.route as route then CECodeableConcept(routeCode, route);
  entry.substanceAdministration as src -&gt; dosage as dosage then DoseQuantity(src, dosage) "doseQuantity";
}

// effective time start &amp; end for dosage
group EffectiveTimeStartEnd(source src : substanceAdministration, target dosage : Dosage) {
  src.effectiveTime : IVL_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime -&gt; repeat.bounds = create('Period') as period then {
        effectiveTime.low as low then {
          low.value as lowDate -&gt; period.start = lowDate "lowDate";
        };
        effectiveTime.high as high then {
          high.value as highDate -&gt; period.end = highDate "highDate";
        };
      } "period";
    } "repeat";
  } "effectiveTime-IVL-TS";
}

// effective time when for dosage
group EffectiveTimeWhen(source src : substanceAdministration, target dosage : Dosage) {
  src.effectiveTime : EIVL_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime.event as event then {
        event.code as code -&gt; repeat.when = code;
      };
    } "repeat";
  } "effectiveTime-EIVL-TS";
  src.effectiveTime : SXPR_TS as effectiveTime -&gt; dosage.timing as timing share sharetiming then {
    effectiveTime -&gt; timing.repeat as repeat then {
      effectiveTime.comp as comp then {
        comp.event as event then {
          event.code as code -&gt; repeat.when = code;
        };
      };
    } "repeat";
  } "effectiveTime-SXPR-TS";
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.41
// target: reasonCode Coding (e.g. http://build.fhir.org/ig/hl7ch/ig/ch-emed/StructureDefinition/ch-emed-medicationstatement)
group TreatmentReasonEntryContentModule(source section : Section, source observation : Observation, target reasonCode : Coding) {
  // extraxt text (Bluthochdruck) from id #mtpc.1.reason in section text &lt;td ID="mtpc.1.reason"&gt;Bluthochdruck&lt;/td&gt;
  observation.text as text then {
    text.data as data -&gt; reasonCode.text = data "level3";
    text.reference as reference then {
      reference.value as value -&gt; reasonCode.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
}

// source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.45
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html
group MTPReferenceEntryContentModule(source entryrelationship, target ext : Extension) {
  entryrelationship -&gt; ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' "url";
  entryrelationship.substanceAdministration as substanceAdministration then {
    substanceAdministration.id as id -&gt; ext.extension as ext then InnerExtensionId(id, ext) "innerExtensionId";
    substanceAdministration.reference as reference then {
      reference.externalDocument as externalDocument then {
        externalDocument.id as id -&gt; ext.extension as ext then InnerExtensionExternalDocumentId(id, ext) "innerExtensionExternalDocumentId";
      };
    } "substanceAdministration";
  } "id";
}

// source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.52
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-dosage-nonstructured.html
group DosageInstructionsNonStructuredEntryContentModule(source section : Section, source entry : Element, target dosage : Dosage) {
  // see MedicationTreatmentPlanItemEntryContentModule
  entry.substanceAdministration as observation then {
    observation.text as text then {
      text.data as data -&gt; dosage.text = data "level3";
      text.reference as reference then {
        reference.value as value -&gt; dosage.extension as ext then NarrativeLink(value, ext) "narrativeLink";
      };
    };
  } "observation";
}

// source: Substitution act Contains 1.3.6.1.4.1.19376.1.9.1.3.9.2 IHE Substitution Act Content Module
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationdispense.html
group SubstitutionDispense(source act : Act, target medicationDispense : MedicationDispense) {
  act -&gt; medicationDispense.substitution as substitution then {
    act -&gt;  substitution.wasSubstituted as wasSubstituted,  wasSubstituted.value = 'true' "wasSubstituted";
    // act.code as code -&gt; substitution.type as type then CECodeableConcept(code, type) "type";
    act.code as actCode -&gt;  substitution.type as type,  type.coding as coding then {
      actCode -&gt;  coding.system as systemCC,  systemCC.value = 'http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution' "system";
      actCode.code as code -&gt;  coding.code as codeCC,  codeCC.value = code;
      actCode.displayName as display -&gt;  coding.display as displayCC,  displayCC.value = display "display";
    } "allowedCC";
  } "substitution";
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.42
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
group DispenseItemEntryContentModule(source section : Section, source src : Supply, source patient : Patient, target medicationDispense : MedicationDispense) {
  // src.templateId as template then TemplateID(template, medicationDispense) "templateId";
  src.id -&gt; medicationDispense.identifier;
  patient -&gt;  medicationDispense.subject = create('Reference') as reference,  reference.reference = ('urn:uuid:' + %patient.id) "patient";
  src -&gt; medicationDispense.status = 'completed' "completed";
  src.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; medicationDispense.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
  src -&gt; medicationDispense.contained = create('Medication') as medication then ManufacturedMaterialEntryContentModuleDispense(src, medicationDispense, medication) "medication";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52')) -&gt; medicationDispense.dosageInstruction as dosage then DosageInstructionsNonStructuredEntryContentModule(section, entry, dosage) "52";
  src.entryRelationship as entryRelationship then {
    entryRelationship.substanceAdministration as substanceAdministration then {
      // dosage for split dosing, as sequences are present there
      substanceAdministration.entryRelationship as entryRelationship where ((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0)) -&gt; medicationDispense.dosageInstruction as dosage then DosageInstructionsEntryDosageChange(substanceAdministration, entryRelationship, dosage) "36";
    };
  };
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists()) -&gt; medicationDispense.extension as ext then MTPReferenceEntryContentModule(entry, ext) "MTPReferenceEntry";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists()) then {
    entry.act as act -&gt; medicationDispense.note as note then AnnotationComment(section, act, note) "annotation";
  } "2";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.2').exists()) then {
    entry.act as act -&gt; medicationDispense as medicationDispense then SubstitutionDispense(act, medicationDispense) "substitution";
  } "2";
}

// dose quantity for dosage (application schema)
group DoseQuantity(source src : substanceAdministration, target dosage : Dosage) {
  src.doseQuantity as doseQuantity -&gt; dosage.doseAndRate as doseAndRate then {
    doseQuantity.value as value -&gt; doseAndRate.dose = create('Quantity') as quantity then {
      value -&gt; quantity.value = value "value";
      doseQuantity.unit as unit -&gt; quantity.code = unit;
      doseQuantity.unit as unit -&gt; quantity.system = ('http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.where(concept.where(code = %unit)).system);
      doseQuantity.unit as unit -&gt; quantity.unit = ('http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.concept.where(code = %unit).display);
    } "quantity";
  };
}

// source: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module (DYNAMIC)
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html
group SubstitutionRequest(source act : Act, target medicationRequest : MedicationRequest) {
  act -&gt; medicationRequest.substitution as substitution then {
    // act.code as code -&gt; substitution.allowed = create('CodeableConcept') as allowedCC then CECodeableConcept(code, allowedCC) "allowedCC";
    act.code as actCode -&gt;  substitution.allowed = create('CodeableConcept') as allowedCC,  allowedCC.coding as coding then {
      actCode -&gt;  coding.system as systemCC,  systemCC.value = 'http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution' "system";
      actCode.code as code -&gt;  coding.code as codeCC,  codeCC.value = code;
      actCode.displayName as display -&gt;  coding.display as displayCC,  displayCC.value = display "display";
    } "allowedCC";
  } "substitutionRequest";
}

// source: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module (DYNAMIC)
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationstatement.html
group SubstitutionStatement(source act : Act, target medicationStatement : MedicationStatement) {
  act -&gt; medicationStatement.extension as ext then {
    act -&gt; ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-substitution' then {
      // act.code as code -&gt; ext.value = create('CodeableConcept') as valueCC then CECodeableConcept(code, valueCC) "valueCC";
      act.code as actCode -&gt;  ext.value = create('CodeableConcept') as valueCC,  valueCC.coding as coding then {
        actCode -&gt;  coding.system as systemCC,  systemCC.value = 'http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution' "system";
        actCode.code as code -&gt;  coding.code as codeCC,  codeCC.value = code;
        actCode.displayName as display -&gt;  coding.display as displayCC,  displayCC.value = display "display";
      } "valueCC";
    } "substitutionExtension";
  } "substitutionStatement";
}

// Number of packages
// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
group PrescribedQuantity(source supply : Supply, target medicationRequest : MedicationRequest) {
  supply.quantity as quantity -&gt;  medicationRequest.dispenseRequest as dispenseRequest,  dispenseRequest.quantity as quant then {
    // IHE-PRE: If the product-element contains package information, the unit attribute is not be present
    quantity.value as value -&gt; quant.value = value;
    // IHE-PRE: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system
    quantity.unit as unit then {
      unit -&gt; quant.unit = unit "unit";
      unit -&gt; quant.system = 'http://unitsofmeasure.org' "ucum";
      unit -&gt; quant.code = unit "code";
    };
  };
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html
group ManufacturedMaterialEntryContentModuleRequest(source src : SubstanceAdministration, target medicationRequest : MedicationRequest, target medication : Medication) {
  src -&gt;  medication.id = 'med',  medicationRequest.medication = create('Reference') as vt,  vt.reference = '#med' "medication";
  src.consumable as consumable then {
    consumable.manufacturedProduct as manufacturedProduct then {
      manufacturedProduct.manufacturedMaterial as manufacturedMaterial then {
        manufacturedMaterial.name as name where asContent.exists() = false -&gt;  medication.code as fhircode,  fhircode.text = (%manufacturedMaterial.name.other) "code";
        manufacturedMaterial.asContent as asContent then {
          asContent.containerPackagedMedicine as containerPackagedMedicine then {
            containerPackagedMedicine.code as code -&gt; medication.code as fhircode share medcode then CECodeableConcept(code, fhircode);
            containerPackagedMedicine.name as name -&gt; medication.code as fhircode share medcode then {
              name -&gt; fhircode.text = (%name.other) "text";
            } "text";
            containerPackagedMedicine.formCode as formCode -&gt; medication.form as form then CECodeableConcept(formCode, form);
            // Package size
            containerPackagedMedicine.capacityQuantity as capacityQuantity -&gt;  medication.amount = create('Ratio') as ratio,  ratio.denominator = create('Quantity') as denominator,  denominator.value = '1',  denominator.unit = 'Package',  denominator.system = 'http://unitsofmeasure.org',  denominator.code = '{Package}',  ratio.numerator = create('Quantity') as quantity then EmedPQQuantity(capacityQuantity, quantity);
          };
        };
        manufacturedMaterial.ingredient as ingredient -&gt; medication.ingredient as ing then {
          ingredient.quantity as quantity -&gt; ing.strength = create('Ratio') as strength then EmedRTOPQPQRatio(quantity, strength) "strength";
          ingredient.ingredient as medingredient then {
            medingredient.code as code -&gt;  ing.item = create('CodeableConcept') as ingcode,  ingcode.text = (%medingredient.name.other) then CECodeableConcept(code, ingcode) "ingredientCode";
          };
        };
      };
    };
    // dosage for normal dosing, as no sequences are present there
    src where $this.entryRelationship.sequenceNumber.exists() = false -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsStartStopFrequency(src, dosage) "dosage";
  };
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.43
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html
group PrescriptionItemEntryContentModule(source section : Section, source src : SubstanceAdministration, source patient : Patient, target medicationRequest : MedicationRequest) {
  src.id -&gt; medicationRequest.identifier;
  patient -&gt;  medicationRequest.subject = create('Reference') as reference,  reference.reference = ('urn:uuid:' + %patient.id) "patient";
  src -&gt; medicationRequest.status = 'completed' "completed";
  src -&gt; medicationRequest.intent = 'order' "order";
  src.text as text then {
    text.reference as reference then {
      reference.value as value -&gt; medicationRequest.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  };
  src -&gt; medicationRequest.contained = create('Medication') as medication then ManufacturedMaterialEntryContentModuleRequest(src, medicationRequest, medication) "medication";
  src.entryRelationship as entry where typeCode = 'RSON' then {
    entry.observation as observation -&gt; medicationRequest.reasonCode as reasonCode then TreatmentReasonEntryContentModule(section, observation, reasonCode) "reasonCode";
  } "41";
  src.entryRelationship as entry where ((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52')) -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsNonStructuredEntryContentModule(section, entry, dosage) "52";
  // dosage for split dosing, as sequences are present there
  src.entryRelationship as entry where ((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0)) -&gt; medicationRequest.dosageInstruction as dosage then DosageInstructionsEntryDosageChange(src, entry, dosage) "36";
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists()) -&gt; medicationRequest.extension as ext then MTPReferenceEntryContentModule(entry, ext) "MTPReferenceEntry";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists()) then {
    entry.act as act -&gt; medicationRequest.note as note then AnnotationComment(section, act, note) "annotation";
  } "2";
  src.repeatNumber as repeatNumber -&gt; medicationRequest.dispenseRequest as dispenseRequest then {
    repeatNumber.value as val -&gt; dispenseRequest.numberOfRepeatsAllowed = val "repeatNumber";
  } "repeats";
  src.entryRelationship as entry where ((typeCode = 'COMP') and supply.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.8').exists()) then {
    entry.supply as supply -&gt; medicationRequest as medicationRequest then PrescribedQuantity(supply, medicationRequest) "quantity";
  } "8";
  src.entryRelationship as entry where ((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists()) then {
    entry.act as act -&gt; medicationRequest as medicationRequest then SubstitutionRequest(act, medicationRequest) "substitution";
  } "1";
}

// source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
// dosage for normal dosing, without sequences
group DosageInstructionsStartStopFrequency(source src : SubstanceAdministration, target dosage : Dosage) {
  src as src -&gt; dosage as dosage then EffectiveTimeStartEnd(src, dosage) "effectiveTimeStartEnd";
  src as src -&gt; dosage as dosage then EffectiveTimeWhen(src, dosage) "effectiveTimeWhen";
  src.routeCode as routeCode -&gt; dosage.route as route then CECodeableConcept(routeCode, route);
  src as src -&gt; dosage as dosage then DoseQuantity(src, dosage) "doseQuantity";
}

// source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.44
// target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-observation.html
group PharmaceuticalAdviceItemEntryContentModule(source section : Section, source src : Observation, source patient : Patient, target observation : Observation, target bundle : Bundle) {
  src.id -&gt; observation.identifier;
  patient -&gt;  observation.subject = create('Reference') as reference,  reference.reference = ('urn:uuid:' + %patient.id) "patient";
  src -&gt; observation.status = 'final' "final";
  src.effectiveTime as effectiveTime -&gt; observation.effective = create('dateTime') as value then TSDateTime(effectiveTime, value) "value";
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists()) -&gt; observation.extension as ext then MTPReferenceEntryContentModule(entry, ext) "MTPReferenceEntry";
  src.entryRelationship as entry where ((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.7').exists()) -&gt;  bundle.entry as e,  e.id = uuid() as uuid,  e.fullUrl = append('urn:uuid:', uuid),  e.resource = create('MedicationStatement') as medicationstatement,  observation.extension as ext,  ext.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-medicationstatement-changed',  ext.value = create('Reference') as reference,  reference.reference = append('urn:uuid:', uuid) then {
    entry.substanceAdministration as substanceAdministration then MedicationTreatmentPlanItemEntryContentModule(section, substanceAdministration, patient, medicationstatement);
  } "cdaEntry";
  src.text as text -&gt; observation.note as note then {
    text.data as data -&gt; note.text = data "level3observation";
    text where (data.exists() = false) -&gt; note.text = (%section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&gt;') - 1)) "idRef";
    text.reference as reference then {
      reference.value as value -&gt; note.extension as ext then NarrativeLink(value, ext) "narrativeLink";
    };
  } "note";
  src.code -&gt; observation.code;
}

// _________________________ Template Type not specified   _________________________
// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html
group InnerExtensionExternalDocumentId(source src, target ext : Extension) {
  src -&gt; ext.url = 'externalDocumentId' "url";
  src -&gt; ext.value = create('Identifier') as id then II(src, id) "value";
}

// target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html
group InnerExtensionId(source src, target ext : Extension) {
  src -&gt; ext.url = 'id' "url";
  src -&gt; ext.value = create('Identifier') as id then II(src, id) "value";
}

</pre>
      </div>
   </text>
   <url value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChEmedToBundle"></url>
   <name value="CdaChEmedToBundle"></name>
   <description value="Medication Entries
2020-10-30 Oliver Egger, copyright ahdis ag, Apache License
CDA-CH-EMED:  https://art-decor.org/art-decor/decor-project--cdachemed-
FHIR CH-EMED: http://fhir.ch/ig/ch-emed/index.html"></description>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument"></url>
      <mode value="source"></mode>
      <alias value="ClinicalDocument"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor"></url>
      <mode value="source"></mode>
      <alias value="AssignedAuthor"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity"></url>
      <mode value="source"></mode>
      <alias value="AssignedEntity"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Author"></url>
      <mode value="source"></mode>
      <alias value="Author"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization"></url>
      <mode value="source"></mode>
      <alias value="CustodianOrganization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/IVL_TS"></url>
      <mode value="source"></mode>
      <alias value="IVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS"></url>
      <mode value="source"></mode>
      <alias value="EIVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Observation"></url>
      <mode value="source"></mode>
      <alias value="Observation"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PatientRole"></url>
      <mode value="source"></mode>
      <alias value="PatientRole"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/RecordTarget"></url>
      <mode value="source"></mode>
      <alias value="RecordTarget"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Section"></url>
      <mode value="source"></mode>
      <alias value="Section"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration"></url>
      <mode value="source"></mode>
      <alias value="SubstanceAdministration"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS"></url>
      <mode value="source"></mode>
      <alias value="SXPR_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Bundle"></url>
      <mode value="target"></mode>
      <alias value="Bundle"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Composition"></url>
      <mode value="produced"></mode>
      <alias value="Composition"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Patient"></url>
      <mode value="produced"></mode>
      <alias value="Patient"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"></url>
      <mode value="produced"></mode>
      <alias value="Practitioner"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Organization"></url>
      <mode value="produced"></mode>
      <alias value="Organization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/MedicationStatement"></url>
      <mode value="produced"></mode>
      <alias value="MedicationStatement"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Dosage"></url>
      <mode value="produced"></mode>
      <alias value="Dosage"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Observation"></url>
      <mode value="produced"></mode>
      <alias value="Observation"></alias>
   </structure>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToFhirTypes"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaToBundle"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/CdaChToBundle"></import>
   <group>
      <name value="AnnotationComment"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.2
target: Annotation note (e.g. http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html)"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="note"></name>
         <type value="Annotation"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="text"></name>
         <source>
            <context value="act"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="level3"></name>
            <source>
               <context value="text"></context>
               <element value="data"></element>
               <variable value="data"></variable>
            </source>
            <target>
               <context value="note"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="data"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="note"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModuleDispense"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="Supply"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationDispense"></name>
         <type value="MedicationDispense"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medication"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="med"></valueString>
            </parameter>
         </target>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="medication"></element>
            <variable value="vt"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="vt"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="#med"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="src"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="medDispQuantity"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="medDispQuantity"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
            <documentation value="IHE-DIS: If the product-element contains package information, the unit attribute is not be present"></documentation>
         </rule>
         <rule>
            <name value="unit"></name>
            <source>
               <context value="quantity"></context>
               <element value="unit"></element>
               <variable value="unit"></variable>
            </source>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="medDispQuantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="unit"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="ucum"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="medDispQuantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://unitsofmeasure.org"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="medDispQuantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="IHE-DIS: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system"></documentation>
         </rule>
         <documentation value="quantity value (number of packages)"></documentation>
      </rule>
      <rule>
         <name value="product"></name>
         <source>
            <context value="src"></context>
            <element value="product"></element>
            <variable value="product"></variable>
         </source>
         <rule>
            <name value="manufacturedProduct"></name>
            <source>
               <context value="product"></context>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </source>
            <rule>
               <name value="manufacturedMaterial"></name>
               <source>
                  <context value="manufacturedProduct"></context>
                  <element value="manufacturedMaterial"></element>
                  <variable value="manufacturedMaterial"></variable>
               </source>
               <rule>
                  <name value="medication.code"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="name"></element>
                     <variable value="name"></variable>
                     <condition value="asContent.exists() = false"></condition>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="fhircode"></variable>
                  </target>
                  <target>
                     <context value="fhircode"></context>
                     <contextType value="variable"></contextType>
                     <element value="text"></element>
                     <transform value="evaluate"></transform>
                     <parameter>
                        <valueString value="%manufacturedMaterial.name.other"></valueString>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="asContent"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="asContent"></element>
                     <variable value="asContent"></variable>
                  </source>
                  <rule>
                     <name value="containerPackagedMedicine"></name>
                     <source>
                        <context value="asContent"></context>
                        <element value="containerPackagedMedicine"></element>
                        <variable value="containerPackagedMedicine"></variable>
                     </source>
                     <rule>
                        <name value="medication.code"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="fhircode"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="code.text"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="name"></element>
                           <variable value="name"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <rule>
                           <name value="medication.code.text"></name>
                           <source>
                              <context value="name"></context>
                           </source>
                           <target>
                              <context value="fhircode"></context>
                              <contextType value="variable"></contextType>
                              <element value="text"></element>
                              <transform value="evaluate"></transform>
                              <parameter>
                                 <valueString value="%name.other"></valueString>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                     <rule>
                        <name value="medication.formCode"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="formCode"></element>
                           <variable value="formCode"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="form"></element>
                           <variable value="form"></variable>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="formCode"></variable>
                           <variable value="form"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="capacityQuantity"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="capacityQuantity"></element>
                           <variable value="capacityQuantity"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="amount"></element>
                           <variable value="ratio"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Ratio"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="denominator"></element>
                           <variable value="denominator"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="value"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="1"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="unit"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="Package"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="system"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="http://unitsofmeasure.org"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="{Package}"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="numerator"></element>
                           <variable value="quantity"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="EmedPQQuantity"></name>
                           <variable value="capacityQuantity"></variable>
                           <variable value="quantity"></variable>
                        </dependent>
                        <documentation value="Package size"></documentation>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="ingredient"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="ingredient"></element>
                     <variable value="ingredient"></variable>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="ingredient"></element>
                     <variable value="ing"></variable>
                  </target>
                  <rule>
                     <name value="strength"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="quantity"></element>
                        <variable value="quantity"></variable>
                     </source>
                     <target>
                        <context value="ing"></context>
                        <contextType value="variable"></contextType>
                        <element value="strength"></element>
                        <variable value="strength"></variable>
                        <transform value="create"></transform>
                        <parameter>
                           <valueString value="Ratio"></valueString>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EmedRTOPQPQRatio"></name>
                        <variable value="quantity"></variable>
                        <variable value="strength"></variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="ingredient.ingredient"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="ingredient"></element>
                        <variable value="medingredient"></variable>
                     </source>
                     <rule>
                        <name value="ingredientCode"></name>
                        <source>
                           <context value="medingredient"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="ing"></context>
                           <contextType value="variable"></contextType>
                           <element value="item"></element>
                           <variable value="ingcode"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="CodeableConcept"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ingcode"></context>
                           <contextType value="variable"></contextType>
                           <element value="text"></element>
                           <transform value="evaluate"></transform>
                           <parameter>
                              <valueString value="%medingredient.name.other"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="ingcode"></variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="entry"></name>
            <source>
               <context value="src"></context>
               <element value="entryRelationship"></element>
               <variable value="entry"></variable>
            </source>
            <rule>
               <name value="substanceAdministration"></name>
               <source>
                  <context value="entry"></context>
                  <element value="substanceAdministration"></element>
                  <variable value="substanceAdministration"></variable>
               </source>
               <rule>
                  <name value="dosage"></name>
                  <source>
                     <context value="substanceAdministration"></context>
                     <condition value="$this.entryRelationship.sequenceNumber.exists() = false"></condition>
                  </source>
                  <target>
                     <context value="medicationDispense"></context>
                     <contextType value="variable"></contextType>
                     <element value="dosageInstruction"></element>
                     <variable value="dosage"></variable>
                  </target>
                  <dependent>
                     <name value="DosageInstructionsStartStopFrequency"></name>
                     <variable value="substanceAdministration"></variable>
                     <variable value="dosage"></variable>
                  </dependent>
               </rule>
            </rule>
            <documentation value="dosage for normal dosing, as no sequences are present there"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EmedPQQuantity"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="PQ"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="tgt"></name>
         <type value="Quantity"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
            <element value="value"></element>
            <variable value="value"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="value"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="unit"></name>
         <source>
            <context value="src"></context>
            <element value="unit"></element>
            <variable value="unit"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="unit"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="unit"></name>
         <source>
            <context value="src"></context>
            <element value="unit"></element>
            <variable value="unit"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="system"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.where(concept.where(code = %unit)).system"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="unit"></name>
         <source>
            <context value="src"></context>
            <element value="unit"></element>
            <variable value="unit"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="unit"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.concept.where(code = %unit).display"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="EmedRTOPQPQRatio"></name>
      <typeMode value="none"></typeMode>
      <input>
         <name value="src"></name>
         <type value="RTO_PQ_PQ"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="tgt"></name>
         <type value="Ratio"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="numerator"></name>
         <source>
            <context value="src"></context>
            <element value="numerator"></element>
            <variable value="numerator"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="numerator"></element>
            <variable value="targetNumerator"></variable>
         </target>
         <dependent>
            <name value="EmedPQQuantity"></name>
            <variable value="numerator"></variable>
            <variable value="targetNumerator"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="denominator"></name>
         <source>
            <context value="src"></context>
            <element value="denominator"></element>
            <variable value="denominator"></variable>
         </source>
         <target>
            <context value="tgt"></context>
            <contextType value="variable"></contextType>
            <element value="denominator"></element>
            <variable value="targetDenominator"></variable>
         </target>
         <dependent>
            <name value="EmedPQQuantity"></name>
            <variable value="denominator"></variable>
            <variable value="targetDenominator"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModuleStatement"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationStatement"></name>
         <type value="MedicationStatement"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medication"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="med"></valueString>
            </parameter>
         </target>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="medication"></element>
            <variable value="vt"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="vt"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="#med"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="src"></context>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </source>
         <rule>
            <name value="manufacturedProduct"></name>
            <source>
               <context value="consumable"></context>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </source>
            <rule>
               <name value="manufacturedMaterial"></name>
               <source>
                  <context value="manufacturedProduct"></context>
                  <element value="manufacturedMaterial"></element>
                  <variable value="manufacturedMaterial"></variable>
               </source>
               <rule>
                  <name value="medication.code"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="name"></element>
                     <variable value="name"></variable>
                     <condition value="asContent.exists() = false"></condition>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="fhircode"></variable>
                  </target>
                  <target>
                     <context value="fhircode"></context>
                     <contextType value="variable"></contextType>
                     <element value="text"></element>
                     <transform value="evaluate"></transform>
                     <parameter>
                        <valueString value="%manufacturedMaterial.name.other"></valueString>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="asContent"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="asContent"></element>
                     <variable value="asContent"></variable>
                  </source>
                  <rule>
                     <name value="containerPackagedMedicine"></name>
                     <source>
                        <context value="asContent"></context>
                        <element value="containerPackagedMedicine"></element>
                        <variable value="containerPackagedMedicine"></variable>
                     </source>
                     <rule>
                        <name value="medication.code"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="fhircode"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="code.text"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="name"></element>
                           <variable value="name"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <rule>
                           <name value="medication.code.text"></name>
                           <source>
                              <context value="name"></context>
                           </source>
                           <target>
                              <context value="fhircode"></context>
                              <contextType value="variable"></contextType>
                              <element value="text"></element>
                              <transform value="evaluate"></transform>
                              <parameter>
                                 <valueString value="%name.other"></valueString>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                     <rule>
                        <name value="medication.formCode"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="formCode"></element>
                           <variable value="formCode"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="form"></element>
                           <variable value="form"></variable>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="formCode"></variable>
                           <variable value="form"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="capacityQuantity"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="capacityQuantity"></element>
                           <variable value="capacityQuantity"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="amount"></element>
                           <variable value="ratio"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Ratio"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="denominator"></element>
                           <variable value="denominator"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="value"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="1"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="unit"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="Package"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="system"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="http://unitsofmeasure.org"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="{Package}"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="numerator"></element>
                           <variable value="quantity"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="EmedPQQuantity"></name>
                           <variable value="capacityQuantity"></variable>
                           <variable value="quantity"></variable>
                        </dependent>
                        <documentation value="Package size"></documentation>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="ingredient"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="ingredient"></element>
                     <variable value="ingredient"></variable>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="ingredient"></element>
                     <variable value="ing"></variable>
                  </target>
                  <rule>
                     <name value="strength"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="quantity"></element>
                        <variable value="quantity"></variable>
                     </source>
                     <target>
                        <context value="ing"></context>
                        <contextType value="variable"></contextType>
                        <element value="strength"></element>
                        <variable value="strength"></variable>
                        <transform value="create"></transform>
                        <parameter>
                           <valueString value="Ratio"></valueString>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EmedRTOPQPQRatio"></name>
                        <variable value="quantity"></variable>
                        <variable value="strength"></variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="ingredient.ingredient"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="ingredient"></element>
                        <variable value="medingredient"></variable>
                     </source>
                     <rule>
                        <name value="ingredientCode"></name>
                        <source>
                           <context value="medingredient"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="ing"></context>
                           <contextType value="variable"></contextType>
                           <element value="item"></element>
                           <variable value="ingcode"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="CodeableConcept"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ingcode"></context>
                           <contextType value="variable"></contextType>
                           <element value="text"></element>
                           <transform value="evaluate"></transform>
                           <parameter>
                              <valueString value="%medingredient.name.other"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="ingcode"></variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="dosage"></name>
            <source>
               <context value="src"></context>
               <condition value="$this.entryRelationship.sequenceNumber.exists() = false"></condition>
            </source>
            <target>
               <context value="medicationStatement"></context>
               <contextType value="variable"></contextType>
               <element value="dosage"></element>
               <variable value="dosage"></variable>
            </target>
            <dependent>
               <name value="DosageInstructionsStartStopFrequency"></name>
               <variable value="src"></variable>
               <variable value="dosage"></variable>
            </dependent>
            <documentation value="dosage for normal dosing, as no sequences are present there"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="MedicationTreatmentPlanItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.34
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationStatement"></name>
         <type value="MedicationStatement"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="id"></name>
         <source>
            <context value="src"></context>
            <element value="id"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="identifier"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
         <documentation value="src.templateId as template then TemplateID(template, medicationStatement) &quot;templateId&quot;;"></documentation>
      </rule>
      <rule>
         <name value="patient"></name>
         <source>
            <context value="patient"></context>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="subject"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %patient.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="completed"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="status"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="src"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="medicationStatement"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Medication"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="ManufacturedMaterialEntryContentModuleStatement"></name>
            <variable value="src"></variable>
            <variable value="medicationStatement"></variable>
            <variable value="medication"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.41"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="typeCode = 'RSON'"></condition>
         </source>
         <rule>
            <name value="reasonCode"></name>
            <source>
               <context value="entry"></context>
               <element value="observation"></element>
               <variable value="observation"></variable>
            </source>
            <target>
               <context value="medicationStatement"></context>
               <contextType value="variable"></contextType>
               <element value="reasonCode"></element>
               <variable value="reasonCode"></variable>
            </target>
            <dependent>
               <name value="TreatmentReasonEntryContentModule"></name>
               <variable value="section"></variable>
               <variable value="observation"></variable>
               <variable value="reasonCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.52"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52'))"></condition>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="dosage"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="section"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.36"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0))"></condition>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="dosage"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryDosageChange"></name>
            <variable value="src"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="MTPReferenceEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists())"></condition>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="entry"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.2"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists())"></condition>
         </source>
         <rule>
            <name value="annotation"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <context value="medicationStatement"></context>
               <contextType value="variable"></contextType>
               <element value="note"></element>
               <variable value="note"></variable>
            </target>
            <dependent>
               <name value="AnnotationComment"></name>
               <variable value="section"></variable>
               <variable value="act"></variable>
               <variable value="note"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.9.1"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists())"></condition>
         </source>
         <rule>
            <name value="substitution"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <variable value="medicationStatement"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationStatement"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="SubstitutionStatement"></name>
               <variable value="act"></variable>
               <variable value="medicationStatement"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryDosageChange"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
target: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
dosage for split dosing, with sequences"></documentation>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="entryRelationship"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="sequenceNumber"></name>
         <source>
            <context value="entry"></context>
            <element value="sequenceNumber"></element>
            <variable value="sequenceNumber"></variable>
         </source>
         <rule>
            <name value="value"></name>
            <source>
               <context value="sequenceNumber"></context>
               <element value="value"></element>
               <variable value="val"></variable>
            </source>
            <target>
               <context value="dosage"></context>
               <contextType value="variable"></contextType>
               <element value="sequence"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="val"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="effectiveTimeWhen"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeWhen"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="routeCode"></name>
         <source>
            <context value="src"></context>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="route"></element>
            <variable value="route"></variable>
         </target>
         <dependent>
            <name value="CECodeableConcept"></name>
            <variable value="routeCode"></variable>
            <variable value="route"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="DoseQuantity"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeStartEnd"></name>
      <typeMode value="none"></typeMode>
      <documentation value="effective time start &amp; end for dosage"></documentation>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="effectiveTime-IVL-TS"></name>
         <source>
            <context value="src"></context>
            <type value="IVL_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="period"></name>
               <source>
                  <context value="effectiveTime"></context>
               </source>
               <target>
                  <context value="repeat"></context>
                  <contextType value="variable"></contextType>
                  <element value="bounds"></element>
                  <variable value="period"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="Period"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="low"></name>
                  <source>
                     <context value="effectiveTime"></context>
                     <element value="low"></element>
                     <variable value="low"></variable>
                  </source>
                  <rule>
                     <name value="lowDate"></name>
                     <source>
                        <context value="low"></context>
                        <element value="value"></element>
                        <variable value="lowDate"></variable>
                     </source>
                     <target>
                        <context value="period"></context>
                        <contextType value="variable"></contextType>
                        <element value="start"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="lowDate"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="high"></name>
                  <source>
                     <context value="effectiveTime"></context>
                     <element value="high"></element>
                     <variable value="high"></variable>
                  </source>
                  <rule>
                     <name value="highDate"></name>
                     <source>
                        <context value="high"></context>
                        <element value="value"></element>
                        <variable value="highDate"></variable>
                     </source>
                     <target>
                        <context value="period"></context>
                        <contextType value="variable"></contextType>
                        <element value="end"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="highDate"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeWhen"></name>
      <typeMode value="none"></typeMode>
      <documentation value="effective time when for dosage"></documentation>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="effectiveTime-EIVL-TS"></name>
         <source>
            <context value="src"></context>
            <type value="EIVL_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="event"></name>
               <source>
                  <context value="effectiveTime"></context>
                  <element value="event"></element>
                  <variable value="event"></variable>
               </source>
               <rule>
                  <name value="code"></name>
                  <source>
                     <context value="event"></context>
                     <element value="code"></element>
                     <variable value="code"></variable>
                  </source>
                  <target>
                     <context value="repeat"></context>
                     <contextType value="variable"></contextType>
                     <element value="when"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="code"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="effectiveTime-SXPR-TS"></name>
         <source>
            <context value="src"></context>
            <type value="SXPR_TS"></type>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="timing"></element>
            <variable value="timing"></variable>
            <listMode value="share"></listMode>
            <listRuleId value="sharetiming"></listRuleId>
         </target>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="effectiveTime"></context>
            </source>
            <target>
               <context value="timing"></context>
               <contextType value="variable"></contextType>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </target>
            <rule>
               <name value="comp"></name>
               <source>
                  <context value="effectiveTime"></context>
                  <element value="comp"></element>
                  <variable value="comp"></variable>
               </source>
               <rule>
                  <name value="event"></name>
                  <source>
                     <context value="comp"></context>
                     <element value="event"></element>
                     <variable value="event"></variable>
                  </source>
                  <rule>
                     <name value="code"></name>
                     <source>
                        <context value="event"></context>
                        <element value="code"></element>
                        <variable value="code"></variable>
                     </source>
                     <target>
                        <context value="repeat"></context>
                        <contextType value="variable"></contextType>
                        <element value="when"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="code"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="TreatmentReasonEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.41
target: reasonCode Coding (e.g. http://build.fhir.org/ig/hl7ch/ig/ch-emed/StructureDefinition/ch-emed-medicationstatement)"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="observation"></name>
         <type value="Observation"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="reasonCode"></name>
         <type value="Coding"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="text"></name>
         <source>
            <context value="observation"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="level3"></name>
            <source>
               <context value="text"></context>
               <element value="data"></element>
               <variable value="data"></variable>
            </source>
            <target>
               <context value="reasonCode"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="data"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="reasonCode"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
         <documentation value="extraxt text (Bluthochdruck) from id #mtpc.1.reason in section text &lt;td ID=&quot;mtpc.1.reason&quot;&gt;Bluthochdruck&lt;/td&gt;"></documentation>
      </rule>
   </group>
   <group>
      <name value="MTPReferenceEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.45
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html"></documentation>
      <input>
         <name value="entryrelationship"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="entryrelationship"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="entryrelationship"></context>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </source>
         <rule>
            <name value="innerExtensionId"></name>
            <source>
               <context value="substanceAdministration"></context>
               <element value="id"></element>
               <variable value="id"></variable>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="extension"></element>
               <variable value="ext"></variable>
            </target>
            <dependent>
               <name value="InnerExtensionId"></name>
               <variable value="id"></variable>
               <variable value="ext"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="substanceAdministration"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="externalDocument"></name>
               <source>
                  <context value="reference"></context>
                  <element value="externalDocument"></element>
                  <variable value="externalDocument"></variable>
               </source>
               <rule>
                  <name value="innerExtensionExternalDocumentId"></name>
                  <source>
                     <context value="externalDocument"></context>
                     <element value="id"></element>
                     <variable value="id"></variable>
                  </source>
                  <target>
                     <context value="ext"></context>
                     <contextType value="variable"></contextType>
                     <element value="extension"></element>
                     <variable value="ext"></variable>
                  </target>
                  <dependent>
                     <name value="InnerExtensionExternalDocumentId"></name>
                     <variable value="id"></variable>
                     <variable value="ext"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.52
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-dosage-nonstructured.html"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="Element"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="observation"></name>
         <source>
            <context value="entry"></context>
            <element value="substanceAdministration"></element>
            <variable value="observation"></variable>
         </source>
         <rule>
            <name value="text"></name>
            <source>
               <context value="observation"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <rule>
               <name value="level3"></name>
               <source>
                  <context value="text"></context>
                  <element value="data"></element>
                  <variable value="data"></variable>
               </source>
               <target>
                  <context value="dosage"></context>
                  <contextType value="variable"></contextType>
                  <element value="text"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="data"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="text"></context>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </source>
               <rule>
                  <name value="narrativeLink"></name>
                  <source>
                     <context value="reference"></context>
                     <element value="value"></element>
                     <variable value="value"></variable>
                  </source>
                  <target>
                     <context value="dosage"></context>
                     <contextType value="variable"></contextType>
                     <element value="extension"></element>
                     <variable value="ext"></variable>
                  </target>
                  <dependent>
                     <name value="NarrativeLink"></name>
                     <variable value="value"></variable>
                     <variable value="ext"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
         <documentation value="see MedicationTreatmentPlanItemEntryContentModule"></documentation>
      </rule>
   </group>
   <group>
      <name value="SubstitutionDispense"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: Substitution act Contains 1.3.6.1.4.1.19376.1.9.1.3.9.2 IHE Substitution Act Content Module
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationdispense.html"></documentation>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationDispense"></name>
         <type value="MedicationDispense"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="substitution"></name>
         <source>
            <context value="act"></context>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="substitution"></element>
            <variable value="substitution"></variable>
         </target>
         <rule>
            <name value="wasSubstituted"></name>
            <source>
               <context value="act"></context>
            </source>
            <target>
               <context value="substitution"></context>
               <contextType value="variable"></contextType>
               <element value="wasSubstituted"></element>
               <variable value="wasSubstituted"></variable>
            </target>
            <target>
               <context value="wasSubstituted"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="true"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="allowedCC"></name>
            <source>
               <context value="act"></context>
               <element value="code"></element>
               <variable value="actCode"></variable>
            </source>
            <target>
               <context value="substitution"></context>
               <contextType value="variable"></contextType>
               <element value="type"></element>
               <variable value="type"></variable>
            </target>
            <target>
               <context value="type"></context>
               <contextType value="variable"></contextType>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </target>
            <rule>
               <name value="system"></name>
               <source>
                  <context value="actCode"></context>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <variable value="systemCC"></variable>
               </target>
               <target>
                  <context value="systemCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="code"></element>
                  <variable value="code"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <variable value="codeCC"></variable>
               </target>
               <target>
                  <context value="codeCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="code"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="display"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="displayName"></element>
                  <variable value="display"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="display"></element>
                  <variable value="displayCC"></variable>
               </target>
               <target>
                  <context value="displayCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="display"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="act.code as code -&gt; substitution.type as type then CECodeableConcept(code, type) &quot;type&quot;;"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DispenseItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.42
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="src"></name>
         <type value="Supply"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationDispense"></name>
         <type value="MedicationDispense"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="id"></name>
         <source>
            <context value="src"></context>
            <element value="id"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="identifier"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
         <documentation value="src.templateId as template then TemplateID(template, medicationDispense) &quot;templateId&quot;;"></documentation>
      </rule>
      <rule>
         <name value="patient"></name>
         <source>
            <context value="patient"></context>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="subject"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %patient.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="completed"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="status"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="src"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="medicationDispense"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Medication"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="ManufacturedMaterialEntryContentModuleDispense"></name>
            <variable value="src"></variable>
            <variable value="medicationDispense"></variable>
            <variable value="medication"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.52"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52'))"></condition>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="section"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationship"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </source>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="entryRelationship"></context>
               <element value="substanceAdministration"></element>
               <variable value="substanceAdministration"></variable>
            </source>
            <rule>
               <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.36"></name>
               <source>
                  <context value="substanceAdministration"></context>
                  <element value="entryRelationship"></element>
                  <variable value="entryRelationship"></variable>
                  <condition value="((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0))"></condition>
               </source>
               <target>
                  <context value="medicationDispense"></context>
                  <contextType value="variable"></contextType>
                  <element value="dosageInstruction"></element>
                  <variable value="dosage"></variable>
               </target>
               <dependent>
                  <name value="DosageInstructionsEntryDosageChange"></name>
                  <variable value="substanceAdministration"></variable>
                  <variable value="entryRelationship"></variable>
                  <variable value="dosage"></variable>
               </dependent>
               <documentation value="dosage for split dosing, as sequences are present there"></documentation>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="MTPReferenceEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists())"></condition>
         </source>
         <target>
            <context value="medicationDispense"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="entry"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.2"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists())"></condition>
         </source>
         <rule>
            <name value="annotation"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <context value="medicationDispense"></context>
               <contextType value="variable"></contextType>
               <element value="note"></element>
               <variable value="note"></variable>
            </target>
            <dependent>
               <name value="AnnotationComment"></name>
               <variable value="section"></variable>
               <variable value="act"></variable>
               <variable value="note"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.9.2"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.2').exists())"></condition>
         </source>
         <rule>
            <name value="substitution"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <variable value="medicationDispense"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationDispense"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="SubstitutionDispense"></name>
               <variable value="act"></variable>
               <variable value="medicationDispense"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DoseQuantity"></name>
      <typeMode value="none"></typeMode>
      <documentation value="dose quantity for dosage (application schema)"></documentation>
      <input>
         <name value="src"></name>
         <type value="substanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="src"></context>
            <element value="doseQuantity"></element>
            <variable value="doseQuantity"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="doseAndRate"></element>
            <variable value="doseAndRate"></variable>
         </target>
         <rule>
            <name value="quantity"></name>
            <source>
               <context value="doseQuantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="doseAndRate"></context>
               <contextType value="variable"></contextType>
               <element value="dose"></element>
               <variable value="quantity"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="Quantity"></valueString>
               </parameter>
            </target>
            <rule>
               <name value="value"></name>
               <source>
                  <context value="value"></context>
               </source>
               <target>
                  <context value="quantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="value"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="doseQuantity"></context>
                  <element value="unit"></element>
                  <variable value="unit"></variable>
               </source>
               <target>
                  <context value="quantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="doseQuantity"></context>
                  <element value="unit"></element>
                  <variable value="unit"></variable>
               </source>
               <target>
                  <context value="quantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <transform value="evaluate"></transform>
                  <parameter>
                     <valueString value="'http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.where(concept.where(code = %unit)).system"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="doseQuantity"></context>
                  <element value="unit"></element>
                  <variable value="unit"></variable>
               </source>
               <target>
                  <context value="quantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="unit"></element>
                  <transform value="evaluate"></transform>
                  <parameter>
                     <valueString value="'http://fhir.ch/ig/ch-emed/ValueSet/UnitCode'.resolve().compose.include.concept.where(code = %unit).display"></valueString>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="SubstitutionRequest"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module (DYNAMIC)
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html"></documentation>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="substitutionRequest"></name>
         <source>
            <context value="act"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="substitution"></element>
            <variable value="substitution"></variable>
         </target>
         <rule>
            <name value="allowedCC"></name>
            <source>
               <context value="act"></context>
               <element value="code"></element>
               <variable value="actCode"></variable>
            </source>
            <target>
               <context value="substitution"></context>
               <contextType value="variable"></contextType>
               <element value="allowed"></element>
               <variable value="allowedCC"></variable>
               <transform value="create"></transform>
               <parameter>
                  <valueString value="CodeableConcept"></valueString>
               </parameter>
            </target>
            <target>
               <context value="allowedCC"></context>
               <contextType value="variable"></contextType>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </target>
            <rule>
               <name value="system"></name>
               <source>
                  <context value="actCode"></context>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <variable value="systemCC"></variable>
               </target>
               <target>
                  <context value="systemCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="code"></element>
                  <variable value="code"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <variable value="codeCC"></variable>
               </target>
               <target>
                  <context value="codeCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="code"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="display"></name>
               <source>
                  <context value="actCode"></context>
                  <element value="displayName"></element>
                  <variable value="display"></variable>
               </source>
               <target>
                  <context value="coding"></context>
                  <contextType value="variable"></contextType>
                  <element value="display"></element>
                  <variable value="displayCC"></variable>
               </target>
               <target>
                  <context value="displayCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="display"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="act.code as code -&gt; substitution.allowed = create('CodeableConcept') as allowedCC then CECodeableConcept(code, allowedCC) &quot;allowedCC&quot;;"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="SubstitutionStatement"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module (DYNAMIC)
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationstatement.html"></documentation>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationStatement"></name>
         <type value="MedicationStatement"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="substitutionStatement"></name>
         <source>
            <context value="act"></context>
         </source>
         <target>
            <context value="medicationStatement"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <rule>
            <name value="substitutionExtension"></name>
            <source>
               <context value="act"></context>
            </source>
            <target>
               <context value="ext"></context>
               <contextType value="variable"></contextType>
               <element value="url"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-substitution"></valueString>
               </parameter>
            </target>
            <rule>
               <name value="valueCC"></name>
               <source>
                  <context value="act"></context>
                  <element value="code"></element>
                  <variable value="actCode"></variable>
               </source>
               <target>
                  <context value="ext"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <variable value="valueCC"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="CodeableConcept"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="valueCC"></context>
                  <contextType value="variable"></contextType>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </target>
               <rule>
                  <name value="system"></name>
                  <source>
                     <context value="actCode"></context>
                  </source>
                  <target>
                     <context value="coding"></context>
                     <contextType value="variable"></contextType>
                     <element value="system"></element>
                     <variable value="systemCC"></variable>
                  </target>
                  <target>
                     <context value="systemCC"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueString value="http://terminology.hl7.org/CodeSystem/v3-substanceAdminSubstitution"></valueString>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="code"></name>
                  <source>
                     <context value="actCode"></context>
                     <element value="code"></element>
                     <variable value="code"></variable>
                  </source>
                  <target>
                     <context value="coding"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="codeCC"></variable>
                  </target>
                  <target>
                     <context value="codeCC"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="code"></valueId>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="display"></name>
                  <source>
                     <context value="actCode"></context>
                     <element value="displayName"></element>
                     <variable value="display"></variable>
                  </source>
                  <target>
                     <context value="coding"></context>
                     <contextType value="variable"></contextType>
                     <element value="display"></element>
                     <variable value="displayCC"></variable>
                  </target>
                  <target>
                     <context value="displayCC"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="display"></valueId>
                     </parameter>
                  </target>
               </rule>
               <documentation value="act.code as code -&gt; ext.value = create('CodeableConcept') as valueCC then CECodeableConcept(code, valueCC) &quot;valueCC&quot;;"></documentation>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="PrescribedQuantity"></name>
      <typeMode value="none"></typeMode>
      <documentation value="Number of packages
source: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html"></documentation>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="supply"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dispenseRequest"></element>
            <variable value="dispenseRequest"></variable>
         </target>
         <target>
            <context value="dispenseRequest"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="quant"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="quant"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
            <documentation value="IHE-PRE: If the product-element contains package information, the unit attribute is not be present"></documentation>
         </rule>
         <rule>
            <name value="unit"></name>
            <source>
               <context value="quantity"></context>
               <element value="unit"></element>
               <variable value="unit"></variable>
            </source>
            <rule>
               <name value="unit"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="unit"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="ucum"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="system"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="http://unitsofmeasure.org"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="unit"></context>
               </source>
               <target>
                  <context value="quant"></context>
                  <contextType value="variable"></contextType>
                  <element value="code"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="unit"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="IHE-PRE: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModuleRequest"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html"></documentation>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medication"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="med"></valueString>
            </parameter>
         </target>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="medication"></element>
            <variable value="vt"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="vt"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="#med"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="src"></context>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </source>
         <rule>
            <name value="manufacturedProduct"></name>
            <source>
               <context value="consumable"></context>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </source>
            <rule>
               <name value="manufacturedMaterial"></name>
               <source>
                  <context value="manufacturedProduct"></context>
                  <element value="manufacturedMaterial"></element>
                  <variable value="manufacturedMaterial"></variable>
               </source>
               <rule>
                  <name value="medication.code"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="name"></element>
                     <variable value="name"></variable>
                     <condition value="asContent.exists() = false"></condition>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="fhircode"></variable>
                  </target>
                  <target>
                     <context value="fhircode"></context>
                     <contextType value="variable"></contextType>
                     <element value="text"></element>
                     <transform value="evaluate"></transform>
                     <parameter>
                        <valueString value="%manufacturedMaterial.name.other"></valueString>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="asContent"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="asContent"></element>
                     <variable value="asContent"></variable>
                  </source>
                  <rule>
                     <name value="containerPackagedMedicine"></name>
                     <source>
                        <context value="asContent"></context>
                        <element value="containerPackagedMedicine"></element>
                        <variable value="containerPackagedMedicine"></variable>
                     </source>
                     <rule>
                        <name value="medication.code"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="fhircode"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="code.text"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="name"></element>
                           <variable value="name"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <variable value="fhircode"></variable>
                           <listMode value="share"></listMode>
                           <listRuleId value="medcode"></listRuleId>
                        </target>
                        <rule>
                           <name value="medication.code.text"></name>
                           <source>
                              <context value="name"></context>
                           </source>
                           <target>
                              <context value="fhircode"></context>
                              <contextType value="variable"></contextType>
                              <element value="text"></element>
                              <transform value="evaluate"></transform>
                              <parameter>
                                 <valueString value="%name.other"></valueString>
                              </parameter>
                           </target>
                        </rule>
                     </rule>
                     <rule>
                        <name value="medication.formCode"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="formCode"></element>
                           <variable value="formCode"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="form"></element>
                           <variable value="form"></variable>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="formCode"></variable>
                           <variable value="form"></variable>
                        </dependent>
                     </rule>
                     <rule>
                        <name value="capacityQuantity"></name>
                        <source>
                           <context value="containerPackagedMedicine"></context>
                           <element value="capacityQuantity"></element>
                           <variable value="capacityQuantity"></variable>
                        </source>
                        <target>
                           <context value="medication"></context>
                           <contextType value="variable"></contextType>
                           <element value="amount"></element>
                           <variable value="ratio"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Ratio"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="denominator"></element>
                           <variable value="denominator"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="value"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="1"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="unit"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="Package"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="system"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="http://unitsofmeasure.org"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="denominator"></context>
                           <contextType value="variable"></contextType>
                           <element value="code"></element>
                           <transform value="copy"></transform>
                           <parameter>
                              <valueString value="{Package}"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ratio"></context>
                           <contextType value="variable"></contextType>
                           <element value="numerator"></element>
                           <variable value="quantity"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="Quantity"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="EmedPQQuantity"></name>
                           <variable value="capacityQuantity"></variable>
                           <variable value="quantity"></variable>
                        </dependent>
                        <documentation value="Package size"></documentation>
                     </rule>
                  </rule>
               </rule>
               <rule>
                  <name value="ingredient"></name>
                  <source>
                     <context value="manufacturedMaterial"></context>
                     <element value="ingredient"></element>
                     <variable value="ingredient"></variable>
                  </source>
                  <target>
                     <context value="medication"></context>
                     <contextType value="variable"></contextType>
                     <element value="ingredient"></element>
                     <variable value="ing"></variable>
                  </target>
                  <rule>
                     <name value="strength"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="quantity"></element>
                        <variable value="quantity"></variable>
                     </source>
                     <target>
                        <context value="ing"></context>
                        <contextType value="variable"></contextType>
                        <element value="strength"></element>
                        <variable value="strength"></variable>
                        <transform value="create"></transform>
                        <parameter>
                           <valueString value="Ratio"></valueString>
                        </parameter>
                     </target>
                     <dependent>
                        <name value="EmedRTOPQPQRatio"></name>
                        <variable value="quantity"></variable>
                        <variable value="strength"></variable>
                     </dependent>
                  </rule>
                  <rule>
                     <name value="ingredient.ingredient"></name>
                     <source>
                        <context value="ingredient"></context>
                        <element value="ingredient"></element>
                        <variable value="medingredient"></variable>
                     </source>
                     <rule>
                        <name value="ingredientCode"></name>
                        <source>
                           <context value="medingredient"></context>
                           <element value="code"></element>
                           <variable value="code"></variable>
                        </source>
                        <target>
                           <context value="ing"></context>
                           <contextType value="variable"></contextType>
                           <element value="item"></element>
                           <variable value="ingcode"></variable>
                           <transform value="create"></transform>
                           <parameter>
                              <valueString value="CodeableConcept"></valueString>
                           </parameter>
                        </target>
                        <target>
                           <context value="ingcode"></context>
                           <contextType value="variable"></contextType>
                           <element value="text"></element>
                           <transform value="evaluate"></transform>
                           <parameter>
                              <valueString value="%medingredient.name.other"></valueString>
                           </parameter>
                        </target>
                        <dependent>
                           <name value="CECodeableConcept"></name>
                           <variable value="code"></variable>
                           <variable value="ingcode"></variable>
                        </dependent>
                     </rule>
                  </rule>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="dosage"></name>
            <source>
               <context value="src"></context>
               <condition value="$this.entryRelationship.sequenceNumber.exists() = false"></condition>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="dosageInstruction"></element>
               <variable value="dosage"></variable>
            </target>
            <dependent>
               <name value="DosageInstructionsStartStopFrequency"></name>
               <variable value="src"></variable>
               <variable value="dosage"></variable>
            </dependent>
            <documentation value="dosage for normal dosing, as no sequences are present there"></documentation>
         </rule>
      </rule>
   </group>
   <group>
      <name value="PrescriptionItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.43
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-medicationrequest.html"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="id"></name>
         <source>
            <context value="src"></context>
            <element value="id"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="identifier"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
      </rule>
      <rule>
         <name value="patient"></name>
         <source>
            <context value="patient"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="subject"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %patient.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="completed"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="status"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="order"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="intent"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="order"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="src"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="medicationRequest"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="medication"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Medication"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="ManufacturedMaterialEntryContentModuleRequest"></name>
            <variable value="src"></variable>
            <variable value="medicationRequest"></variable>
            <variable value="medication"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.41"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="typeCode = 'RSON'"></condition>
         </source>
         <rule>
            <name value="reasonCode"></name>
            <source>
               <context value="entry"></context>
               <element value="observation"></element>
               <variable value="observation"></variable>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="reasonCode"></element>
               <variable value="reasonCode"></variable>
            </target>
            <dependent>
               <name value="TreatmentReasonEntryContentModule"></name>
               <variable value="section"></variable>
               <variable value="observation"></variable>
               <variable value="reasonCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.52"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (substanceAdministration.templateId.root = '2.16.756.5.30.1.1.10.4.52'))"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="section"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.36"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and (sequenceNumber.value &gt;= 0))"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryDosageChange"></name>
            <variable value="src"></variable>
            <variable value="entry"></variable>
            <variable value="dosage"></variable>
         </dependent>
         <documentation value="dosage for split dosing, as sequences are present there"></documentation>
      </rule>
      <rule>
         <name value="MTPReferenceEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists())"></condition>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="entry"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="entryRelationShip-2.16.756.5.30.1.1.10.4.2"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '2.16.756.5.30.1.1.10.4.2').exists())"></condition>
         </source>
         <rule>
            <name value="annotation"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <context value="medicationRequest"></context>
               <contextType value="variable"></contextType>
               <element value="note"></element>
               <variable value="note"></variable>
            </target>
            <dependent>
               <name value="AnnotationComment"></name>
               <variable value="section"></variable>
               <variable value="act"></variable>
               <variable value="note"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="repeats"></name>
         <source>
            <context value="src"></context>
            <element value="repeatNumber"></element>
            <variable value="repeatNumber"></variable>
         </source>
         <target>
            <context value="medicationRequest"></context>
            <contextType value="variable"></contextType>
            <element value="dispenseRequest"></element>
            <variable value="dispenseRequest"></variable>
         </target>
         <rule>
            <name value="repeatNumber"></name>
            <source>
               <context value="repeatNumber"></context>
               <element value="value"></element>
               <variable value="val"></variable>
            </source>
            <target>
               <context value="dispenseRequest"></context>
               <contextType value="variable"></contextType>
               <element value="numberOfRepeatsAllowed"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="val"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.8"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and supply.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.8').exists())"></condition>
         </source>
         <rule>
            <name value="quantity"></name>
            <source>
               <context value="entry"></context>
               <element value="supply"></element>
               <variable value="supply"></variable>
            </source>
            <target>
               <variable value="medicationRequest"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationRequest"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="PrescribedQuantity"></name>
               <variable value="supply"></variable>
               <variable value="medicationRequest"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="entryRelationShip-1.3.6.1.4.1.19376.1.9.1.3.9.1"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'COMP') and act.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.9.1').exists())"></condition>
         </source>
         <rule>
            <name value="substitution"></name>
            <source>
               <context value="entry"></context>
               <element value="act"></element>
               <variable value="act"></variable>
            </source>
            <target>
               <variable value="medicationRequest"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="medicationRequest"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="SubstitutionRequest"></name>
               <variable value="act"></variable>
               <variable value="medicationRequest"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsStartStopFrequency"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
dosage for normal dosing, without sequences"></documentation>
      <input>
         <name value="src"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="effectiveTimeWhen"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeWhen"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="routeCode"></name>
         <source>
            <context value="src"></context>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </source>
         <target>
            <context value="dosage"></context>
            <contextType value="variable"></contextType>
            <element value="route"></element>
            <variable value="route"></variable>
         </target>
         <dependent>
            <name value="CECodeableConcept"></name>
            <variable value="routeCode"></variable>
            <variable value="route"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="src"></context>
            <variable value="src"></variable>
         </source>
         <target>
            <variable value="dosage"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="dosage"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="DoseQuantity"></name>
            <variable value="src"></variable>
            <variable value="dosage"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="PharmaceuticalAdviceItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.44
target: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-observation.html"></documentation>
      <input>
         <name value="section"></name>
         <type value="Section"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="src"></name>
         <type value="Observation"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="patient"></name>
         <type value="Patient"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="observation"></name>
         <type value="Observation"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="id"></name>
         <source>
            <context value="src"></context>
            <element value="id"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="identifier"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
      </rule>
      <rule>
         <name value="patient"></name>
         <source>
            <context value="patient"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="subject"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="evaluate"></transform>
            <parameter>
               <valueString value="'urn:uuid:' + %patient.id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="final"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="status"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="final"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="effective"></element>
            <variable value="value"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="dateTime"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="TSDateTime"></name>
            <variable value="effectiveTime"></variable>
            <variable value="value"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="MTPReferenceEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.10').exists())"></condition>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="entry"></variable>
            <variable value="ext"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="cdaEntry"></name>
         <source>
            <context value="src"></context>
            <element value="entryRelationship"></element>
            <variable value="entry"></variable>
            <condition value="((typeCode = 'REFR') and substanceAdministration.templateId.where(root = '1.3.6.1.4.1.19376.1.9.1.3.7').exists())"></condition>
         </source>
         <target>
            <context value="bundle"></context>
            <contextType value="variable"></contextType>
            <element value="entry"></element>
            <variable value="e"></variable>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="uuid"></variable>
            <transform value="uuid"></transform>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="fullUrl"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <target>
            <context value="e"></context>
            <contextType value="variable"></contextType>
            <element value="resource"></element>
            <variable value="medicationstatement"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="MedicationStatement"></valueString>
            </parameter>
         </target>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="extension"></element>
            <variable value="ext"></variable>
         </target>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-medicationstatement-changed"></valueString>
            </parameter>
         </target>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="reference"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Reference"></valueString>
            </parameter>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <transform value="append"></transform>
            <parameter>
               <valueString value="urn:uuid:"></valueString>
            </parameter>
            <parameter>
               <valueId value="uuid"></valueId>
            </parameter>
         </target>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="entry"></context>
               <element value="substanceAdministration"></element>
               <variable value="substanceAdministration"></variable>
            </source>
            <dependent>
               <name value="MedicationTreatmentPlanItemEntryContentModule"></name>
               <variable value="section"></variable>
               <variable value="substanceAdministration"></variable>
               <variable value="patient"></variable>
               <variable value="medicationstatement"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="note"></name>
         <source>
            <context value="src"></context>
            <element value="text"></element>
            <variable value="text"></variable>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="note"></element>
            <variable value="note"></variable>
         </target>
         <rule>
            <name value="level3observation"></name>
            <source>
               <context value="text"></context>
               <element value="data"></element>
               <variable value="data"></variable>
            </source>
            <target>
               <context value="note"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="data"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="idRef"></name>
            <source>
               <context value="text"></context>
               <condition value="(data.exists() = false)"></condition>
            </source>
            <target>
               <context value="note"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <transform value="evaluate"></transform>
               <parameter>
                  <valueString value="%section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).substring(%section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&gt;') + 1, %section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&lt;') - %section.text.substring(%section.text.indexOf(%src.text.reference.value.substring(1))).indexOf('&gt;') - 1)"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="text"></context>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </source>
            <rule>
               <name value="narrativeLink"></name>
               <source>
                  <context value="reference"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="note"></context>
                  <contextType value="variable"></contextType>
                  <element value="extension"></element>
                  <variable value="ext"></variable>
               </target>
               <dependent>
                  <name value="NarrativeLink"></name>
                  <variable value="value"></variable>
                  <variable value="ext"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="src"></context>
            <element value="code"></element>
            <variable value="vvv"></variable>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="vvv"></variable>
            <transform value="create"></transform>
         </target>
      </rule>
   </group>
   <group>
      <name value="InnerExtensionExternalDocumentId"></name>
      <typeMode value="none"></typeMode>
      <documentation value="_________________________ Template Type not specified   _________________________
target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html"></documentation>
      <input>
         <name value="src"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="externalDocumentId"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="id"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Identifier"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="II"></name>
            <variable value="src"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="InnerExtensionId"></name>
      <typeMode value="none"></typeMode>
      <documentation value="target: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html"></documentation>
      <input>
         <name value="src"></name>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="url"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="url"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="id"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="value"></name>
         <source>
            <context value="src"></context>
         </source>
         <target>
            <context value="ext"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <variable value="id"></variable>
            <transform value="create"></transform>
            <parameter>
               <valueString value="Identifier"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="II"></name>
            <variable value="src"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
   </group>
</StructureMap>