<StructureMap xmlns="http://hl7.org/fhir">
   <id value="BundleToCdaChEmed"></id>
   <text>
      <status value="generated"></status>
      <div xmlns="http://www.w3.org/1999/xhtml">
         <pre>map "http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCdaChEmed" = "BundleToCdaChEmed"

// Medication Entries
// 2020-11-11 Michaela Ziegler, copyright ahdis ag, Apache License
// CDA-CH-EMED:  https://art-decor.org/art-decor/decor-project--cdachemed-
// FHIR CH-EMED: http://fhir.ch/ig/ch-emed/index.html

uses "http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument" alias ClinicalDocument as target
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor" alias AssignedAuthor as target
uses "http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity" alias AssignedEntity as target
uses "http://hl7.org/fhir/cda/StructureDefinition/Author" alias Author as target
uses "http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization" alias CustodianOrganization as target
uses "http://hl7.org/fhir/cda/StructureDefinition/IVL_TS" alias IVL_TS as target
uses "http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS" alias EIVL_TS as target
uses "http://hl7.org/fhir/cda/StructureDefinition/PatientRole" alias PatientRole as target
uses "http://hl7.org/fhir/cda/StructureDefinition/RecordTarget" alias RecordTarget as target
uses "http://hl7.org/fhir/cda/StructureDefinition/Section" alias Section as target
uses "http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration" alias SubstanceAdministration as target
uses "http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS" alias SXPR_TS as target
uses "http://hl7.org/fhir/cda/StructureDefinition/Supply" alias Supply as target
uses "http://hl7.org/fhir/StructureDefinition/Bundle" alias Bundle as source
uses "http://hl7.org/fhir/StructureDefinition/Composition" alias Composition as source
uses "http://hl7.org/fhir/StructureDefinition/Patient" alias Patient as source
uses "http://hl7.org/fhir/StructureDefinition/Practitioner" alias Practitioner as source
uses "http://hl7.org/fhir/StructureDefinition/Organization" alias Organization as source
uses "http://hl7.org/fhir/StructureDefinition/MedicationStatement" alias MedicationStatement as source
uses "http://hl7.org/fhir/StructureDefinition/Dosage" alias Dosage as source

imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/FhirToCdaTypes"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCda"
imports "http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCdaCh"

// source: Annotation note (e.g. http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html)
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.2
group AnnotationComment(source note : Annotation, target act : Act) {
  note -&gt; act.classCode = 'ACT' "ACT";
  note -&gt; act.moodCode = 'EVN' "EVN";
  note -&gt;  act.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.2' "templateId";
  note -&gt;  act.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.40' "templateId";
  note -&gt;  act.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.2' "templateId";
  note -&gt;  act.code as code,  code.code = '48767-8',  code.codeSystem = '2.16.840.1.113883.6.1',  code.displayName = 'Annotation comment',  code.codeSystemName = 'LOINC' "code";
  note.text as noteText -&gt; act.text as text then {
    noteText -&gt; text.data = noteText "text";
    note.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' then {
      extension.valueUrl as valueUrl -&gt;  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    note where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  text.reference as reference,  reference.value = '#refpdf' "reference";
  };
  note -&gt;  act.statusCode as code,  code.code = 'completed' "statusCode";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33&amp;effectiveDate=2019-12-11T11:34:24&amp;language=en-US
group ManufacturedMaterialEntryContentModuleStatement(source bundle : Bundle, source medicationStatement : MedicationStatement, source medication : Medication, target manufacturedMaterial : ManufacturedMaterial) {
  medication -&gt; manufacturedMaterial.classCode = 'MMAT' "MMAT";
  medication -&gt; manufacturedMaterial.determinerCode = 'KIND' "KIND";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.33' "CH-PHARM-ManufacturedMaterialContentModule";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.1' "templateId";
  medication.code as code then {
    code.text as text -&gt;  manufacturedMaterial.name as name,  name.other = text "brandname";
  } "name";
  medication.code as code then {
    // #mtpc.no.brandedmedication
    code.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt; manufacturedMaterial.code as code then {
      extension.valueUrl as valueUrl -&gt;  code.originalText as text,  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    code where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  manufacturedMaterial.code as code,  code.originalText as text,  text.reference as reference,  reference.value = '#refpdf' "reference";
    code.coding as coding -&gt; manufacturedMaterial.code as ce then CodingCE(coding, ce) "code";
    code where coding.exists() = false -&gt;  manufacturedMaterial.code as ce,  ce.nullFlavor = 'NA' "nullFlavor";
  };
  medication.form as form then {
    form.coding as coding -&gt; manufacturedMaterial.formCode as formCode then CodingCE(coding, formCode) "formCode";
  };
  medication.code as code -&gt;  manufacturedMaterial.asContent as asContent,  asContent.classCode = 'CONT',  asContent.containerPackagedMedicine as containerPackagedMedicine then {
    code -&gt; containerPackagedMedicine.classCode = 'CONT' "CONT";
    code -&gt; containerPackagedMedicine.determinerCode = 'INSTANCE' "INSTANCE";
    code.coding as coding -&gt; containerPackagedMedicine.code as ce then CodingCE(coding, ce) "pharm-code";
    code.text as text -&gt;  containerPackagedMedicine.name as name,  name.other = text "pharm-name";
    medication.form as form then {
      form.coding as coding -&gt; containerPackagedMedicine.formCode as formCode then CodingCE(coding, formCode) "pharm-formCode";
    };
    // Package size
    medication.amount as amount then {
      amount.numerator as numerator -&gt; containerPackagedMedicine.capacityQuantity as capacityQuantity then {
        numerator.value as value -&gt; capacityQuantity.value = value;
        numerator.code as unit -&gt; capacityQuantity.unit = unit "unit";
      };
    };
  };
  medication.ingredient as ingredient -&gt;  manufacturedMaterial.ingredient as ingredient,  ingredient.classCode = 'ACTI' then {
    ingredient.itemCodeableConcept as itemCodeableConcept -&gt; ingredient.ingredient as pharmsubstance then {
      itemCodeableConcept -&gt; pharmsubstance.classCode = 'MMAT' "MMAT";
      itemCodeableConcept -&gt; pharmsubstance.determinerCode = 'KIND' "KIND";
      itemCodeableConcept.text as text -&gt;  pharmsubstance.name as name,  name.other = text "name";
      itemCodeableConcept.coding as coding then {
        coding -&gt; pharmsubstance.code as ce then CodingCE(coding, ce) "formCode";
      };
    } "PharmSubstance";
    ingredient.strength as strength -&gt; ingredient.quantity as quantity then RatioRTOPQPQ(strength, quantity);
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.34&amp;effectiveDate=2019-12-11T11:31:52&amp;language=en-US
group MedicationTreatmentPlanItemEntryContentModule(source bundle : Bundle, source medicationStatement : MedicationStatement, target substanceAdministration : SubstanceAdministration) {
  medicationStatement -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
  medicationStatement -&gt; substanceAdministration.moodCode = 'INT' "INT";
  medicationStatement -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.34' "CH-PHARM-MedicationTreatmentPlanItemEntryContentModule";
  medicationStatement -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.7' "IHE-PHARM-MTP";
  medicationStatement -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.24' "CCD";
  medicationStatement -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7' "PCC-MedicationEntryContentModule";
  medicationStatement.identifier as identifier -&gt; substanceAdministration.id as id then IdentifierII(identifier, id) "id";
  medicationStatement.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt;  substanceAdministration.text as text,  text.reference as reference then {
    extension.valueUrl as valueUrl -&gt; reference.value = valueUrl;
  } "narrativeLink";
  medicationStatement where extension.where(url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists().not() -&gt;  substanceAdministration.text as text,  text.reference as reference then {
    medicationStatement -&gt; reference.value = '#refpdf' "referencetopdf";
  } "cat1narrativelink";
  medicationStatement -&gt;  substanceAdministration.statusCode as statusCode,  statusCode.code = 'completed' "code";
  medicationStatement.contained as medication where ('#' + $this.id) in %medicationStatement.medicationReference.reference -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.classCode = 'MANU' then {
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.2' "MP-TemplateId";
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.53' "MP-TemplateId";
    medication -&gt; manufacturedProduct.manufacturedMaterial as manufacturedMaterial then ManufacturedMaterialEntryContentModuleStatement(bundle, medicationStatement, medication, manufacturedMaterial) "manufacturedMaterial";
  };
  // TODO: AUTHOR1 Medication Treatment Plan Author
  medicationStatement where dosage.count() = 1 then {
    medicationStatement.dosage as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' "normalDose";
  } "onylonedosage";
  // dosage for normal dosing, as no sequences are present there
  medicationStatement.dosage as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal') then DosageInstructionsStartStopFrequencySubstanceAdministration(dosage, substanceAdministration) "DosageSubstanceAdministration";
  // dosage for split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode
  medicationStatement.dosage first as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split') -&gt; substanceAdministration.entryRelationship as entryRelationship then DosageInstructionsEntryStartStopRoute(dosage, substanceAdministration, entryRelationship) "DosageSubstanceAdministration";
  // dosage for split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable
  medicationStatement.dosage as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split') -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP' then DosageInstructionsEntryDosageChangeSubstanceAdministration(dosage, substanceAdministration, entryRelationship) "DosageSubstanceAdministration";
  medicationStatement.reasonCode as reasonCode -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'RSON',  entryRelationship.observation as observation then TreatmentReasonEntryContentModule(reasonCode, observation) "TreatmentReasonEntryContentModule";
  medicationStatement.extension as extension where url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'REFR',  entryRelationship.substanceAdministration as substanceAdministration then MTPReferenceEntryContentModule(extension, substanceAdministration) "MTP-Reference";
  // https://github.com/ehealthsuisse/ch-emed/issues/56
  medicationStatement -&gt;  substanceAdministration.repeatNumber as repeatNumber,  repeatNumber.nullFlavor = 'NI' "repeatNumberDefault";
  // TODO: Patient Medication Instructions Contains 1.3.6.1.4.1.19376.1.5.3.1.4.3 IHE Patient Medication Instructions (DYNAMIC)
  medicationStatement.dosage as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.substanceAdministration as substanceAdministration then DosageInstructionsNonStructuredEntryContentModule(dosage, substanceAdministration) "DosageInstructionsNonStructuredEntryContentModule";
  medicationStatement.note as note -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then AnnotationComment(note, act) "AnnotationComment";
  medicationStatement.extension as extension where $this.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-substitution' -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then SubstitutionStatement(extension, act) "Substitution";
}

// TODO: Tapered Dose
// medicationStatement -&gt; substanceAdministration.templateId as templateId, templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.8' "taperedDose";
// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
// dosage for normal dosing (without sequences) (Statement, Prescription)
group DosageInstructionsStartStopFrequencySubstanceAdministration(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' "normalDose";
  dosage as dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeStartEnd(dosage, substanceAdministration) "effectiveTimeStartEnd";
  dosage as dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeWhenNormal(dosage, substanceAdministration) "effectiveTimeWhen";
  dosage.route as route -&gt; substanceAdministration.routeCode as routeCode then CodeableConceptCE(route, routeCode);
  dosage as dosage -&gt; substanceAdministration as substanceAdministration then DoseQuantity(dosage, substanceAdministration) "doseQuantity";
}

// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
// dosage for split dosing: effectiveTime (start/stop) &amp; routeCode (Statement, Prescription)
group DosageInstructionsEntryStartStopRoute(source dosage : Dosage, target substanceAdministration : substanceAdministration, target entry : entryRelationship) {
  // if the FHIR doucment has no dosage templateId -&gt; create templateId for split dose
  dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.9' "splitDose";
  dosage as dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeStartEnd(dosage, substanceAdministration) "effectiveTimeStartEnd";
  dosage.route as route -&gt; substanceAdministration.routeCode as routeCode then CodeableConceptCE(route, routeCode);
}

// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
// dosage for split dosing: sequence number, effectiveTime (when), dose quantity, consumable (Statement, Prescription)
group DosageInstructionsEntryDosageChangeSubstanceAdministration(source dosage : Dosage, target substanceAdministration : substanceAdministration, target entry : entryRelationship) {
  dosage.sequence as sequence -&gt;  entry.sequenceNumber as sequenceNumber,  sequenceNumber.value = sequence;
  dosage -&gt;  entry.substanceAdministration as substanceAdministration,  substanceAdministration.classCode = 'SBADM',  substanceAdministration.moodCode = 'INT' then {
    dosage as dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeWhenSplit(dosage, substanceAdministration) "effectiveTimeWhen";
    dosage as dosage -&gt; substanceAdministration as substanceAdministration then DoseQuantity(dosage, substanceAdministration) "doseQuantity";
    dosage as dosage -&gt;  substanceAdministration as substanceAdministration,  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
  } "dosage";
}

// effective time low and high for dosage (Statement, Prescription)
group EffectiveTimeStartEnd(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage.timing as timing then {
    timing.repeat as repeat then {
      repeat.bounds : Period as bounds -&gt; substanceAdministration.effectiveTime = create('IVL_TS') as effectiveTime then {
        bounds.start as start -&gt; effectiveTime.low as low then DateTS(start, low) "low";
        bounds where start.exists().not() -&gt;  effectiveTime.low as low,  low.nullFlavor = 'UNK' "NullFlavorLow";
        bounds.end as end -&gt; effectiveTime.high as high then DateTS(end, high) "high";
        bounds where end.exists().not() -&gt;  effectiveTime.high as high,  high.nullFlavor = 'UNK' "NullFlavor high";
      };
    };
  };
}

// dose quantity for dosage (application schema) (Statement)
group DoseQuantity(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage.doseAndRate as doseAndRate -&gt; substanceAdministration.doseQuantity as doseQuantity then {
    doseAndRate.dose : Quantity as quantity then {
      quantity.value as value -&gt; doseQuantity.value = value;
      quantity.code as code -&gt; doseQuantity.unit = code;
    } "quantity";
  } "doseQuantity";
}

// source: reasonCode Coding (e.g. http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-medicationstatement)
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.41
// Treatment Reason (Statement, Prescription)
group TreatmentReasonEntryContentModule(source reasonCode : Coding, target observation : Observation) {
  reasonCode -&gt; observation.classCode = 'OBS' "OBS";
  reasonCode -&gt; observation.moodCode = 'EVN' "EVN";
  reasonCode -&gt;  observation.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.41' "TreatmentReasonEntryContentModule";
  reasonCode -&gt;  observation.code as code,  code.code = '75326-9',  code.codeSystem = '2.16.840.1.113883.6.1',  code.displayName = 'Problem',  code.codeSystemName = 'LOINC' "code";
  reasonCode.text as reasonText -&gt; observation.text as text then {
    reasonText -&gt; text.data = reasonText "text";
    reasonCode.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' then {
      extension.valueUrl as valueUrl -&gt;  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    reasonCode where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  text.reference as reference,  reference.value = '#refpdf' "reference";
  };
  reasonCode -&gt;  observation.statusCode as code,  code.code = 'completed' "statusCode";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.45&amp;effectiveDate=2017-01-10T15:34:25&amp;language=en-US
group MTPReferenceEntryContentModule(source ext : Extension, target substanceAdministration : SubstanceAdministration) {
  ext -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
  ext -&gt; substanceAdministration.moodCode = 'INT' "INT";
  ext -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.10' "referenceTo-MTP-PlanItemGeneralSpecificationTemplateId";
  ext -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.45' "CH-PHARM-templateId";
  ext.extension as extension where $this.url = 'id' then {
    extension.valueIdentifier as valueIdentifier -&gt; substanceAdministration.id as id then IdentifierII(valueIdentifier, id) "id";
  } "id";
  ext -&gt;  substanceAdministration.code as code,  code.code = 'MTPItem',  code.codeSystem = '1.3.6.1.4.1.19376.1.9.2.2',  code.displayName = 'Medication Treatment Plan Item',  code.codeSystemName = 'IHE Pharmacy Item Type List' "code";
  ext -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
  ext.extension as extension where $this.url = 'externalDocumentId' then {
    extension.valueIdentifier as valueIdentifier -&gt;  substanceAdministration.reference as reference,  reference.typeCode = 'XCRPT',  reference.externalDocument as externalDocument,  externalDocument.id as id then IdentifierII(valueIdentifier, id) "id";
  } "externalDocumentId";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-dosage-nonstructured.html
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.52
// Dosage Instruction (Statement, Prescription)
group DosageInstructionsNonStructuredEntryContentModule(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
  dosage -&gt; substanceAdministration.moodCode = 'INT' "INT";
  dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.52' "templateId";
  dosage.text as noteText -&gt; substanceAdministration.text as text then {
    noteText -&gt; text.data = noteText "text";
    dosage.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' then {
      extension.valueUrl as valueUrl -&gt;  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    dosage where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  text.reference as reference,  reference.value = '#refpdf' "reference";
  };
  dosage -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
// target: Substitution act Contains 1.3.6.1.4.1.19376.1.9.1.3.9.2 IHE Substitution Act Content Module
// Substitution (Dispense)
group SubstitutionDispense(source substitution : Substitution, target act : Act) {
  substitution -&gt; act.classCode = 'ACT' "ACT";
  substitution -&gt; act.moodCode = 'EVN' "EVN";
  substitution -&gt;  act.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.9.2' "templateId";
  substitution.type as type -&gt; act.code as code then CodeableConceptCE(type, code) "substitution";
  substitution -&gt;  act.statusCode as statusCode,  statusCode.code = 'completed' "statusCode";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33&amp;effectiveDate=2019-12-11T11:34:24&amp;language=en-US
group ManufacturedMaterialEntryContentModuleDispense(source bundle : Bundle, source medicationDispense : MedicationDispense, source medication : Medication, target manufacturedMaterial : ManufacturedMaterial) {
  medication -&gt; manufacturedMaterial.classCode = 'MMAT' "MMAT";
  medication -&gt; manufacturedMaterial.determinerCode = 'KIND' "KIND";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.33' "CH-PHARM-ManufacturedMaterialContentModule";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.1' "templateId";
  medication.code as code then {
    code.text as text -&gt;  manufacturedMaterial.name as name,  name.other = text "brandname";
  } "name";
  medication.code as code then {
    // #dis.no.brandedmedication
    code.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt; manufacturedMaterial.code as code then {
      extension.valueUrl as valueUrl -&gt;  code.originalText as text,  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    code where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  manufacturedMaterial.code as code,  code.originalText as text,  text.reference as reference,  reference.value = '#refpdf' "reference";
    code.coding as coding -&gt; manufacturedMaterial.code as ce then CodingCE(coding, ce) "code";
  };
  medication.form as form then {
    form.coding as coding -&gt; manufacturedMaterial.formCode as formCode then CodingCE(coding, formCode) "formCode";
  };
  medication.code as code -&gt;  manufacturedMaterial.asContent as asContent,  asContent.classCode = 'CONT',  asContent.containerPackagedMedicine as containerPackagedMedicine then {
    code -&gt; containerPackagedMedicine.classCode = 'CONT' "CONT";
    code -&gt; containerPackagedMedicine.determinerCode = 'INSTANCE' "INSTANCE";
    code.coding as coding -&gt; containerPackagedMedicine.code as ce then CodingCE(coding, ce) "pharm-code";
    code.text as text -&gt;  containerPackagedMedicine.name as name,  name.other = text "pharm-name";
    medication.form as form then {
      form.coding as coding -&gt; containerPackagedMedicine.formCode as formCode then CodingCE(coding, formCode) "pharm-formCode";
    };
    // Package size
    medication.amount as amount then {
      amount.numerator as numerator -&gt; containerPackagedMedicine.capacityQuantity as capacityQuantity then {
        numerator.value as value -&gt; capacityQuantity.value = value;
        numerator.code as unit -&gt; capacityQuantity.unit = unit "unit";
      };
    };
  };
  medication.ingredient as ingredient -&gt;  manufacturedMaterial.ingredient as ingredient,  ingredient.classCode = 'ACTI' then {
    ingredient.itemCodeableConcept as itemCodeableConcept -&gt; ingredient.ingredient as pharmsubstance then {
      itemCodeableConcept -&gt; pharmsubstance.classCode = 'MMAT' "MMAT";
      itemCodeableConcept -&gt; pharmsubstance.determinerCode = 'KIND' "KIND";
      itemCodeableConcept.text as text -&gt;  pharmsubstance.name as name,  name.other = text "name";
      itemCodeableConcept.coding as coding then {
        coding -&gt; pharmsubstance.code as ce then CodingCE(coding, ce) "formCode";
      };
    } "PharmSubstance";
    ingredient.strength as strength -&gt; ingredient.quantity as quantity then RatioRTOPQPQ(strength, quantity);
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.42
group DispenseItemEntryContentModule(source bundle : Bundle, source medicationDispense : MedicationDispense, target supply : Supply) {
  medicationDispense -&gt; supply.classCode = 'SPLY' "SPLY";
  medicationDispense -&gt; supply.moodCode = 'EVN' "EVN";
  medicationDispense -&gt;  supply.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.42' "CH-PHARM-DispenseItemEntryContentModule";
  medicationDispense -&gt;  supply.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.4' "IHE-PHARM-DIS";
  medicationDispense -&gt;  supply.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.3' "supplyEntry";
  medicationDispense -&gt;  supply.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.34' "CCD";
  medicationDispense.identifier as identifier -&gt; supply.id as id then IdentifierII(identifier, id) "id";
  medicationDispense.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt;  supply.text as text,  text.reference as reference then {
    extension.valueUrl as valueUrl -&gt; reference.value = valueUrl;
  } "narrativeLink";
  medicationDispense where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  supply.text as text,  text.reference as reference,  text.reference as reference,  reference.value = '#refpdf' "reference";
  medicationDispense.contained as medication where ('#' + $this.id) in %medicationDispense.medicationReference.reference -&gt;  supply.product as product,  product.manufacturedProduct as manufacturedProduct,  manufacturedProduct.classCode = 'MANU' then {
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.2' "MP-TemplateId";
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.53' "MP-TemplateId";
    medication -&gt; manufacturedProduct.manufacturedMaterial as manufacturedMaterial then ManufacturedMaterialEntryContentModuleDispense(bundle, medicationDispense, medication, manufacturedMaterial) "manufacturedMaterial";
  };
  // TODO: AUTHOR1 Medication Treatment Plan Author
  medicationDispense.extension as extension where url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' -&gt;  supply.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'REFR',  entryRelationship.substanceAdministration as substanceAdministration then MTPReferenceEntryContentModule(extension, substanceAdministration) "MTP-Reference";
  // #24 missing template it if ch-emed-dosage-nonstructured
  medicationDispense where dosageInstruction.count() = 1 then {
    medicationDispense.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' "normalDose";
  } "onylonedosage";
  // dosage for normal dosing, as no sequences are present there
  medicationDispense.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal') then DosageInstructionsStartStopFrequencySupply(dosage, supply) "DosageSubstanceAdministration";
  // dosage for split dosing, as sequences are present there
  medicationDispense -&gt; supply.entryRelationship as entryRelationship then {
    medicationDispense -&gt; entryRelationship.substanceAdministration as substanceAdministration then {
      // split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode &amp; consumable
      medicationDispense.dosageInstruction first as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split') -&gt; substanceAdministration then DosageInstructionsEntryStartStopRouteConsumable(dosage, entryRelationship, substanceAdministration) "DosageSubstanceAdministration";
      // split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable
      medicationDispense.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split') -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP' then DosageInstructionsEntryDosageChangeEntryRelationship(dosage, entryRelationship) "DosageSubstanceAdministration";
    } "substanceAdministration";
  } "entryRelationship";
  // TODO: Precondition Criterion
  medicationDispense.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  supply.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.substanceAdministration as substanceAdministration then DosageInstructionsNonStructuredEntryContentModule(dosage, substanceAdministration) "DosageInstructionsNonStructuredEntryContentModule";
  // Number of packages
  medicationDispense.quantity as quantity -&gt; supply.quantity as supplyQuantity then {
    quantity.value as value -&gt; supplyQuantity.value = value;
  };
  medicationDispense.note as note -&gt;  supply.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then AnnotationComment(note, act) "AnnotationComment";
  medicationDispense.substitution as substitution -&gt;  supply.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then SubstitutionDispense(substitution, act) "Substitution";
}

// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
// dosage for normal dosing (without sequences) (Dispense)
group DosageInstructionsStartStopFrequencySupply(source dosage : Dosage, target supply : Supply) {
  dosage -&gt; supply.entryRelationship as entryRelationship then {
    dosage -&gt; entryRelationship.typeCode = 'COMP' "COMP";
    dosage -&gt; entryRelationship.substanceAdministration as substanceAdministration then {
      dosage -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
      dosage -&gt; substanceAdministration.moodCode = 'INT' "INT";
      dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.6' "templateId";
      dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' "normalDose";
      dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeStartEnd(dosage, substanceAdministration) "effectiveTimeStartEnd";
      dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeWhenNormal(dosage, substanceAdministration) "effectiveTimeWhen";
      dosage.route as route -&gt; substanceAdministration.routeCode as routeCode then CodeableConceptCE(route, routeCode);
      dosage -&gt; substanceAdministration as substanceAdministration then DoseQuantity(dosage, substanceAdministration) "doseQuantity";
      dosage -&gt;  substanceAdministration as substanceAdministration,  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
    } "substanceAdministration";
  } "entryRelationship";
}

// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
// dosage for split dosing: effectiveTime (start/stop) &amp; routeCode &amp; consumable (Dispense)
group DosageInstructionsEntryStartStopRouteConsumable(source dosage : Dosage, target entryRelationship : entryRelationship, target substanceAdministration : SubstanceAdministration) {
  dosage -&gt; entryRelationship.typeCode = 'COMP' "COMP";
  dosage -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
  dosage -&gt; substanceAdministration.moodCode = 'INT' "INT";
  dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.6' "templateId";
  dosage -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.9' "splitDose";
  dosage -&gt; substanceAdministration as substanceAdministration then EffectiveTimeStartEnd(dosage, substanceAdministration) "effectiveTimeStartEnd";
  dosage.route as route -&gt; substanceAdministration.routeCode as routeCode then CodeableConceptCE(route, routeCode);
  dosage -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
}

// source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
// target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
// dosage for split dosing: sequence number, effectiveTime (when), dose quantity, consumable (Dispense)
group DosageInstructionsEntryDosageChangeEntryRelationship(source dosage : Dosage, target entryRelationship : entryRelationship) {
  dosage.sequence as sequence -&gt;  entryRelationship.sequenceNumber as sequenceNumber,  sequenceNumber.value = sequence;
  dosage -&gt;  entryRelationship.substanceAdministration as substanceAdministration,  substanceAdministration.classCode = 'SBADM',  substanceAdministration.moodCode = 'INT' then {
    dosage as dosage -&gt; substanceAdministration then EffectiveTimeWhenSplit(dosage, substanceAdministration) "effectiveTimeWhen";
    dosage as dosage -&gt; substanceAdministration then DoseQuantity(dosage, substanceAdministration) "doseQuantity";
    dosage as dosage -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.manufacturedMaterial as manufacturedMaterial,  manufacturedMaterial.nullFlavor = 'NA' "consumable";
  } "dosage";
}

// effective time when for normal dosage (Dispense, Statement, Prescription)
group EffectiveTimeWhenNormal(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage.timing as timing then {
    timing.repeat as repeat then {
      repeat where $this.when.count() = 1 -&gt;  substanceAdministration.effectiveTime = create('EIVL_TS') as effectiveTime,  effectiveTime.operator = 'A' then {
        repeat.when as when -&gt;  effectiveTime.event as event,  event.code = when;
      } "when";
      repeat where $this.when.count() &gt; 1 -&gt;  substanceAdministration.effectiveTime = create('SXPR_TS') as effectiveTime,  effectiveTime.operator = 'A' then {
        repeat.when first as when -&gt; effectiveTime.comp = create('EIVL_TS') as comp then {
          when -&gt;  comp.event as event,  event.code = when "when";
        } "comp";
        repeat.when not_first as when -&gt;  effectiveTime.comp = create('EIVL_TS') as comp,  comp.operator = 'I' then {
          when -&gt;  comp.event as event,  event.code = when "when";
        } "compnotfirst";
      } "when";
    };
  };
}

// effective time when for split dosage (Dispense, Statement, Prescription)
group EffectiveTimeWhenSplit(source dosage : Dosage, target substanceAdministration : SubstanceAdministration) {
  dosage.timing as timing then {
    timing.repeat as repeat then {
      repeat where $this.when.count() = 1 -&gt; substanceAdministration.effectiveTime = create('EIVL_TS') as effectiveTime then {
        repeat.when as when -&gt;  effectiveTime.event as event,  event.code = when;
      } "when";
      repeat where $this.when.count() &gt; 1 -&gt;  substanceAdministration.effectiveTime = create('SXPR_TS') as effectiveTime,  effectiveTime.operator = 'A' then {
        repeat.when first as when -&gt; effectiveTime.comp = create('EIVL_TS') as comp then {
          when -&gt;  comp.event as event,  event.code = when "when";
        } "comp";
        repeat.when not_first as when -&gt;  effectiveTime.comp = create('EIVL_TS') as comp,  comp.operator = 'I' then {
          when -&gt;  comp.event as event,  event.code = when "when";
        } "compnotfirst";
      } "when";
    };
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module
group SubstitutionRequest(source substitution : Substitution, target act : Act) {
  substitution -&gt; act.classCode = 'ACT' "ACT";
  substitution -&gt; act.moodCode = 'DEF' "DEF";
  substitution -&gt;  act.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.9.1' "templateId";
  substitution.allowedCodeableConcept as allowedCC -&gt; act.code as code then CodeableConceptCE(allowedCC, code) "substitution";
  substitution -&gt;  act.statusCode as statusCode,  statusCode.code = 'completed' "statusCode";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module
group SubstitutionStatement(source extension : Extension, target act : Act) {
  extension -&gt; act.classCode = 'ACT' "ACT";
  extension -&gt; act.moodCode = 'DEF' "DEF";
  extension -&gt;  act.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.9.1' "templateId";
  extension.valueCodeableConcept as valueCC -&gt; act.code as code then CodeableConceptCE(valueCC, code) "extension";
  extension -&gt;  act.statusCode as statusCode,  statusCode.code = 'completed' "statusCode";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38
group PrescribedQuantity(source dispenseRequest : DispenseRequest, target supply : Supply) {
  dispenseRequest -&gt; supply.classCode = 'SPLY' "SPLY";
  dispenseRequest -&gt; supply.moodCode = 'RQO' "RQO";
  dispenseRequest -&gt;  supply.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.8' "templateId";
  dispenseRequest -&gt;  supply.independentInd as independentInd,  independentInd.value = 'false' "independentInd";
  // Number of packages
  dispenseRequest.quantity as quantity -&gt; supply.quantity as quant then {
    quantity.value as value -&gt; quant.value = value;
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38
group PrescribedQuantityUnit(source dispenseRequest : DispenseRequest, target supply : Supply) {
  dispenseRequest -&gt; supply.classCode = 'SPLY' "SPLY";
  dispenseRequest -&gt; supply.moodCode = 'RQO' "RQO";
  dispenseRequest -&gt;  supply.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.8' "TemplateId";
  dispenseRequest -&gt;  supply.independentInd as independentInd,  independentInd.value = 'false' "independentInd";
  // Number of packages
  dispenseRequest.quantity as quantity -&gt; supply.quantity as quant then {
    quantity.value as value -&gt; quant.value = value;
    quantity.unit as unit -&gt; quant.unit = unit;
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33
group ManufacturedMaterialEntryContentModulePrescription(source bundle : Bundle, source medicationRequest : MedicationRequest, source medication : Medication, target manufacturedMaterial : ManufacturedMaterial, target substanceAdministration : SubstanceAdministration) {
  medication -&gt; manufacturedMaterial.classCode = 'MMAT' "MMAT";
  medication -&gt; manufacturedMaterial.determinerCode = 'KIND' "KIND";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.33' "CH-PHARM-ManufacturedMaterialContentModule";
  medication -&gt;  manufacturedMaterial.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.1' "templateId";
  medication.code as code then {
    code.text as text -&gt;  manufacturedMaterial.name as name,  name.other = text "brandname";
  } "name";
  medication.code as code then {
    // #pre.no.brandedmedication
    code.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt; manufacturedMaterial.code as code then {
      extension.valueUrl as valueUrl -&gt;  code.originalText as text,  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    code where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  manufacturedMaterial.code as code,  code.originalText as text,  text.reference as reference,  reference.value = '#refpdf' "reference";
    code.coding as coding -&gt; manufacturedMaterial.code as ce then CodingCE(coding, ce) "code";
  };
  medication.form as form then {
    form.coding as coding -&gt; manufacturedMaterial.formCode as formCode then CodingCE(coding, formCode) "formCode";
  };
  medication.code as code -&gt;  manufacturedMaterial.asContent as asContent,  asContent.classCode = 'CONT',  asContent.containerPackagedMedicine as containerPackagedMedicine then {
    code -&gt; containerPackagedMedicine.classCode = 'CONT' "CONT";
    code -&gt; containerPackagedMedicine.determinerCode = 'INSTANCE' "INSTANCE";
    code.coding as coding -&gt; containerPackagedMedicine.code as ce then CodingCE(coding, ce) "pharm-code";
    code.text as text -&gt;  containerPackagedMedicine.name as name,  name.other = text "pharm-name";
    medication.form as form then {
      form.coding as coding -&gt; containerPackagedMedicine.formCode as formCode then CodingCE(coding, formCode) "pharm-formCode";
    };
    // Package size
    medication.amount as amount then {
      amount.numerator as numerator -&gt; containerPackagedMedicine.capacityQuantity as capacityQuantity then {
        numerator.value as value -&gt; capacityQuantity.value = value;
        numerator.code as unit -&gt; capacityQuantity.unit = unit "unit";
      };
      // IHE-DIS: Case 1: If the product-element contains package information, the unit attribute is not be present
      medicationRequest.dispenseRequest as dispenseRequest -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.supply as supply then PrescribedQuantity(dispenseRequest, supply) "PrescribedQuantity";
    };
    // IHE-DIS: Case 2: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system
    medication where $this.amount.exists() = false then {
      medicationRequest.dispenseRequest as dispenseRequest -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.supply as supply then PrescribedQuantityUnit(dispenseRequest, supply) "PrescribedQuantityUnit";
    } "noAmount";
  };
  medication.ingredient as ingredient -&gt;  manufacturedMaterial.ingredient as ingredient,  ingredient.classCode = 'ACTI' then {
    ingredient.itemCodeableConcept as itemCodeableConcept -&gt; ingredient.ingredient as pharmsubstance then {
      itemCodeableConcept -&gt; pharmsubstance.classCode = 'MMAT' "MMAT";
      itemCodeableConcept -&gt; pharmsubstance.determinerCode = 'KIND' "KIND";
      itemCodeableConcept.text as text -&gt;  pharmsubstance.name as name,  name.other = text "name";
      itemCodeableConcept.coding as coding then {
        coding -&gt; pharmsubstance.code as ce then CodingCE(coding, ce) "formCode";
      };
    } "PharmSubstance";
    ingredient.strength as strength -&gt; ingredient.quantity as quantity then RatioRTOPQPQ(strength, quantity);
  };
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.43
group PrescriptionItemEntryContentModule(source bundle : Bundle, source medicationRequest : MedicationRequest, target substanceAdministration : SubstanceAdministration) {
  medicationRequest -&gt; substanceAdministration.classCode = 'SBADM' "SBADM";
  medicationRequest -&gt; substanceAdministration.moodCode = 'INT' "INT";
  medicationRequest -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.43' "CH-PHARM-PrescriptionItemEntryContentModule";
  medicationRequest -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.2' "PrescriptionItemEntryTemplateId";
  medicationRequest -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.24' "CCD";
  medicationRequest -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7' "PCC-MedicationEntryContentModule";
  medicationRequest.identifier as identifier -&gt; substanceAdministration.id as id then IdentifierII(identifier, id) "id";
  medicationRequest.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt;  substanceAdministration.text as text,  text.reference as reference then {
    extension.valueUrl as valueUrl -&gt; reference.value = valueUrl;
  } "narrativeLink";
  medicationRequest where extension.where(url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists().not() -&gt;  substanceAdministration.text as text,  text.reference as reference then {
    medicationRequest -&gt; reference.value = '#refpdf' "referencetopdf";
  } "cat1narrativelink";
  medicationRequest -&gt;  substanceAdministration.statusCode as statusCode,  statusCode.code = 'completed' "code";
  medicationRequest.dispenseRequest as dispenseRequest -&gt; substanceAdministration.repeatNumber as repeatNumber then {
    dispenseRequest.numberOfRepeatsAllowed as number -&gt; repeatNumber.value = number "repeatNumber";
    dispenseRequest where numberOfRepeatsAllowed.exists() = false -&gt; repeatNumber.nullFlavor = 'NI' "repeatNumberNull";
  };
  medicationRequest.contained as medication where ('#' + $this.id) in %medicationRequest.medicationReference.reference -&gt;  substanceAdministration.consumable as consumable,  consumable.manufacturedProduct as manufacturedProduct,  manufacturedProduct.classCode = 'MANU' then {
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.2' "MP-templateId";
    medication -&gt;  manufacturedProduct.templateId as templateId,  templateId.root = '2.16.840.1.113883.10.20.1.53' "MP-templateId";
    medication -&gt; manufacturedProduct.manufacturedMaterial as manufacturedMaterial then ManufacturedMaterialEntryContentModulePrescription(bundle, medicationRequest, medication, manufacturedMaterial, substanceAdministration) "manufacturedMaterial";
  };
  // TODO: AUTHOR1 Medication Treatment Plan Author
  medicationRequest where dosageInstruction.count() = 1 then {
    medicationRequest.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  substanceAdministration.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.7.1' "normalDose";
  } "onylonedosage";
  medicationRequest.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal-medicationrequest') then DosageInstructionsStartStopFrequencySubstanceAdministration(dosage, substanceAdministration) "DosageSubstanceAdministration";
  // dosage for split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode
  medicationRequest.dosageInstruction first as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split-medicationrequest') -&gt; substanceAdministration.entryRelationship as entryRelationship then DosageInstructionsEntryStartStopRoute(dosage, substanceAdministration, entryRelationship) "DosageSubstanceAdministration";
  // dosage for split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable
  medicationRequest.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split-medicationrequest') -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP' then DosageInstructionsEntryDosageChangeSubstanceAdministration(dosage, substanceAdministration, entryRelationship) "DosageSubstanceAdministration";
  medicationRequest.reasonCode as reasonCode -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'RSON',  entryRelationship.observation as observation then TreatmentReasonEntryContentModule(reasonCode, observation) "TreatmentReasonEntryContentModule";
  medicationRequest.extension as extension where url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'REFR',  entryRelationship.substanceAdministration as substanceAdministration then MTPReferenceEntryContentModule(extension, substanceAdministration) "MTP-Reference";
  // TODO: Patient Medication Instructions Contains 1.3.6.1.4.1.19376.1.5.3.1.4.3 IHE Patient Medication Instructions (DYNAMIC)
  medicationRequest.dosageInstruction as dosage where $this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured') -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.substanceAdministration as substanceAdministration then DosageInstructionsNonStructuredEntryContentModule(dosage, substanceAdministration) "DosageInstructionsNonStructuredEntryContentModule";
  medicationRequest.note as note -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then AnnotationComment(note, act) "AnnotationComment";
  medicationRequest.substitution as substitution -&gt;  substanceAdministration.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'COMP',  entryRelationship.act as act then SubstitutionRequest(substitution, act) "Substitution";
}

// source: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-observation.html
// target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.44
group PharmaceuticalAdviceItemEntryContentModule(source bundle : Bundle, source fhirobservation : Observation, target cdaobservation : Observation) {
  fhirobservation -&gt; cdaobservation.classCode = 'OBS' "OBS";
  fhirobservation -&gt; cdaobservation.moodCode = 'EVN' "EVN";
  fhirobservation -&gt;  cdaobservation.templateId as templateId,  templateId.root = '1.3.6.1.4.1.19376.1.9.1.3.3' "IHE-PHARM-PADV";
  fhirobservation -&gt;  cdaobservation.templateId as templateId,  templateId.root = '2.16.756.5.30.1.1.10.4.44' "CH-PHARM-PharmaceuticalAdviceItemEntryContentModule";
  fhirobservation.identifier as identifier -&gt; cdaobservation.id as id then IdentifierII(identifier, id) "id";
  fhirobservation.code as fhirCode -&gt; cdaobservation.code as cdaCode then CodeableConceptCE(fhirCode, cdaCode);
  fhirobservation -&gt;  cdaobservation.statusCode as statusCode,  statusCode.code = 'completed' "code";
  fhirobservation.effectiveDateTime as effectiveDateTime -&gt; cdaobservation.effectiveTime as effectiveTime then {
    effectiveDateTime -&gt; effectiveTime.value = effectiveDateTime "value";
  } "effectiveTime";
  fhirobservation.extension as extension where url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan' -&gt;  cdaobservation.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'REFR',  entryRelationship.substanceAdministration as substanceAdministration then MTPReferenceEntryContentModule(extension, substanceAdministration) "MTP-Reference";
  fhirobservation.extension as extension where url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-medicationstatement-changed' -&gt;  cdaobservation.entryRelationship as entryRelationship,  entryRelationship.typeCode = 'REFR' then {
    bundle.entry as entry then {
      entry.fullUrl where ($this in %extension.valueReference.reference) and $this.startsWith('urn:uuid') then {
        entry.resource as medicationStatement where $this.ofType(FHIR.MedicationStatement) -&gt; entryRelationship.substanceAdministration as substanceAdministration then MedicationTreatmentPlanItemEntryContentModule(bundle, medicationStatement, substanceAdministration) "MedicationStatement";
      } "fullUrlAsUuid";
      entry.resource as medicationStatement where $this.ofType(FHIR.MedicationStatement) and (('MedicationStatement' + '/' + $this.id) in %extension.valueReference.reference) -&gt; entryRelationship.substanceAdministration as substanceAdministration then MedicationTreatmentPlanItemEntryContentModule(bundle, medicationStatement, substanceAdministration) "MedicationStatement";
    };
  } "changedmtp";
  fhirobservation.note as note then {
    note.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' -&gt;  cdaobservation.text as text,  text.reference as reference then {
      extension.valueUrl as valueUrl -&gt; reference.value = valueUrl;
    } "narrativeLink";
    note where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  cdaobservation.text as text,  text.reference as reference,  reference.value = '#refpdf' "reference";
  };
  fhirobservation.note as note -&gt; cdaobservation.text as text then {
    note.text as noteText -&gt; text.data = noteText;
    note.extension as extension where $this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink' then {
      extension.valueUrl as valueUrl -&gt;  text.reference as reference,  reference.value = valueUrl "reference";
    } "id";
    note where (extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false) -&gt;  text.reference as reference,  reference.value = '#refpdf' "reference";
  } "text";
}

</pre>
      </div>
   </text>
   <url value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCdaChEmed"></url>
   <name value="BundleToCdaChEmed"></name>
   <description value="Medication Entries
2020-11-11 Michaela Ziegler, copyright ahdis ag, Apache License
CDA-CH-EMED:  https://art-decor.org/art-decor/decor-project--cdachemed-
FHIR CH-EMED: http://fhir.ch/ig/ch-emed/index.html"></description>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/ClinicalDocument"></url>
      <mode value="target"></mode>
      <alias value="ClinicalDocument"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedAuthor"></url>
      <mode value="target"></mode>
      <alias value="AssignedAuthor"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/AssignedEntity"></url>
      <mode value="target"></mode>
      <alias value="AssignedEntity"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Author"></url>
      <mode value="target"></mode>
      <alias value="Author"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/CustodianOrganization"></url>
      <mode value="target"></mode>
      <alias value="CustodianOrganization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/IVL_TS"></url>
      <mode value="target"></mode>
      <alias value="IVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/EIVL_TS"></url>
      <mode value="target"></mode>
      <alias value="EIVL_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/PatientRole"></url>
      <mode value="target"></mode>
      <alias value="PatientRole"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/RecordTarget"></url>
      <mode value="target"></mode>
      <alias value="RecordTarget"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Section"></url>
      <mode value="target"></mode>
      <alias value="Section"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SubstanceAdministration"></url>
      <mode value="target"></mode>
      <alias value="SubstanceAdministration"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/SXPR_TS"></url>
      <mode value="target"></mode>
      <alias value="SXPR_TS"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/cda/StructureDefinition/Supply"></url>
      <mode value="target"></mode>
      <alias value="Supply"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Bundle"></url>
      <mode value="source"></mode>
      <alias value="Bundle"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Composition"></url>
      <mode value="source"></mode>
      <alias value="Composition"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Patient"></url>
      <mode value="source"></mode>
      <alias value="Patient"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Practitioner"></url>
      <mode value="source"></mode>
      <alias value="Practitioner"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Organization"></url>
      <mode value="source"></mode>
      <alias value="Organization"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/MedicationStatement"></url>
      <mode value="source"></mode>
      <alias value="MedicationStatement"></alias>
   </structure>
   <structure>
      <url value="http://hl7.org/fhir/StructureDefinition/Dosage"></url>
      <mode value="source"></mode>
      <alias value="Dosage"></alias>
   </structure>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/FhirToCdaTypes"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCda"></import>
   <import value="http://fhir.ch/ig/cda-fhir-maps/StructureMap/BundleToCdaCh"></import>
   <group>
      <name value="AnnotationComment"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: Annotation note (e.g. http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html)
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.2"></documentation>
      <input>
         <name value="note"></name>
         <type value="Annotation"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ACT"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="EVN"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="EVN"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.2"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.10.20.1.40"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.2"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="48767-8"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystem"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.6.1"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="displayName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Annotation comment"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystemName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="LOINC"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="note"></context>
            <element value="text"></element>
            <variable value="noteText"></variable>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <rule>
            <name value="text"></name>
            <source>
               <context value="noteText"></context>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="data"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="noteText"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="id"></name>
            <source>
               <context value="note"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="note"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="statusCode"></name>
         <source>
            <context value="note"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="code"></variable>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModuleStatement"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33&amp;effectiveDate=2019-12-11T11:34:24&amp;language=en-US"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationStatement"></name>
         <type value="MedicationStatement"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="manufacturedMaterial"></name>
         <type value="ManufacturedMaterial"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="MMAT"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MMAT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="KIND"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="determinerCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="KIND"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-ManufacturedMaterialContentModule"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.33"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="name"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="brandname"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="id"></name>
            <source>
               <context value="code"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="code"></context>
                  <contextType value="variable"></contextType>
                  <element value="originalText"></element>
                  <variable value="text"></variable>
               </target>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="#mtpc.no.brandedmedication"></documentation>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="code"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <target>
               <context value="code"></context>
               <contextType value="variable"></contextType>
               <element value="originalText"></element>
               <variable value="text"></variable>
            </target>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="nullFlavor"></name>
            <source>
               <context value="code"></context>
               <condition value="coding.exists() = false"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <target>
               <context value="ce"></context>
               <contextType value="variable"></contextType>
               <element value="nullFlavor"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="NA"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="form"></name>
         <source>
            <context value="medication"></context>
            <element value="form"></element>
            <variable value="form"></variable>
         </source>
         <rule>
            <name value="formCode"></name>
            <source>
               <context value="form"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="formCode"></element>
               <variable value="formCode"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="formCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="asContent"></element>
            <variable value="asContent"></variable>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="CONT"></valueString>
            </parameter>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="containerPackagedMedicine"></element>
            <variable value="containerPackagedMedicine"></variable>
         </target>
         <rule>
            <name value="CONT"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="classCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="CONT"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="INSTANCE"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="determinerCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="INSTANCE"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="pharm-code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="pharm-name"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="form"></name>
            <source>
               <context value="medication"></context>
               <element value="form"></element>
               <variable value="form"></variable>
            </source>
            <rule>
               <name value="pharm-formCode"></name>
               <source>
                  <context value="form"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="formCode"></element>
                  <variable value="formCode"></variable>
               </target>
               <dependent>
                  <name value="CodingCE"></name>
                  <variable value="coding"></variable>
                  <variable value="formCode"></variable>
               </dependent>
            </rule>
         </rule>
         <rule>
            <name value="amount"></name>
            <source>
               <context value="medication"></context>
               <element value="amount"></element>
               <variable value="amount"></variable>
            </source>
            <rule>
               <name value="numerator"></name>
               <source>
                  <context value="amount"></context>
                  <element value="numerator"></element>
                  <variable value="numerator"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="capacityQuantity"></element>
                  <variable value="capacityQuantity"></variable>
               </target>
               <rule>
                  <name value="value"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="value"></element>
                     <variable value="value"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="value"></valueId>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="unit"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="code"></element>
                     <variable value="unit"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="unit"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="unit"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <documentation value="Package size"></documentation>
         </rule>
      </rule>
      <rule>
         <name value="ingredient"></name>
         <source>
            <context value="medication"></context>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </target>
         <target>
            <context value="ingredient"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACTI"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="PharmSubstance"></name>
            <source>
               <context value="ingredient"></context>
               <element value="itemCodeableConcept"></element>
               <variable value="itemCodeableConcept"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="ingredient"></element>
               <variable value="pharmsubstance"></variable>
            </target>
            <rule>
               <name value="MMAT"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="classCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="MMAT"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="KIND"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="determinerCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="KIND"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="name"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="text"></element>
                  <variable value="text"></variable>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="name"></element>
                  <variable value="name"></variable>
               </target>
               <target>
                  <context value="name"></context>
                  <contextType value="variable"></contextType>
                  <element value="other"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="text"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="coding"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <rule>
                  <name value="formCode"></name>
                  <source>
                     <context value="coding"></context>
                  </source>
                  <target>
                     <context value="pharmsubstance"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="ce"></variable>
                  </target>
                  <dependent>
                     <name value="CodingCE"></name>
                     <variable value="coding"></variable>
                     <variable value="ce"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="strength"></name>
            <source>
               <context value="ingredient"></context>
               <element value="strength"></element>
               <variable value="strength"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="quantity"></element>
               <variable value="quantity"></variable>
            </target>
            <dependent>
               <name value="RatioRTOPQPQ"></name>
               <variable value="strength"></variable>
               <variable value="quantity"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="MedicationTreatmentPlanItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationstatement.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.34&amp;effectiveDate=2019-12-11T11:31:52&amp;language=en-US"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationStatement"></name>
         <type value="MedicationStatement"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SBADM"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="INT"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-MedicationTreatmentPlanItemEntryContentModule"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.34"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="IHE-PHARM-MTP"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.7"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CCD"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.10.20.1.24"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="PCC-MedicationEntryContentModule"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="identifier"></element>
            <variable value="identifier"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="id"></variable>
         </target>
         <dependent>
            <name value="IdentifierII"></name>
            <variable value="identifier"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="narrativeLink"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <rule>
            <name value="valueUrl"></name>
            <source>
               <context value="extension"></context>
               <element value="valueUrl"></element>
               <variable value="valueUrl"></variable>
            </source>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="valueUrl"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="cat1narrativelink"></name>
         <source>
            <context value="medicationStatement"></context>
            <condition value="extension.where(url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists().not()"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <rule>
            <name value="referencetopdf"></name>
            <source>
               <context value="medicationStatement"></context>
            </source>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="contained"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <condition value="('#' + $this.id) in %medicationStatement.medicationReference.reference"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </target>
         <target>
            <context value="consumable"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MANU"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="MP-TemplateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.2"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="MP-TemplateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="2.16.840.1.113883.10.20.1.53"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="manufacturedMaterial"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedMaterial"></element>
               <variable value="manufacturedMaterial"></variable>
            </target>
            <dependent>
               <name value="ManufacturedMaterialEntryContentModuleStatement"></name>
               <variable value="bundle"></variable>
               <variable value="medicationStatement"></variable>
               <variable value="medication"></variable>
               <variable value="manufacturedMaterial"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="onylonedosage"></name>
         <source>
            <context value="medicationStatement"></context>
            <condition value="dosage.count() = 1"></condition>
         </source>
         <rule>
            <name value="normalDose"></name>
            <source>
               <context value="medicationStatement"></context>
               <element value="dosage"></element>
               <variable value="dosage"></variable>
               <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.1"></valueString>
               </parameter>
            </target>
         </rule>
         <documentation value="TODO: AUTHOR1 Medication Treatment Plan Author"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="dosage"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal')"></condition>
         </source>
         <dependent>
            <name value="DosageInstructionsStartStopFrequencySubstanceAdministration"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
         <documentation value="dosage for normal dosing, as no sequences are present there"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="dosage"></element>
            <listMode value="first"></listMode>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryStartStopRoute"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
            <variable value="entryRelationship"></variable>
         </dependent>
         <documentation value="dosage for split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="dosage"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryDosageChangeSubstanceAdministration"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
            <variable value="entryRelationship"></variable>
         </dependent>
         <documentation value="dosage for split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable"></documentation>
      </rule>
      <rule>
         <name value="TreatmentReasonEntryContentModule"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="reasonCode"></element>
            <variable value="reasonCode"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="RSON"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="observation"></element>
            <variable value="observation"></variable>
         </target>
         <dependent>
            <name value="TreatmentReasonEntryContentModule"></name>
            <variable value="reasonCode"></variable>
            <variable value="observation"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="MTP-Reference"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan'"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="REFR"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="extension"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="repeatNumberDefault"></name>
         <source>
            <context value="medicationStatement"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="repeatNumber"></element>
            <variable value="repeatNumber"></variable>
         </target>
         <target>
            <context value="repeatNumber"></context>
            <contextType value="variable"></contextType>
            <element value="nullFlavor"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="NI"></valueString>
            </parameter>
         </target>
         <documentation value="https://github.com/ehealthsuisse/ch-emed/issues/56"></documentation>
      </rule>
      <rule>
         <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="dosage"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
         <documentation value="TODO: Patient Medication Instructions Contains 1.3.6.1.4.1.19376.1.5.3.1.4.3 IHE Patient Medication Instructions (DYNAMIC)"></documentation>
      </rule>
      <rule>
         <name value="AnnotationComment"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="note"></element>
            <variable value="note"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="AnnotationComment"></name>
            <variable value="note"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="Substitution"></name>
         <source>
            <context value="medicationStatement"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-substitution'"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="SubstitutionStatement"></name>
            <variable value="extension"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsStartStopFrequencySubstanceAdministration"></name>
      <typeMode value="none"></typeMode>
      <documentation value="TODO: Tapered Dose
medicationStatement -&gt; substanceAdministration.templateId as templateId, templateId.root = '1.3.6.1.4.1.19376.1.5.3.1.4.8' &quot;taperedDose&quot;;
source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
dosage for normal dosing (without sequences) (Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="normalDose"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="dosage"></context>
            <variable value="dosage"></variable>
         </source>
         <target>
            <variable value="substanceAdministration"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="substanceAdministration"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="effectiveTimeWhen"></name>
         <source>
            <context value="dosage"></context>
            <variable value="dosage"></variable>
         </source>
         <target>
            <variable value="substanceAdministration"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="substanceAdministration"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeWhenNormal"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="route"></name>
         <source>
            <context value="dosage"></context>
            <element value="route"></element>
            <variable value="route"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="route"></variable>
            <variable value="routeCode"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="dosage"></context>
            <variable value="dosage"></variable>
         </source>
         <target>
            <variable value="substanceAdministration"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="substanceAdministration"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="DoseQuantity"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryStartStopRoute"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
dosage for split dosing: effectiveTime (start/stop) &amp; routeCode (Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="substanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="entryRelationship"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="splitDose"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.9"></valueString>
            </parameter>
         </target>
         <documentation value="if the FHIR doucment has no dosage templateId -&gt; create templateId for split dose"></documentation>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="dosage"></context>
            <variable value="dosage"></variable>
         </source>
         <target>
            <variable value="substanceAdministration"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="substanceAdministration"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="route"></name>
         <source>
            <context value="dosage"></context>
            <element value="route"></element>
            <variable value="route"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="route"></variable>
            <variable value="routeCode"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryDosageChangeSubstanceAdministration"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
dosage for split dosing: sequence number, effectiveTime (when), dose quantity, consumable (Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="substanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="entry"></name>
         <type value="entryRelationship"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="sequence"></name>
         <source>
            <context value="dosage"></context>
            <element value="sequence"></element>
            <variable value="sequence"></variable>
         </source>
         <target>
            <context value="entry"></context>
            <contextType value="variable"></contextType>
            <element value="sequenceNumber"></element>
            <variable value="sequenceNumber"></variable>
         </target>
         <target>
            <context value="sequenceNumber"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="sequence"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="dosage"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="entry"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="effectiveTimeWhen"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <variable value="substanceAdministration"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="substanceAdministration"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="EffectiveTimeWhenSplit"></name>
               <variable value="dosage"></variable>
               <variable value="substanceAdministration"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="doseQuantity"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <variable value="substanceAdministration"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="substanceAdministration"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="DoseQuantity"></name>
               <variable value="dosage"></variable>
               <variable value="substanceAdministration"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="consumable"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <variable value="substanceAdministration"></variable>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="substanceAdministration"></valueId>
               </parameter>
            </target>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="consumable"></element>
               <variable value="consumable"></variable>
            </target>
            <target>
               <context value="consumable"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </target>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedMaterial"></element>
               <variable value="manufacturedMaterial"></variable>
            </target>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="nullFlavor"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="NA"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeStartEnd"></name>
      <typeMode value="none"></typeMode>
      <documentation value="effective time low and high for dosage (Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="timing"></name>
         <source>
            <context value="dosage"></context>
            <element value="timing"></element>
            <variable value="timing"></variable>
         </source>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="timing"></context>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </source>
            <rule>
               <name value="bounds"></name>
               <source>
                  <context value="repeat"></context>
                  <type value="Period"></type>
                  <element value="bounds"></element>
                  <variable value="bounds"></variable>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="effectiveTime"></element>
                  <variable value="effectiveTime"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="IVL_TS"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="low"></name>
                  <source>
                     <context value="bounds"></context>
                     <element value="start"></element>
                     <variable value="start"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="low"></element>
                     <variable value="low"></variable>
                  </target>
                  <dependent>
                     <name value="DateTS"></name>
                     <variable value="start"></variable>
                     <variable value="low"></variable>
                  </dependent>
               </rule>
               <rule>
                  <name value="NullFlavorLow"></name>
                  <source>
                     <context value="bounds"></context>
                     <condition value="start.exists().not()"></condition>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="low"></element>
                     <variable value="low"></variable>
                  </target>
                  <target>
                     <context value="low"></context>
                     <contextType value="variable"></contextType>
                     <element value="nullFlavor"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueString value="UNK"></valueString>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="high"></name>
                  <source>
                     <context value="bounds"></context>
                     <element value="end"></element>
                     <variable value="end"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="high"></element>
                     <variable value="high"></variable>
                  </target>
                  <dependent>
                     <name value="DateTS"></name>
                     <variable value="end"></variable>
                     <variable value="high"></variable>
                  </dependent>
               </rule>
               <rule>
                  <name value="NullFlavor high"></name>
                  <source>
                     <context value="bounds"></context>
                     <condition value="end.exists().not()"></condition>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="high"></element>
                     <variable value="high"></variable>
                  </target>
                  <target>
                     <context value="high"></context>
                     <contextType value="variable"></contextType>
                     <element value="nullFlavor"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueString value="UNK"></valueString>
                     </parameter>
                  </target>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DoseQuantity"></name>
      <typeMode value="none"></typeMode>
      <documentation value="dose quantity for dosage (application schema) (Statement)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="doseQuantity"></name>
         <source>
            <context value="dosage"></context>
            <element value="doseAndRate"></element>
            <variable value="doseAndRate"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="doseQuantity"></element>
            <variable value="doseQuantity"></variable>
         </target>
         <rule>
            <name value="quantity"></name>
            <source>
               <context value="doseAndRate"></context>
               <type value="Quantity"></type>
               <element value="dose"></element>
               <variable value="quantity"></variable>
            </source>
            <rule>
               <name value="value"></name>
               <source>
                  <context value="quantity"></context>
                  <element value="value"></element>
                  <variable value="value"></variable>
               </source>
               <target>
                  <context value="doseQuantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="value"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="code"></name>
               <source>
                  <context value="quantity"></context>
                  <element value="code"></element>
                  <variable value="code"></variable>
               </source>
               <target>
                  <context value="doseQuantity"></context>
                  <contextType value="variable"></contextType>
                  <element value="unit"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="code"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="TreatmentReasonEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: reasonCode Coding (e.g. http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-medicationstatement)
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.41
Treatment Reason (Statement, Prescription)"></documentation>
      <input>
         <name value="reasonCode"></name>
         <type value="Coding"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="observation"></name>
         <type value="Observation"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="OBS"></name>
         <source>
            <context value="reasonCode"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="OBS"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="EVN"></name>
         <source>
            <context value="reasonCode"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="EVN"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="TreatmentReasonEntryContentModule"></name>
         <source>
            <context value="reasonCode"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.41"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="reasonCode"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="75326-9"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystem"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.6.1"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="displayName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Problem"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystemName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="LOINC"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="reasonCode"></context>
            <element value="text"></element>
            <variable value="reasonText"></variable>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <rule>
            <name value="text"></name>
            <source>
               <context value="reasonText"></context>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="data"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="reasonText"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="id"></name>
            <source>
               <context value="reasonCode"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="reasonCode"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="statusCode"></name>
         <source>
            <context value="reasonCode"></context>
         </source>
         <target>
            <context value="observation"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="code"></variable>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="MTPReferenceEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-ext-treatmentplan.html
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.45&amp;effectiveDate=2017-01-10T15:34:25&amp;language=en-US"></documentation>
      <input>
         <name value="ext"></name>
         <type value="Extension"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SBADM"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="INT"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="referenceTo-MTP-PlanItemGeneralSpecificationTemplateId"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.10"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-templateId"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.45"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="ext"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'id'"></condition>
         </source>
         <rule>
            <name value="id"></name>
            <source>
               <context value="extension"></context>
               <element value="valueIdentifier"></element>
               <variable value="valueIdentifier"></variable>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="id"></element>
               <variable value="id"></variable>
            </target>
            <dependent>
               <name value="IdentifierII"></name>
               <variable value="valueIdentifier"></variable>
               <variable value="id"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MTPItem"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystem"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.2.2"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="displayName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="Medication Treatment Plan Item"></valueString>
            </parameter>
         </target>
         <target>
            <context value="code"></context>
            <contextType value="variable"></contextType>
            <element value="codeSystemName"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="IHE Pharmacy Item Type List"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="ext"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </target>
         <target>
            <context value="consumable"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedMaterial"></element>
            <variable value="manufacturedMaterial"></variable>
         </target>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="nullFlavor"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="NA"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="externalDocumentId"></name>
         <source>
            <context value="ext"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'externalDocumentId'"></condition>
         </source>
         <rule>
            <name value="id"></name>
            <source>
               <context value="extension"></context>
               <element value="valueIdentifier"></element>
               <variable value="valueIdentifier"></variable>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="typeCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="XCRPT"></valueString>
               </parameter>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="externalDocument"></element>
               <variable value="externalDocument"></variable>
            </target>
            <target>
               <context value="externalDocument"></context>
               <contextType value="variable"></contextType>
               <element value="id"></element>
               <variable value="id"></variable>
            </target>
            <dependent>
               <name value="IdentifierII"></name>
               <variable value="valueIdentifier"></variable>
               <variable value="id"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-dosage-nonstructured.html
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.52
Dosage Instruction (Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SBADM"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="INT"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.52"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="dosage"></context>
            <element value="text"></element>
            <variable value="noteText"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <rule>
            <name value="text"></name>
            <source>
               <context value="noteText"></context>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="data"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="noteText"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="id"></name>
            <source>
               <context value="dosage"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="dosage"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </target>
         <target>
            <context value="consumable"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedMaterial"></element>
            <variable value="manufacturedMaterial"></variable>
         </target>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="nullFlavor"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="NA"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="SubstitutionDispense"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
target: Substitution act Contains 1.3.6.1.4.1.19376.1.9.1.3.9.2 IHE Substitution Act Content Module
Substitution (Dispense)"></documentation>
      <input>
         <name value="substitution"></name>
         <type value="Substitution"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ACT"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="EVN"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="EVN"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.9.2"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="substitution"></name>
         <source>
            <context value="substitution"></context>
            <element value="type"></element>
            <variable value="type"></variable>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="type"></variable>
            <variable value="code"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="statusCode"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModuleDispense"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33&amp;effectiveDate=2019-12-11T11:34:24&amp;language=en-US"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationDispense"></name>
         <type value="MedicationDispense"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="manufacturedMaterial"></name>
         <type value="ManufacturedMaterial"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="MMAT"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MMAT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="KIND"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="determinerCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="KIND"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-ManufacturedMaterialContentModule"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.33"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="name"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="brandname"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="id"></name>
            <source>
               <context value="code"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="code"></context>
                  <contextType value="variable"></contextType>
                  <element value="originalText"></element>
                  <variable value="text"></variable>
               </target>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="#dis.no.brandedmedication"></documentation>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="code"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <target>
               <context value="code"></context>
               <contextType value="variable"></contextType>
               <element value="originalText"></element>
               <variable value="text"></variable>
            </target>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="form"></name>
         <source>
            <context value="medication"></context>
            <element value="form"></element>
            <variable value="form"></variable>
         </source>
         <rule>
            <name value="formCode"></name>
            <source>
               <context value="form"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="formCode"></element>
               <variable value="formCode"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="formCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="asContent"></element>
            <variable value="asContent"></variable>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="CONT"></valueString>
            </parameter>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="containerPackagedMedicine"></element>
            <variable value="containerPackagedMedicine"></variable>
         </target>
         <rule>
            <name value="CONT"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="classCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="CONT"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="INSTANCE"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="determinerCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="INSTANCE"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="pharm-code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="pharm-name"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="form"></name>
            <source>
               <context value="medication"></context>
               <element value="form"></element>
               <variable value="form"></variable>
            </source>
            <rule>
               <name value="pharm-formCode"></name>
               <source>
                  <context value="form"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="formCode"></element>
                  <variable value="formCode"></variable>
               </target>
               <dependent>
                  <name value="CodingCE"></name>
                  <variable value="coding"></variable>
                  <variable value="formCode"></variable>
               </dependent>
            </rule>
         </rule>
         <rule>
            <name value="amount"></name>
            <source>
               <context value="medication"></context>
               <element value="amount"></element>
               <variable value="amount"></variable>
            </source>
            <rule>
               <name value="numerator"></name>
               <source>
                  <context value="amount"></context>
                  <element value="numerator"></element>
                  <variable value="numerator"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="capacityQuantity"></element>
                  <variable value="capacityQuantity"></variable>
               </target>
               <rule>
                  <name value="value"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="value"></element>
                     <variable value="value"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="value"></valueId>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="unit"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="code"></element>
                     <variable value="unit"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="unit"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="unit"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <documentation value="Package size"></documentation>
         </rule>
      </rule>
      <rule>
         <name value="ingredient"></name>
         <source>
            <context value="medication"></context>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </target>
         <target>
            <context value="ingredient"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACTI"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="PharmSubstance"></name>
            <source>
               <context value="ingredient"></context>
               <element value="itemCodeableConcept"></element>
               <variable value="itemCodeableConcept"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="ingredient"></element>
               <variable value="pharmsubstance"></variable>
            </target>
            <rule>
               <name value="MMAT"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="classCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="MMAT"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="KIND"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="determinerCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="KIND"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="name"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="text"></element>
                  <variable value="text"></variable>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="name"></element>
                  <variable value="name"></variable>
               </target>
               <target>
                  <context value="name"></context>
                  <contextType value="variable"></contextType>
                  <element value="other"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="text"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="coding"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <rule>
                  <name value="formCode"></name>
                  <source>
                     <context value="coding"></context>
                  </source>
                  <target>
                     <context value="pharmsubstance"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="ce"></variable>
                  </target>
                  <dependent>
                     <name value="CodingCE"></name>
                     <variable value="coding"></variable>
                     <variable value="ce"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="strength"></name>
            <source>
               <context value="ingredient"></context>
               <element value="strength"></element>
               <variable value="strength"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="quantity"></element>
               <variable value="quantity"></variable>
            </target>
            <dependent>
               <name value="RatioRTOPQPQ"></name>
               <variable value="strength"></variable>
               <variable value="quantity"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DispenseItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationdispense.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.42"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationDispense"></name>
         <type value="MedicationDispense"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SPLY"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SPLY"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="EVN"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="EVN"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-DispenseItemEntryContentModule"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.42"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="IHE-PHARM-DIS"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.4"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="supplyEntry"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.3"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CCD"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.10.20.1.34"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="identifier"></element>
            <variable value="identifier"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="id"></variable>
         </target>
         <dependent>
            <name value="IdentifierII"></name>
            <variable value="identifier"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="narrativeLink"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <rule>
            <name value="valueUrl"></name>
            <source>
               <context value="extension"></context>
               <element value="valueUrl"></element>
               <variable value="valueUrl"></variable>
            </source>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="valueUrl"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="reference"></name>
         <source>
            <context value="medicationDispense"></context>
            <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <target>
            <context value="reference"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="#refpdf"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="contained"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <condition value="('#' + $this.id) in %medicationDispense.medicationReference.reference"></condition>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="product"></element>
            <variable value="product"></variable>
         </target>
         <target>
            <context value="product"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MANU"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="MP-TemplateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.2"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="MP-TemplateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="2.16.840.1.113883.10.20.1.53"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="manufacturedMaterial"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedMaterial"></element>
               <variable value="manufacturedMaterial"></variable>
            </target>
            <dependent>
               <name value="ManufacturedMaterialEntryContentModuleDispense"></name>
               <variable value="bundle"></variable>
               <variable value="medicationDispense"></variable>
               <variable value="medication"></variable>
               <variable value="manufacturedMaterial"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="MTP-Reference"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan'"></condition>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="REFR"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="extension"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
         <documentation value="TODO: AUTHOR1 Medication Treatment Plan Author"></documentation>
      </rule>
      <rule>
         <name value="onylonedosage"></name>
         <source>
            <context value="medicationDispense"></context>
            <condition value="dosageInstruction.count() = 1"></condition>
         </source>
         <rule>
            <name value="normalDose"></name>
            <source>
               <context value="medicationDispense"></context>
               <element value="dosageInstruction"></element>
               <variable value="dosage"></variable>
               <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.1"></valueString>
               </parameter>
            </target>
         </rule>
         <documentation value="#24 missing template it if ch-emed-dosage-nonstructured"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal')"></condition>
         </source>
         <dependent>
            <name value="DosageInstructionsStartStopFrequencySupply"></name>
            <variable value="dosage"></variable>
            <variable value="supply"></variable>
         </dependent>
         <documentation value="dosage for normal dosing, as no sequences are present there"></documentation>
      </rule>
      <rule>
         <name value="entryRelationship"></name>
         <source>
            <context value="medicationDispense"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="medicationDispense"></context>
            </source>
            <target>
               <context value="entryRelationship"></context>
               <contextType value="variable"></contextType>
               <element value="substanceAdministration"></element>
               <variable value="substanceAdministration"></variable>
            </target>
            <rule>
               <name value="DosageSubstanceAdministration"></name>
               <source>
                  <context value="medicationDispense"></context>
                  <element value="dosageInstruction"></element>
                  <listMode value="first"></listMode>
                  <variable value="dosage"></variable>
                  <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split')"></condition>
               </source>
               <target>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="substanceAdministration"></valueId>
                  </parameter>
               </target>
               <dependent>
                  <name value="DosageInstructionsEntryStartStopRouteConsumable"></name>
                  <variable value="dosage"></variable>
                  <variable value="entryRelationship"></variable>
                  <variable value="substanceAdministration"></variable>
               </dependent>
               <documentation value="split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode &amp; consumable"></documentation>
            </rule>
            <rule>
               <name value="DosageSubstanceAdministration"></name>
               <source>
                  <context value="medicationDispense"></context>
                  <element value="dosageInstruction"></element>
                  <variable value="dosage"></variable>
                  <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split')"></condition>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="entryRelationship"></element>
                  <variable value="entryRelationship"></variable>
               </target>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="typeCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="COMP"></valueString>
                  </parameter>
               </target>
               <dependent>
                  <name value="DosageInstructionsEntryDosageChangeEntryRelationship"></name>
                  <variable value="dosage"></variable>
                  <variable value="entryRelationship"></variable>
               </dependent>
               <documentation value="split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable"></documentation>
            </rule>
         </rule>
         <documentation value="dosage for split dosing, as sequences are present there"></documentation>
      </rule>
      <rule>
         <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
         <documentation value="TODO: Precondition Criterion"></documentation>
      </rule>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="supplyQuantity"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="supplyQuantity"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
         </rule>
         <documentation value="Number of packages"></documentation>
      </rule>
      <rule>
         <name value="AnnotationComment"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="note"></element>
            <variable value="note"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="AnnotationComment"></name>
            <variable value="note"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="Substitution"></name>
         <source>
            <context value="medicationDispense"></context>
            <element value="substitution"></element>
            <variable value="substitution"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="SubstitutionDispense"></name>
            <variable value="substitution"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsStartStopFrequencySupply"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.35
dosage for normal dosing (without sequences) (Dispense)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="entryRelationship"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <rule>
            <name value="COMP"></name>
            <source>
               <context value="dosage"></context>
            </source>
            <target>
               <context value="entryRelationship"></context>
               <contextType value="variable"></contextType>
               <element value="typeCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="COMP"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="substanceAdministration"></name>
            <source>
               <context value="dosage"></context>
            </source>
            <target>
               <context value="entryRelationship"></context>
               <contextType value="variable"></contextType>
               <element value="substanceAdministration"></element>
               <variable value="substanceAdministration"></variable>
            </target>
            <rule>
               <name value="SBADM"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="classCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="SBADM"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="INT"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="moodCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="INT"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="templateId"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="templateId"></element>
                  <variable value="templateId"></variable>
               </target>
               <target>
                  <context value="templateId"></context>
                  <contextType value="variable"></contextType>
                  <element value="root"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="1.3.6.1.4.1.19376.1.9.1.3.6"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="normalDose"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="templateId"></element>
                  <variable value="templateId"></variable>
               </target>
               <target>
                  <context value="templateId"></context>
                  <contextType value="variable"></contextType>
                  <element value="root"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.1"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="effectiveTimeStartEnd"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <variable value="substanceAdministration"></variable>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="substanceAdministration"></valueId>
                  </parameter>
               </target>
               <dependent>
                  <name value="EffectiveTimeStartEnd"></name>
                  <variable value="dosage"></variable>
                  <variable value="substanceAdministration"></variable>
               </dependent>
            </rule>
            <rule>
               <name value="effectiveTimeWhen"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <variable value="substanceAdministration"></variable>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="substanceAdministration"></valueId>
                  </parameter>
               </target>
               <dependent>
                  <name value="EffectiveTimeWhenNormal"></name>
                  <variable value="dosage"></variable>
                  <variable value="substanceAdministration"></variable>
               </dependent>
            </rule>
            <rule>
               <name value="route"></name>
               <source>
                  <context value="dosage"></context>
                  <element value="route"></element>
                  <variable value="route"></variable>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="routeCode"></element>
                  <variable value="routeCode"></variable>
               </target>
               <dependent>
                  <name value="CodeableConceptCE"></name>
                  <variable value="route"></variable>
                  <variable value="routeCode"></variable>
               </dependent>
            </rule>
            <rule>
               <name value="doseQuantity"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <variable value="substanceAdministration"></variable>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="substanceAdministration"></valueId>
                  </parameter>
               </target>
               <dependent>
                  <name value="DoseQuantity"></name>
                  <variable value="dosage"></variable>
                  <variable value="substanceAdministration"></variable>
               </dependent>
            </rule>
            <rule>
               <name value="consumable"></name>
               <source>
                  <context value="dosage"></context>
               </source>
               <target>
                  <variable value="substanceAdministration"></variable>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="substanceAdministration"></valueId>
                  </parameter>
               </target>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="consumable"></element>
                  <variable value="consumable"></variable>
               </target>
               <target>
                  <context value="consumable"></context>
                  <contextType value="variable"></contextType>
                  <element value="manufacturedProduct"></element>
                  <variable value="manufacturedProduct"></variable>
               </target>
               <target>
                  <context value="manufacturedProduct"></context>
                  <contextType value="variable"></contextType>
                  <element value="manufacturedMaterial"></element>
                  <variable value="manufacturedMaterial"></variable>
               </target>
               <target>
                  <context value="manufacturedMaterial"></context>
                  <contextType value="variable"></contextType>
                  <element value="nullFlavor"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="NA"></valueString>
                  </parameter>
               </target>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryStartStopRouteConsumable"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
dosage for split dosing: effectiveTime (start/stop) &amp; routeCode &amp; consumable (Dispense)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entryRelationship"></name>
         <type value="entryRelationship"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="COMP"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="SBADM"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="INT"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.6"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="splitDose"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.9"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="effectiveTimeStartEnd"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <variable value="substanceAdministration"></variable>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="substanceAdministration"></valueId>
            </parameter>
         </target>
         <dependent>
            <name value="EffectiveTimeStartEnd"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="route"></name>
         <source>
            <context value="dosage"></context>
            <element value="route"></element>
            <variable value="route"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="routeCode"></element>
            <variable value="routeCode"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="route"></variable>
            <variable value="routeCode"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="consumable"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </target>
         <target>
            <context value="consumable"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedMaterial"></element>
            <variable value="manufacturedMaterial"></variable>
         </target>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="nullFlavor"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="NA"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="DosageInstructionsEntryDosageChangeEntryRelationship"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split
target: https://art-decor.org/art-decor/decor-templates--ch-pharm-?id=2.16.756.5.30.1.1.10.4.36
dosage for split dosing: sequence number, effectiveTime (when), dose quantity, consumable (Dispense)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="entryRelationship"></name>
         <type value="entryRelationship"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="sequence"></name>
         <source>
            <context value="dosage"></context>
            <element value="sequence"></element>
            <variable value="sequence"></variable>
         </source>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="sequenceNumber"></element>
            <variable value="sequenceNumber"></variable>
         </target>
         <target>
            <context value="sequenceNumber"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueId value="sequence"></valueId>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="dosage"></name>
         <source>
            <context value="dosage"></context>
         </source>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="effectiveTimeWhen"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="substanceAdministration"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="EffectiveTimeWhenSplit"></name>
               <variable value="dosage"></variable>
               <variable value="substanceAdministration"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="doseQuantity"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="substanceAdministration"></valueId>
               </parameter>
            </target>
            <dependent>
               <name value="DoseQuantity"></name>
               <variable value="dosage"></variable>
               <variable value="substanceAdministration"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="consumable"></name>
            <source>
               <context value="dosage"></context>
               <variable value="dosage"></variable>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="consumable"></element>
               <variable value="consumable"></variable>
            </target>
            <target>
               <context value="consumable"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedProduct"></element>
               <variable value="manufacturedProduct"></variable>
            </target>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedMaterial"></element>
               <variable value="manufacturedMaterial"></variable>
            </target>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="nullFlavor"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="NA"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeWhenNormal"></name>
      <typeMode value="none"></typeMode>
      <documentation value="effective time when for normal dosage (Dispense, Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="timing"></name>
         <source>
            <context value="dosage"></context>
            <element value="timing"></element>
            <variable value="timing"></variable>
         </source>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="timing"></context>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </source>
            <rule>
               <name value="when"></name>
               <source>
                  <context value="repeat"></context>
                  <condition value="$this.when.count() = 1"></condition>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="effectiveTime"></element>
                  <variable value="effectiveTime"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="EIVL_TS"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="effectiveTime"></context>
                  <contextType value="variable"></contextType>
                  <element value="operator"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="A"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="when"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="event"></element>
                     <variable value="event"></variable>
                  </target>
                  <target>
                     <context value="event"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="when"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="when"></name>
               <source>
                  <context value="repeat"></context>
                  <condition value="$this.when.count() &gt; 1"></condition>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="effectiveTime"></element>
                  <variable value="effectiveTime"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="SXPR_TS"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="effectiveTime"></context>
                  <contextType value="variable"></contextType>
                  <element value="operator"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="A"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="comp"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <listMode value="first"></listMode>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="comp"></element>
                     <variable value="comp"></variable>
                     <transform value="create"></transform>
                     <parameter>
                        <valueString value="EIVL_TS"></valueString>
                     </parameter>
                  </target>
                  <rule>
                     <name value="when"></name>
                     <source>
                        <context value="when"></context>
                     </source>
                     <target>
                        <context value="comp"></context>
                        <contextType value="variable"></contextType>
                        <element value="event"></element>
                        <variable value="event"></variable>
                     </target>
                     <target>
                        <context value="event"></context>
                        <contextType value="variable"></contextType>
                        <element value="code"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="when"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="compnotfirst"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <listMode value="not_first"></listMode>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="comp"></element>
                     <variable value="comp"></variable>
                     <transform value="create"></transform>
                     <parameter>
                        <valueString value="EIVL_TS"></valueString>
                     </parameter>
                  </target>
                  <target>
                     <context value="comp"></context>
                     <contextType value="variable"></contextType>
                     <element value="operator"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueString value="I"></valueString>
                     </parameter>
                  </target>
                  <rule>
                     <name value="when"></name>
                     <source>
                        <context value="when"></context>
                     </source>
                     <target>
                        <context value="comp"></context>
                        <contextType value="variable"></contextType>
                        <element value="event"></element>
                        <variable value="event"></variable>
                     </target>
                     <target>
                        <context value="event"></context>
                        <contextType value="variable"></contextType>
                        <element value="code"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="when"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="EffectiveTimeWhenSplit"></name>
      <typeMode value="none"></typeMode>
      <documentation value="effective time when for split dosage (Dispense, Statement, Prescription)"></documentation>
      <input>
         <name value="dosage"></name>
         <type value="Dosage"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="timing"></name>
         <source>
            <context value="dosage"></context>
            <element value="timing"></element>
            <variable value="timing"></variable>
         </source>
         <rule>
            <name value="repeat"></name>
            <source>
               <context value="timing"></context>
               <element value="repeat"></element>
               <variable value="repeat"></variable>
            </source>
            <rule>
               <name value="when"></name>
               <source>
                  <context value="repeat"></context>
                  <condition value="$this.when.count() = 1"></condition>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="effectiveTime"></element>
                  <variable value="effectiveTime"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="EIVL_TS"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="when"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="event"></element>
                     <variable value="event"></variable>
                  </target>
                  <target>
                     <context value="event"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="when"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="when"></name>
               <source>
                  <context value="repeat"></context>
                  <condition value="$this.when.count() &gt; 1"></condition>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="effectiveTime"></element>
                  <variable value="effectiveTime"></variable>
                  <transform value="create"></transform>
                  <parameter>
                     <valueString value="SXPR_TS"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="effectiveTime"></context>
                  <contextType value="variable"></contextType>
                  <element value="operator"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="A"></valueString>
                  </parameter>
               </target>
               <rule>
                  <name value="comp"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <listMode value="first"></listMode>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="comp"></element>
                     <variable value="comp"></variable>
                     <transform value="create"></transform>
                     <parameter>
                        <valueString value="EIVL_TS"></valueString>
                     </parameter>
                  </target>
                  <rule>
                     <name value="when"></name>
                     <source>
                        <context value="when"></context>
                     </source>
                     <target>
                        <context value="comp"></context>
                        <contextType value="variable"></contextType>
                        <element value="event"></element>
                        <variable value="event"></variable>
                     </target>
                     <target>
                        <context value="event"></context>
                        <contextType value="variable"></contextType>
                        <element value="code"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="when"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
               <rule>
                  <name value="compnotfirst"></name>
                  <source>
                     <context value="repeat"></context>
                     <element value="when"></element>
                     <listMode value="not_first"></listMode>
                     <variable value="when"></variable>
                  </source>
                  <target>
                     <context value="effectiveTime"></context>
                     <contextType value="variable"></contextType>
                     <element value="comp"></element>
                     <variable value="comp"></variable>
                     <transform value="create"></transform>
                     <parameter>
                        <valueString value="EIVL_TS"></valueString>
                     </parameter>
                  </target>
                  <target>
                     <context value="comp"></context>
                     <contextType value="variable"></contextType>
                     <element value="operator"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueString value="I"></valueString>
                     </parameter>
                  </target>
                  <rule>
                     <name value="when"></name>
                     <source>
                        <context value="when"></context>
                     </source>
                     <target>
                        <context value="comp"></context>
                        <contextType value="variable"></contextType>
                        <element value="event"></element>
                        <variable value="event"></variable>
                     </target>
                     <target>
                        <context value="event"></context>
                        <contextType value="variable"></contextType>
                        <element value="code"></element>
                        <transform value="copy"></transform>
                        <parameter>
                           <valueId value="when"></valueId>
                        </parameter>
                     </target>
                  </rule>
               </rule>
            </rule>
         </rule>
      </rule>
   </group>
   <group>
      <name value="SubstitutionRequest"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module"></documentation>
      <input>
         <name value="substitution"></name>
         <type value="Substitution"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ACT"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="DEF"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="DEF"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.9.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="substitution"></name>
         <source>
            <context value="substitution"></context>
            <element value="allowedCodeableConcept"></element>
            <variable value="allowedCC"></variable>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="allowedCC"></variable>
            <variable value="code"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="statusCode"></name>
         <source>
            <context value="substitution"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="SubstitutionStatement"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: Substitution permission Contains 1.3.6.1.4.1.19376.1.9.1.3.9.1 IHE Substitution Permission Content Module"></documentation>
      <input>
         <name value="extension"></name>
         <type value="Extension"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="act"></name>
         <type value="Act"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="ACT"></name>
         <source>
            <context value="extension"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="DEF"></name>
         <source>
            <context value="extension"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="DEF"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="extension"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.9.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="extension"></name>
         <source>
            <context value="extension"></context>
            <element value="valueCodeableConcept"></element>
            <variable value="valueCC"></variable>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="code"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="valueCC"></variable>
            <variable value="code"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="statusCode"></name>
         <source>
            <context value="extension"></context>
         </source>
         <target>
            <context value="act"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
   </group>
   <group>
      <name value="PrescribedQuantity"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38"></documentation>
      <input>
         <name value="dispenseRequest"></name>
         <type value="DispenseRequest"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SPLY"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SPLY"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="RQO"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="RQO"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.8"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="independentInd"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="independentInd"></element>
            <variable value="independentInd"></variable>
         </target>
         <target>
            <context value="independentInd"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="false"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="dispenseRequest"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="quant"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="quant"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
         </rule>
         <documentation value="Number of packages"></documentation>
      </rule>
   </group>
   <group>
      <name value="PrescribedQuantityUnit"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?id=2.16.756.5.30.1.1.10.4.38"></documentation>
      <input>
         <name value="dispenseRequest"></name>
         <type value="DispenseRequest"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="supply"></name>
         <type value="Supply"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SPLY"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SPLY"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="RQO"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="RQO"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="TemplateId"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.8"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="independentInd"></name>
         <source>
            <context value="dispenseRequest"></context>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="independentInd"></element>
            <variable value="independentInd"></variable>
         </target>
         <target>
            <context value="independentInd"></context>
            <contextType value="variable"></contextType>
            <element value="value"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="false"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="quantity"></name>
         <source>
            <context value="dispenseRequest"></context>
            <element value="quantity"></element>
            <variable value="quantity"></variable>
         </source>
         <target>
            <context value="supply"></context>
            <contextType value="variable"></contextType>
            <element value="quantity"></element>
            <variable value="quant"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="quantity"></context>
               <element value="value"></element>
               <variable value="value"></variable>
            </source>
            <target>
               <context value="quant"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="value"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="unit"></name>
            <source>
               <context value="quantity"></context>
               <element value="unit"></element>
               <variable value="unit"></variable>
            </source>
            <target>
               <context value="quant"></context>
               <contextType value="variable"></contextType>
               <element value="unit"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="unit"></valueId>
               </parameter>
            </target>
         </rule>
         <documentation value="Number of packages"></documentation>
      </rule>
   </group>
   <group>
      <name value="ManufacturedMaterialEntryContentModulePrescription"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.33"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medication"></name>
         <type value="Medication"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="manufacturedMaterial"></name>
         <type value="ManufacturedMaterial"></type>
         <mode value="target"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="MMAT"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MMAT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="KIND"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="determinerCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="KIND"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-ManufacturedMaterialContentModule"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.33"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="templateId"></name>
         <source>
            <context value="medication"></context>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.1"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="name"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="brandname"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <rule>
            <name value="id"></name>
            <source>
               <context value="code"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="code"></context>
                  <contextType value="variable"></contextType>
                  <element value="originalText"></element>
                  <variable value="text"></variable>
               </target>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
            <documentation value="#pre.no.brandedmedication"></documentation>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="code"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="code"></variable>
            </target>
            <target>
               <context value="code"></context>
               <contextType value="variable"></contextType>
               <element value="originalText"></element>
               <variable value="text"></variable>
            </target>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="form"></name>
         <source>
            <context value="medication"></context>
            <element value="form"></element>
            <variable value="form"></variable>
         </source>
         <rule>
            <name value="formCode"></name>
            <source>
               <context value="form"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="manufacturedMaterial"></context>
               <contextType value="variable"></contextType>
               <element value="formCode"></element>
               <variable value="formCode"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="formCode"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medication"></context>
            <element value="code"></element>
            <variable value="code"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="asContent"></element>
            <variable value="asContent"></variable>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="CONT"></valueString>
            </parameter>
         </target>
         <target>
            <context value="asContent"></context>
            <contextType value="variable"></contextType>
            <element value="containerPackagedMedicine"></element>
            <variable value="containerPackagedMedicine"></variable>
         </target>
         <rule>
            <name value="CONT"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="classCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="CONT"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="INSTANCE"></name>
            <source>
               <context value="code"></context>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="determinerCode"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="INSTANCE"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="pharm-code"></name>
            <source>
               <context value="code"></context>
               <element value="coding"></element>
               <variable value="coding"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="code"></element>
               <variable value="ce"></variable>
            </target>
            <dependent>
               <name value="CodingCE"></name>
               <variable value="coding"></variable>
               <variable value="ce"></variable>
            </dependent>
         </rule>
         <rule>
            <name value="pharm-name"></name>
            <source>
               <context value="code"></context>
               <element value="text"></element>
               <variable value="text"></variable>
            </source>
            <target>
               <context value="containerPackagedMedicine"></context>
               <contextType value="variable"></contextType>
               <element value="name"></element>
               <variable value="name"></variable>
            </target>
            <target>
               <context value="name"></context>
               <contextType value="variable"></contextType>
               <element value="other"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="text"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="form"></name>
            <source>
               <context value="medication"></context>
               <element value="form"></element>
               <variable value="form"></variable>
            </source>
            <rule>
               <name value="pharm-formCode"></name>
               <source>
                  <context value="form"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="formCode"></element>
                  <variable value="formCode"></variable>
               </target>
               <dependent>
                  <name value="CodingCE"></name>
                  <variable value="coding"></variable>
                  <variable value="formCode"></variable>
               </dependent>
            </rule>
         </rule>
         <rule>
            <name value="amount"></name>
            <source>
               <context value="medication"></context>
               <element value="amount"></element>
               <variable value="amount"></variable>
            </source>
            <rule>
               <name value="numerator"></name>
               <source>
                  <context value="amount"></context>
                  <element value="numerator"></element>
                  <variable value="numerator"></variable>
               </source>
               <target>
                  <context value="containerPackagedMedicine"></context>
                  <contextType value="variable"></contextType>
                  <element value="capacityQuantity"></element>
                  <variable value="capacityQuantity"></variable>
               </target>
               <rule>
                  <name value="value"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="value"></element>
                     <variable value="value"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="value"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="value"></valueId>
                     </parameter>
                  </target>
               </rule>
               <rule>
                  <name value="unit"></name>
                  <source>
                     <context value="numerator"></context>
                     <element value="code"></element>
                     <variable value="unit"></variable>
                  </source>
                  <target>
                     <context value="capacityQuantity"></context>
                     <contextType value="variable"></contextType>
                     <element value="unit"></element>
                     <transform value="copy"></transform>
                     <parameter>
                        <valueId value="unit"></valueId>
                     </parameter>
                  </target>
               </rule>
            </rule>
            <rule>
               <name value="PrescribedQuantity"></name>
               <source>
                  <context value="medicationRequest"></context>
                  <element value="dispenseRequest"></element>
                  <variable value="dispenseRequest"></variable>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="entryRelationship"></element>
                  <variable value="entryRelationship"></variable>
               </target>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="typeCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="COMP"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="supply"></element>
                  <variable value="supply"></variable>
               </target>
               <dependent>
                  <name value="PrescribedQuantity"></name>
                  <variable value="dispenseRequest"></variable>
                  <variable value="supply"></variable>
               </dependent>
               <documentation value="IHE-DIS: Case 1: If the product-element contains package information, the unit attribute is not be present"></documentation>
            </rule>
            <documentation value="Package size"></documentation>
         </rule>
         <rule>
            <name value="noAmount"></name>
            <source>
               <context value="medication"></context>
               <condition value="$this.amount.exists() = false"></condition>
            </source>
            <rule>
               <name value="PrescribedQuantityUnit"></name>
               <source>
                  <context value="medicationRequest"></context>
                  <element value="dispenseRequest"></element>
                  <variable value="dispenseRequest"></variable>
               </source>
               <target>
                  <context value="substanceAdministration"></context>
                  <contextType value="variable"></contextType>
                  <element value="entryRelationship"></element>
                  <variable value="entryRelationship"></variable>
               </target>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="typeCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="COMP"></valueString>
                  </parameter>
               </target>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="supply"></element>
                  <variable value="supply"></variable>
               </target>
               <dependent>
                  <name value="PrescribedQuantityUnit"></name>
                  <variable value="dispenseRequest"></variable>
                  <variable value="supply"></variable>
               </dependent>
            </rule>
            <documentation value="IHE-DIS: Case 2: If the product-element does not contain package information, the unit attribut is present and the value SHALL be out of the UCUM code system"></documentation>
         </rule>
      </rule>
      <rule>
         <name value="ingredient"></name>
         <source>
            <context value="medication"></context>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </source>
         <target>
            <context value="manufacturedMaterial"></context>
            <contextType value="variable"></contextType>
            <element value="ingredient"></element>
            <variable value="ingredient"></variable>
         </target>
         <target>
            <context value="ingredient"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="ACTI"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="PharmSubstance"></name>
            <source>
               <context value="ingredient"></context>
               <element value="itemCodeableConcept"></element>
               <variable value="itemCodeableConcept"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="ingredient"></element>
               <variable value="pharmsubstance"></variable>
            </target>
            <rule>
               <name value="MMAT"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="classCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="MMAT"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="KIND"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="determinerCode"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueString value="KIND"></valueString>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="name"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="text"></element>
                  <variable value="text"></variable>
               </source>
               <target>
                  <context value="pharmsubstance"></context>
                  <contextType value="variable"></contextType>
                  <element value="name"></element>
                  <variable value="name"></variable>
               </target>
               <target>
                  <context value="name"></context>
                  <contextType value="variable"></contextType>
                  <element value="other"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="text"></valueId>
                  </parameter>
               </target>
            </rule>
            <rule>
               <name value="coding"></name>
               <source>
                  <context value="itemCodeableConcept"></context>
                  <element value="coding"></element>
                  <variable value="coding"></variable>
               </source>
               <rule>
                  <name value="formCode"></name>
                  <source>
                     <context value="coding"></context>
                  </source>
                  <target>
                     <context value="pharmsubstance"></context>
                     <contextType value="variable"></contextType>
                     <element value="code"></element>
                     <variable value="ce"></variable>
                  </target>
                  <dependent>
                     <name value="CodingCE"></name>
                     <variable value="coding"></variable>
                     <variable value="ce"></variable>
                  </dependent>
               </rule>
            </rule>
         </rule>
         <rule>
            <name value="strength"></name>
            <source>
               <context value="ingredient"></context>
               <element value="strength"></element>
               <variable value="strength"></variable>
            </source>
            <target>
               <context value="ingredient"></context>
               <contextType value="variable"></contextType>
               <element value="quantity"></element>
               <variable value="quantity"></variable>
            </target>
            <dependent>
               <name value="RatioRTOPQPQ"></name>
               <variable value="strength"></variable>
               <variable value="quantity"></variable>
            </dependent>
         </rule>
      </rule>
   </group>
   <group>
      <name value="PrescriptionItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/branches/master/StructureDefinition-ch-emed-medicationrequest.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.43"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="medicationRequest"></name>
         <type value="MedicationRequest"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="substanceAdministration"></name>
         <type value="SubstanceAdministration"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="SBADM"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="SBADM"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="INT"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="INT"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-PrescriptionItemEntryContentModule"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.43"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="PrescriptionItemEntryTemplateId"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.2"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CCD"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.840.1.113883.10.20.1.24"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="PCC-MedicationEntryContentModule"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="identifier"></element>
            <variable value="identifier"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="id"></variable>
         </target>
         <dependent>
            <name value="IdentifierII"></name>
            <variable value="identifier"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="narrativeLink"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <rule>
            <name value="valueUrl"></name>
            <source>
               <context value="extension"></context>
               <element value="valueUrl"></element>
               <variable value="valueUrl"></variable>
            </source>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="valueUrl"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="cat1narrativelink"></name>
         <source>
            <context value="medicationRequest"></context>
            <condition value="extension.where(url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists().not()"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <target>
            <context value="text"></context>
            <contextType value="variable"></contextType>
            <element value="reference"></element>
            <variable value="reference"></variable>
         </target>
         <rule>
            <name value="referencetopdf"></name>
            <source>
               <context value="medicationRequest"></context>
            </source>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="medicationRequest"></context>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="dispenseRequest"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="dispenseRequest"></element>
            <variable value="dispenseRequest"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="repeatNumber"></element>
            <variable value="repeatNumber"></variable>
         </target>
         <rule>
            <name value="repeatNumber"></name>
            <source>
               <context value="dispenseRequest"></context>
               <element value="numberOfRepeatsAllowed"></element>
               <variable value="number"></variable>
            </source>
            <target>
               <context value="repeatNumber"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="number"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="repeatNumberNull"></name>
            <source>
               <context value="dispenseRequest"></context>
               <condition value="numberOfRepeatsAllowed.exists() = false"></condition>
            </source>
            <target>
               <context value="repeatNumber"></context>
               <contextType value="variable"></contextType>
               <element value="nullFlavor"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="NI"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="contained"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="contained"></element>
            <variable value="medication"></variable>
            <condition value="('#' + $this.id) in %medicationRequest.medicationReference.reference"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="consumable"></element>
            <variable value="consumable"></variable>
         </target>
         <target>
            <context value="consumable"></context>
            <contextType value="variable"></contextType>
            <element value="manufacturedProduct"></element>
            <variable value="manufacturedProduct"></variable>
         </target>
         <target>
            <context value="manufacturedProduct"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="MANU"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="MP-templateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.2"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="MP-templateId"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="2.16.840.1.113883.10.20.1.53"></valueString>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="manufacturedMaterial"></name>
            <source>
               <context value="medication"></context>
            </source>
            <target>
               <context value="manufacturedProduct"></context>
               <contextType value="variable"></contextType>
               <element value="manufacturedMaterial"></element>
               <variable value="manufacturedMaterial"></variable>
            </target>
            <dependent>
               <name value="ManufacturedMaterialEntryContentModulePrescription"></name>
               <variable value="bundle"></variable>
               <variable value="medicationRequest"></variable>
               <variable value="medication"></variable>
               <variable value="manufacturedMaterial"></variable>
               <variable value="substanceAdministration"></variable>
            </dependent>
         </rule>
      </rule>
      <rule>
         <name value="onylonedosage"></name>
         <source>
            <context value="medicationRequest"></context>
            <condition value="dosageInstruction.count() = 1"></condition>
         </source>
         <rule>
            <name value="normalDose"></name>
            <source>
               <context value="medicationRequest"></context>
               <element value="dosageInstruction"></element>
               <variable value="dosage"></variable>
               <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
            </source>
            <target>
               <context value="substanceAdministration"></context>
               <contextType value="variable"></contextType>
               <element value="templateId"></element>
               <variable value="templateId"></variable>
            </target>
            <target>
               <context value="templateId"></context>
               <contextType value="variable"></contextType>
               <element value="root"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="1.3.6.1.4.1.19376.1.5.3.1.4.7.1"></valueString>
               </parameter>
            </target>
         </rule>
         <documentation value="TODO: AUTHOR1 Medication Treatment Plan Author"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-normal-medicationrequest')"></condition>
         </source>
         <dependent>
            <name value="DosageInstructionsStartStopFrequencySubstanceAdministration"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="dosageInstruction"></element>
            <listMode value="first"></listMode>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split-medicationrequest')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryStartStopRoute"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
            <variable value="entryRelationship"></variable>
         </dependent>
         <documentation value="dosage for split dosing (with sequences): effectiveTime (start/stop) &amp; routeCode"></documentation>
      </rule>
      <rule>
         <name value="DosageSubstanceAdministration"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-structured-split-medicationrequest')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <dependent>
            <name value="DosageInstructionsEntryDosageChangeSubstanceAdministration"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
            <variable value="entryRelationship"></variable>
         </dependent>
         <documentation value="dosage for split dosing (with sequences): sequence number, effectiveTime (when), dose quantity, consumable"></documentation>
      </rule>
      <rule>
         <name value="TreatmentReasonEntryContentModule"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="reasonCode"></element>
            <variable value="reasonCode"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="RSON"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="observation"></element>
            <variable value="observation"></variable>
         </target>
         <dependent>
            <name value="TreatmentReasonEntryContentModule"></name>
            <variable value="reasonCode"></variable>
            <variable value="observation"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="MTP-Reference"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan'"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="REFR"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="extension"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="dosageInstruction"></element>
            <variable value="dosage"></variable>
            <condition value="$this.conformsTo('http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-dosage-nonstructured')"></condition>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="DosageInstructionsNonStructuredEntryContentModule"></name>
            <variable value="dosage"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
         <documentation value="TODO: Patient Medication Instructions Contains 1.3.6.1.4.1.19376.1.5.3.1.4.3 IHE Patient Medication Instructions (DYNAMIC)"></documentation>
      </rule>
      <rule>
         <name value="AnnotationComment"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="note"></element>
            <variable value="note"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="AnnotationComment"></name>
            <variable value="note"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="Substitution"></name>
         <source>
            <context value="medicationRequest"></context>
            <element value="substitution"></element>
            <variable value="substitution"></variable>
         </source>
         <target>
            <context value="substanceAdministration"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="COMP"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="act"></element>
            <variable value="act"></variable>
         </target>
         <dependent>
            <name value="SubstitutionRequest"></name>
            <variable value="substitution"></variable>
            <variable value="act"></variable>
         </dependent>
      </rule>
   </group>
   <group>
      <name value="PharmaceuticalAdviceItemEntryContentModule"></name>
      <typeMode value="none"></typeMode>
      <documentation value="source: http://build.fhir.org/ig/hl7ch/ch-emed/StructureDefinition-ch-emed-observation.html
target: https://art-decor.org/art-decor/decor-templates--cdachemed-?section=templates&amp;id=2.16.756.5.30.1.1.10.4.44"></documentation>
      <input>
         <name value="bundle"></name>
         <type value="Bundle"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="fhirobservation"></name>
         <type value="Observation"></type>
         <mode value="source"></mode>
      </input>
      <input>
         <name value="cdaobservation"></name>
         <type value="Observation"></type>
         <mode value="target"></mode>
      </input>
      <rule>
         <name value="OBS"></name>
         <source>
            <context value="fhirobservation"></context>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="classCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="OBS"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="EVN"></name>
         <source>
            <context value="fhirobservation"></context>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="moodCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="EVN"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="IHE-PHARM-PADV"></name>
         <source>
            <context value="fhirobservation"></context>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="1.3.6.1.4.1.19376.1.9.1.3.3"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="CH-PHARM-PharmaceuticalAdviceItemEntryContentModule"></name>
         <source>
            <context value="fhirobservation"></context>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="templateId"></element>
            <variable value="templateId"></variable>
         </target>
         <target>
            <context value="templateId"></context>
            <contextType value="variable"></contextType>
            <element value="root"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="2.16.756.5.30.1.1.10.4.44"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="id"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="identifier"></element>
            <variable value="identifier"></variable>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="id"></element>
            <variable value="id"></variable>
         </target>
         <dependent>
            <name value="IdentifierII"></name>
            <variable value="identifier"></variable>
            <variable value="id"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="code"></element>
            <variable value="fhirCode"></variable>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <variable value="cdaCode"></variable>
         </target>
         <dependent>
            <name value="CodeableConceptCE"></name>
            <variable value="fhirCode"></variable>
            <variable value="cdaCode"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="code"></name>
         <source>
            <context value="fhirobservation"></context>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="statusCode"></element>
            <variable value="statusCode"></variable>
         </target>
         <target>
            <context value="statusCode"></context>
            <contextType value="variable"></contextType>
            <element value="code"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="completed"></valueString>
            </parameter>
         </target>
      </rule>
      <rule>
         <name value="effectiveTime"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="effectiveDateTime"></element>
            <variable value="effectiveDateTime"></variable>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="effectiveTime"></element>
            <variable value="effectiveTime"></variable>
         </target>
         <rule>
            <name value="value"></name>
            <source>
               <context value="effectiveDateTime"></context>
            </source>
            <target>
               <context value="effectiveTime"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="effectiveDateTime"></valueId>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="MTP-Reference"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan'"></condition>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="REFR"></valueString>
            </parameter>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="substanceAdministration"></element>
            <variable value="substanceAdministration"></variable>
         </target>
         <dependent>
            <name value="MTPReferenceEntryContentModule"></name>
            <variable value="extension"></variable>
            <variable value="substanceAdministration"></variable>
         </dependent>
      </rule>
      <rule>
         <name value="changedmtp"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="extension"></element>
            <variable value="extension"></variable>
            <condition value="url = 'http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-medicationstatement-changed'"></condition>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="entryRelationship"></element>
            <variable value="entryRelationship"></variable>
         </target>
         <target>
            <context value="entryRelationship"></context>
            <contextType value="variable"></contextType>
            <element value="typeCode"></element>
            <transform value="copy"></transform>
            <parameter>
               <valueString value="REFR"></valueString>
            </parameter>
         </target>
         <rule>
            <name value="entry"></name>
            <source>
               <context value="bundle"></context>
               <element value="entry"></element>
               <variable value="entry"></variable>
            </source>
            <rule>
               <name value="fullUrlAsUuid"></name>
               <source>
                  <context value="entry"></context>
                  <element value="fullUrl"></element>
                  <condition value="($this in %extension.valueReference.reference) and $this.startsWith('urn:uuid')"></condition>
               </source>
               <rule>
                  <name value="MedicationStatement"></name>
                  <source>
                     <context value="entry"></context>
                     <element value="resource"></element>
                     <variable value="medicationStatement"></variable>
                     <condition value="$this.ofType(FHIR.MedicationStatement)"></condition>
                  </source>
                  <target>
                     <context value="entryRelationship"></context>
                     <contextType value="variable"></contextType>
                     <element value="substanceAdministration"></element>
                     <variable value="substanceAdministration"></variable>
                  </target>
                  <dependent>
                     <name value="MedicationTreatmentPlanItemEntryContentModule"></name>
                     <variable value="bundle"></variable>
                     <variable value="medicationStatement"></variable>
                     <variable value="substanceAdministration"></variable>
                  </dependent>
               </rule>
            </rule>
            <rule>
               <name value="MedicationStatement"></name>
               <source>
                  <context value="entry"></context>
                  <element value="resource"></element>
                  <variable value="medicationStatement"></variable>
                  <condition value="$this.ofType(FHIR.MedicationStatement) and (('MedicationStatement' + '/' + $this.id) in %extension.valueReference.reference)"></condition>
               </source>
               <target>
                  <context value="entryRelationship"></context>
                  <contextType value="variable"></contextType>
                  <element value="substanceAdministration"></element>
                  <variable value="substanceAdministration"></variable>
               </target>
               <dependent>
                  <name value="MedicationTreatmentPlanItemEntryContentModule"></name>
                  <variable value="bundle"></variable>
                  <variable value="medicationStatement"></variable>
                  <variable value="substanceAdministration"></variable>
               </dependent>
            </rule>
         </rule>
      </rule>
      <rule>
         <name value="note"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="note"></element>
            <variable value="note"></variable>
         </source>
         <rule>
            <name value="narrativeLink"></name>
            <source>
               <context value="note"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <target>
               <context value="cdaobservation"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <variable value="text"></variable>
            </target>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <rule>
               <name value="valueUrl"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="note"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="cdaobservation"></context>
               <contextType value="variable"></contextType>
               <element value="text"></element>
               <variable value="text"></variable>
            </target>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
      <rule>
         <name value="text"></name>
         <source>
            <context value="fhirobservation"></context>
            <element value="note"></element>
            <variable value="note"></variable>
         </source>
         <target>
            <context value="cdaobservation"></context>
            <contextType value="variable"></contextType>
            <element value="text"></element>
            <variable value="text"></variable>
         </target>
         <rule>
            <name value="text"></name>
            <source>
               <context value="note"></context>
               <element value="text"></element>
               <variable value="noteText"></variable>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="data"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueId value="noteText"></valueId>
               </parameter>
            </target>
         </rule>
         <rule>
            <name value="id"></name>
            <source>
               <context value="note"></context>
               <element value="extension"></element>
               <variable value="extension"></variable>
               <condition value="$this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink'"></condition>
            </source>
            <rule>
               <name value="reference"></name>
               <source>
                  <context value="extension"></context>
                  <element value="valueUrl"></element>
                  <variable value="valueUrl"></variable>
               </source>
               <target>
                  <context value="text"></context>
                  <contextType value="variable"></contextType>
                  <element value="reference"></element>
                  <variable value="reference"></variable>
               </target>
               <target>
                  <context value="reference"></context>
                  <contextType value="variable"></contextType>
                  <element value="value"></element>
                  <transform value="copy"></transform>
                  <parameter>
                     <valueId value="valueUrl"></valueId>
                  </parameter>
               </target>
            </rule>
         </rule>
         <rule>
            <name value="reference"></name>
            <source>
               <context value="note"></context>
               <condition value="(extension.where($this.url = 'http://hl7.org/fhir/StructureDefinition/narrativeLink').exists() = false)"></condition>
            </source>
            <target>
               <context value="text"></context>
               <contextType value="variable"></contextType>
               <element value="reference"></element>
               <variable value="reference"></variable>
            </target>
            <target>
               <context value="reference"></context>
               <contextType value="variable"></contextType>
               <element value="value"></element>
               <transform value="copy"></transform>
               <parameter>
                  <valueString value="#refpdf"></valueString>
               </parameter>
            </target>
         </rule>
      </rule>
   </group>
</StructureMap>